
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Roundhouse your database</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="Roundhouse your database Oct 26th, 2010 Open source, Tips, Tools As you started to use UppercuT for your builds, it is definitely worth to try worth &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/2010/10/roundhouse-your-database.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><article class="post">
	  
  <h1 class="title pure-u-1">Roundhouse your database</h2>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2010-10-26T18:14:00+03:00" pubdate data-updated="true">Oct 26<span>th</span>, 2010</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/open-source/'>Open source</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
As you started to use <a href="http://code.google.com/p/uppercut">UppercuT</a> for your builds, it is definitely worth to try worth to try <a href="http://code.google.com/p/roundhouse/">RoundhousE</a> for versioning, deployment, migration of your database. 
</p>
<h2>RoundhousE - setup and usage</h2>
<p>
Let&#8217;s begin, just to to project web site and download latest package. Package contains documentation (just some draft version, not yet completed), samples and framework itself.
</p>
<p>
Initially I spent sometime to make samples run. Documentation said that it has been developed and tested with SQL 2008 Server and there is no information that it would run on SQL 2008 Express Edition. After several fail/repeat sessions I was happy to see that it actually could work with Express edition as well!
</p>
<h3>Before you start</h3>
<p>
Before you start, you have to change something in you SQL Express configuration. Go to <code>Start -> All programs -> Microsoft SQL Server 2008 -> Configuration Tools -> SQL Server Configuration Manager</code>. There you have to configure your SQL instance Network Configuration, to be able with &#8220;Named Pipes&#8221; protocol. So, go to <code>Protocols for &#60;%INSTANCE_NAME%&#62;</code> and enable <code>Named Pipes</code>
</p>
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TMbwcl2QFnI/AAAAAAAAG-8/ZK_EGoi0q5k/s1600/sqlconfig.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 301px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TMbwcl2QFnI/AAAAAAAAG-8/ZK_EGoi0q5k/s400/sqlconfig.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5532373566257895026" /></a>
<h3>UppercuT configuration</h3>
<p>
Now you have to change something into UppercuT config. First you have to modify <code>LOCAL.settings</code> (file that is used for generation of deployment scripts). You have to supply <code>server.database</code> (in case of local Express it would be .\SQLEXPRESS), <code>database.name</code> the name of your db. 
</p>
<p>
After small changes is required for <code>UppercuT.config</code>. First, <code>folder.database</code> I just used &#8220;db&#8221;, short and clear.
</p>
<p>
Check out this <a href="http://github.com/alexanderbeletsky/Trackyourtasks.net/commit/552895c301426ad413d83eb9c5c7ef00cf8c52a6#diff-7">diff</a>, for instance.
</p>
<h3>DB folder layout and content</h3>
<p>
Now, you have to create folder that would contain all sql scripts. I places it in the same level as <code>docs</code>, <code>lib</code> etc (but it could be placed to <code>src</code> folder as well). So, please folder with name &#8220;db&#8221;.
</p>
<p>
Documentation currently lacks information about folder layout, but from samples it is pretty clear:
</p>
<ul>
<li><strong>functions</strong> - sql for functions definitions</li>
<li><strong>permissions</strong> - setup permissions for database</li>
<li><strong>sprocs</strong> - stored procedures definition</li>
<li><strong>up</strong> - update scripts (create, drop, alter tables and records here)</li>
<li><strong>views</strong> - views definition</li>
</ul>
<p>
If your application doesn&#8217;t currently use stored procedures or view.. it is OK to just leave those folders empty.
</p>
<h3>Deployment options</h3>
<p>
You have 3 options of deployment: by Nant, by MSBuild or by RH executable. It does not actually matters what to choose, all options are equal by its functionality. I choose executable, because it lightweight and only one file (please not that it would be included to deployment package).
</p>
<p>
To go with RH you have to copy it from RoundhousE packages into yours deployment folder. So, you will have <code>deployment/rh/rh.exe</code>.
</p>
<h3>Correction of deployment scripts</h3>
<p>
Deployment scripts are ones that will be used on production to update database. They are created based on templates and settings you set. You have to modify yours <code>DBDeployment.bat</code> file. Since I use <code>rh.exe</code> I created template for it. It simply runs <code>rh.exe</code> that does the rest of work. 
</p>
<script src="http://gist.github.com/645211.js"> </script>
<p>
Check out this <a href="http://github.com/alexanderbeletsky/Trackyourtasks.net/commit/552895c301426ad413d83eb9c5c7ef00cf8c52a6#diff-7">diff</a>, for instance.
</p>
<h3>Running RoundhousE</h3>
<p>
As soon as build application, go to <code>code_drop</code> folder you can run <code>LOCAL.BEDeployment.bat</code> and RounhousE will setup database with version it.
</p>
<p>
That&#8217;s basically it! As soon as its configured you can easily add new scripts to db folder, RoundhousE will handle changes of them.
</p>
<h3>Additional scripts I use</h3>
<p>
There are something that I added for my personal needs. If I do build on new environment, I would like to create database first. For such purpose I created <a href="http://github.com/alexanderbeletsky/Trackyourtasks.net/blob/master/initdb.bat"><code>initdb.bat</code></a>, so build procedure on clean environment would be:
</p>
<ol>
<li>run build.bat</li>
<li>run initdb.bat</li>
<li>run test.bat all</li>
</ol>
<p>
I also created script to reset database,  <a href="http://github.com/alexanderbeletsky/Trackyourtasks.net/blob/master/resetdb.bat"><code>resetdb.bat</code></a> drops existing database and just creates new instance. This very useful during development, if you database became &#8220;dirty&#8221;. 
</p></div>

      <div class="post sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://beletsky.net/2010/10/roundhouse-your-database.html" data-via="alexbeletsky" data-counturl="http://beletsky.net/2010/10/roundhouse-your-database.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      <p class="post byline author vcard">
	Posted by <a href="/about">Alexander Beletsky</a>. If you liked that material, please consider to follow my <a href="http://twitter.com/alexbeletsky">twitter</a> account for further updates. If you have comments or questions, do not hesitate to contact my <a href="mailto:alexander.beletsky@gmail.com">email</a> or raise issue on <a href="https://github.com/alexanderbeletsky/alexanderbeletsky.github.io/issues">github</a>.
</p>
    </div>
  </div>

</article>
</div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright © 2010 - 2013 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>