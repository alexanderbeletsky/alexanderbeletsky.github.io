<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: DDD | Alexander Beletsky's development blog]]></title>
  <link href="http://alexanderbeletsky.github.io/blog/categories/ddd/atom.xml" rel="self"/>
  <link href="http://alexanderbeletsky.github.io/"/>
  <updated>2013-09-17T09:58:34+03:00</updated>
  <id>http://alexanderbeletsky.github.io/</id>
  <author>
    <name><![CDATA[Alexander Beletsky]]></name>
    <email><![CDATA[alexander.beletsky@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Greg Young and Rinat Abdulin Visited Kyiv]]></title>
    <link href="http://alexanderbeletsky.github.io/2011/10/greg-young-and-rinat-abdulin-visited.html"/>
    <updated>2011-10-25T09:47:00+03:00</updated>
    <id>http://alexanderbeletsky.github.io/2011/10/greg-young-and-rinat-abdulin-visited</id>
    <content type="html"><![CDATA[<div class='post'>
<p>It finally happened, <a href="http://codebetter.com/gregyoung/">Greg Young</a> and <a href="http://abdullin.com/">Rinat Abdulin</a> have been guesting Kyiv for almost the week. <br />
</p><p>Initially we've gathered on <a href="http://kyivbeerncode.org/">Beer && Code</a> meeting. The format a little changed that time, but I would say that was really interesting meeting. Greg introduced one of the project he currently working on <a href="http://continuoustests.com/">http://continuoustests.com/</a> that now referenced as "Mighty Moose". "Mighty Moose" appear to be really powerful tool that tracks both code and tests changes, and in case of changes taking place it automatically re-runs all related test cases. So, we've grabbed the latest version on MM and played with it a bit. MM is officially in betta now and gonna to be release soon, so did a small contribution by submitting some bugs found on a fly. I also really much enjoyed the quick demonstration of <a href="https://github.com/gregoryyoung/Simple.Testing">Simple.Testing</a> framework. It worth to have a separate blog post on that, but in short - it is BDD style framework that literally produce plain English specifications as it's output. It's indeed very simple - just several hundreds LOC's, but very impressive.<br />
</p><p>But of cause, the main event was <a href="http://www.facebook.com/event.php?eid=268332313185736">Free Event Centric Weekend</a>. It is very hard to describe what was there just in this short post. You might check out some tweets on <a href="http://twitter.com/#!/search/eventcentric">#eventcentric</a> channel. Greg and Rinat were sharing their huge experience on CQRS/DDD and I would say that was extremely interesting. I'm not using either CQRS or DDD on my daily work, so a lot of new concept's I've heard are still really unknown to me, but I'm happy I looked behind the curtain. Greg is <a href="http://martinfowler.com/bliki/ShuHaRi.html">Ri</a> level developer - he is simply breaking the concepts. Seriously, I was blown away with some of the statements and my brain is still "damaged" with everything I heard there.<br />
</p><a href="https://lh4.googleusercontent.com/-_2de-YNoo-0/TqZWzXugX3I/AAAAAAAAHm0/_zNc09RHImQ/s720/eventcentic.jpg"><br />
<img src="https://lh4.googleusercontent.com/-_2de-YNoo-0/TqZWzXugX3I/AAAAAAAAHm0/_zNc09RHImQ/s720/eventcentic.jpg" alt="Eventcentric meeting in Kyiv" style="width: 620px" /><br />
</a><br />
<p>Besides of that we had several cool evenings, drinking beers. I would say that was great week and I'm really happy to meet you guys. I would also say big thanks to <a href="http://kievalt.net/">KievAltNet</a>, <a href="http://www.luxoft.com/">Luxoft</a> with support they provided to make this happen. I know this in not your last visit to Kiev, so see you soon! <br />
</p><p>ps. As more you know as more unknown you are able to see...<br />
</p></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DDD, Implementation of Repository pattern with Linq to SQL]]></title>
    <link href="http://alexanderbeletsky.github.io/2010/06/ddd-implementation-of-repository.html"/>
    <updated>2010-06-30T19:06:00+03:00</updated>
    <id>http://alexanderbeletsky.github.io/2010/06/ddd-implementation-of-repository</id>
    <content type="html"><![CDATA[<div class='post'>
Lets review first and one of major DDD pattern - Repository. Repository is something that provides access to an entities objects (domain objects). Here what DDD patterns guide says on Repositories:
<br />
<br />
<i>
For each type of object that needs global access, create an object that can provide the illusion of an in-memory collection of all objects of that type. Set up access through a well-known global interface. Provide methods to add and remove objects, which will encapsulate the actual insertion or removal of data in the data store. Provide methods that select objects based on some criteria and return fully instantiated objects or collections of objects whose attribute values meet the criteria, thereby encapsulating the actual storage and query technology. Provide repositories only for aggregate roots that actually need direct access. Keep the client focused on the model, delegating all object storage and access to the repositories.
</i>
<br />
<br />
<h2>Preparation</h2>
<br />
Suppose we are having a database with table Users in it. First of all we have to create a Data Model class. To do that you can add "New item" to you class library (or application) and select Linq to Classes.
<br />
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TCtrtiIPoMI/AAAAAAAAG1o/gFWf5MBbwMo/s1600/LinqToClasses.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 247px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TCtrtiIPoMI/AAAAAAAAG1o/gFWf5MBbwMo/s400/LinqToClasses.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5488599000880750786" /></a>
<br />
<br />
This will add new .dbml file your project. There are 2 ways of addition new entities to model. Either by designer (easy to use) or manually by coding .dbml file (harder to user by more flexibility). We will just use first way as more quick one. Just open you db in Server explorer and drag-and-drop Users table to .dbml designer. You will see something like that,
<br />
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TCtr2X9znlI/AAAAAAAAG1w/fTqMklm0_WM/s1600/UsersInDesigner.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 216px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TCtr2X9znlI/AAAAAAAAG1w/fTqMklm0_WM/s400/UsersInDesigner.png" border="0" alt=""id="Img1" /></a>
<br />
<br />
Now if you open corresponding .cs file of Data Model you can easily see what code is actually generated by Linq to SQL. Let's quickly review it. So, most improtant class is DataContext.
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;[global::System.Data.Linq.Mapping.DatabaseAttribute(Name=<font color="#A31515">"trackyourtasksdb"</font>)]<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">partial</font> <font color="#0000ff">class</font> TrackYourTasksDataContext : System.Data.Linq.DataContext<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">static</font> System.Data.Linq.Mapping.MappingSource mappingSource = <font color="#0000ff">new</font> AttributeMappingSource();<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
<a href="http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.aspx">DataContext</a> is something that suppose provide access to tables and objects and track the state of these objects. It uses SubmitChanges() method to flush the data to database. It is lightweight object and you should instantiate in in method of class scope, there are no reasons to keep a single copy of object for whole application. It is not only possible to work with tables within DataContext, but stored procedures as well.  
<br />
<br />
Besides of that the object represenation of table record is generated. The class is called User (please not that Linq to SQL is removing plural -s suffix by itself). 
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;[global::System.Data.Linq.Mapping.TableAttribute(Name=<font color="#A31515">"dbo.Users"</font>)]<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">partial</font> <font color="#0000ff">class</font> User : INotifyPropertyChanging, INotifyPropertyChanged<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">static</font> PropertyChangingEventArgs emptyChangingEventArgs = <font color="#0000ff">new</font> PropertyChangingEventArgs(<font color="#2B91AF">String</font>.Empty);<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">int</font> _Id;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">string</font> _Email;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">string</font> _SecretPhrase;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> <font color="#0000ff">string</font> _Password;<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> System.Data.Linq.Binary _Timestamp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//...</font><br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> User()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnCreated();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;[global::System.Data.Linq.Mapping.ColumnAttribute(Storage=<font color="#A31515">"_Id"</font>, AutoSync=AutoSync.OnInsert, DbType=<font color="#A31515">"Int NOT NULL IDENTITY"</font>, IsPrimaryKey=<font color="#0000ff">true</font>, IsDbGenerated=<font color="#0000ff">true</font>, UpdateCheck=UpdateCheck.Never)]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">protected</font> <font color="#0000ff">int</font> Id<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">get</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> <font color="#0000ff">this</font>._Id;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">set</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font> ((<font color="#0000ff">this</font>._Id != <font color="#0000ff">value</font>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.OnIdChanging(<font color="#0000ff">value</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.SendPropertyChanging();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>._Id = <font color="#0000ff">value</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.SendPropertyChanged(<font color="#A31515">"Id"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.OnIdChanged();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;[global::System.Data.Linq.Mapping.ColumnAttribute(Storage=<font color="#A31515">"_Email"</font>, DbType=<font color="#A31515">"NVarChar(MAX) NOT NULL"</font>, CanBeNull=<font color="#0000ff">false</font>, IsPrimaryKey=<font color="#0000ff">true</font>, UpdateCheck=UpdateCheck.Never)]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">string</font> Email<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">get</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> <font color="#0000ff">this</font>._Email;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">set</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font> ((<font color="#0000ff">this</font>._Email != <font color="#0000ff">value</font>))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.OnEmailChanging(<font color="#0000ff">value</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.SendPropertyChanging();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>._Email = <font color="#0000ff">value</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.SendPropertyChanged(<font color="#A31515">"Email"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">this</font>.OnEmailChanged();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//...</font><br><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote><br />
<br />
<br />
So as you see it incapsulates fields of table as corresponding properties of object. 
<br />
<br />
<h2>Interface</h2>
<br />
As it said above Repository have to add, remove as well as search and update objects. Note, that we work work with db record (entities classes) as we just work with in-memory objects. 
<br />
<br />
It is always good idea to work with such structures as Repositories, Factories, Services etc. throught interface. First of all, because it conforms to common object oriented design guidlines and make us possibility to have different implementation classes that would provide different behavior. Second, that with interfaces you can substitute real object with mock object during testing. Moreover with interfaces it is easy to use <a href="http://martinfowler.com/articles/injection.html">Dependency Injection</a> pattern, that improves application flexability and testability.
<br />
<br />
User repository interface looks like,
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">using</font> System;<br><font color="#0000ff">using</font> System.Linq;<br><font color="#0000ff">using</font> System.Text;<br><font color="#0000ff">using</font> Trackyourtasks.Core.DAL.DataModel;<br><br><font color="#0000ff">namespace</font> Trackyourtasks.Core.DAL<br>{<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">interface</font> IUsersRepository<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;User FindUserById(<font color="#0000ff">int</font> id);<br>&nbsp;&nbsp;&nbsp;&nbsp;User FindUserByEmail(<font color="#0000ff">string</font> email);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">void</font> SaveUser(User user);<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">void</font> DeleteUser(User user);<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
Now let's implement this repository with Linq to SQL tools. We would review all methods, one by one.
<br />
<br />
<u>Construction of Repository:</u>
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">using</font> System;<br><font color="#0000ff">using</font> System.Collections.<font color="#2B91AF">Generic</font>;<br><font color="#0000ff">using</font> System.Linq;<br><font color="#0000ff">using</font> System.Text;<br><font color="#0000ff">using</font> Trackyourtasks.Core.DAL.DataModel;<br><br><font color="#0000ff">namespace</font> Trackyourtasks.Core.DAL<br>{<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">class</font> UsersRepository : IUsersRepository<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;TrackYourTasksDataContext _context = <font color="#0000ff">new</font> TrackYourTasksDataContext();<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
As you see I instantiate DataContext object as a member of UsersRepository class. So, it will be alive and tracking objects since UserRepository class is alive. 
<br />
<br />
<u>Find methods:</u>
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> User FindUserById(<font color="#0000ff">int</font> id)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> (<font color="#0000ff">from</font> user <font color="#0000ff">in</font> _context.Users <font color="#0000ff">where</font> user.Id == id <font color="#0000ff">select</font> user).SingleOrDefault();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> User FindUserByEmail(<font color="#0000ff">string</font> email)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> (<font color="#0000ff">from</font> user <font color="#0000ff">in</font> _context.Users <font color="#0000ff">where</font> user.Email == email <font color="#0000ff">select</font> user).SingleOrDefault();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
Impelementation is just a simple Linq query that selects object either by Id or Email. I use <a href="http://msdn.microsoft.com/en-us/library/system.linq.enumerable.singleordefault.aspx">SingleOrDefault()</a> that returns object if found and default if not (null in my case). 
<br />
<br />
<u>Save and Update methods:</u>
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> SaveUser(User user)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font> (user.Id == 0)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_context.Users.InsertOnSubmit(user);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_context.SubmitChanges();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
So, if are created user entiry by new operator it will contain Id == 0 (meaning no Id, yet), as we passing it to Save method it will check is this object persistant or not and if not it will be add it to storage. Since context object is not disposed after, it still continue track object changes, so if we decieded to change some object fields and store it all we need to do is call <a href="http://msdn.microsoft.com/en-us/library/system.data.linq.datacontext.submitchanges.aspx">SubmitChanges()</a> method and corrsponding record will be updated. I'll put some tests here to see how it works:
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> InsertUser()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> register = <font color="#0000ff">new</font> UsersRepository();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> user = <font color="#0000ff">new</font> User()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email = <font color="#A31515">"email"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretPhrase = <font color="#A31515">"sec"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password = <font color="#A31515">"pass"</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register.SaveUser(user);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> actual = register.FindUserByEmail(<font color="#A31515">"email"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(actual, Is.Not.Null);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;[ExpectedException(<font color="#0000ff">typeof</font>(DuplicateKeyException))]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> InsertUserTwice()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> register = <font color="#0000ff">new</font> UsersRepository();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT / POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> user = <font color="#0000ff">new</font> User()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email = <font color="#A31515">"email"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretPhrase = <font color="#A31515">"sec"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password = <font color="#A31515">"pass"</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register.SaveUser(user);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> newUser = <font color="#0000ff">new</font> User()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email = <font color="#A31515">"email"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretPhrase = <font color="#A31515">"sec"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password = <font color="#A31515">"pass"</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register.SaveUser(newUser);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> UpdateUser()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> register = <font color="#0000ff">new</font> UsersRepository();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> user = <font color="#0000ff">new</font> User()<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email = <font color="#A31515">"email"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecretPhrase = <font color="#A31515">"sec"</font>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Password = <font color="#A31515">"pass"</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register.SaveUser(user);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.SecretPhrase = <font color="#A31515">"newsec"</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;register.SaveUser(user);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> foundUser = register.FindUserById(user.Id);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(foundUser, Is.Not.Null);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(foundUser.SecretPhrase, Is.EqualTo(<font color="#A31515">"newsec"</font>));<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
<u>Delete Methods:</u>
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black">&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> DeleteUser(User user)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_context.Users.DeleteOnSubmit(user);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_context.SubmitChanges();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
So object is marked as to be deleted by calling <a href="http://msdn.microsoft.com/en-us/library/bb763473.aspx">DeleteOnSubmit()</a> and it will be actually deleted on SubmitChanges() call. 
<br />
<br />
<h2>Conclusions</h2>
<br />
<br />
<p>
It is really easy to start up with Repositories keeping its implementation as simple as possible. Of cause, typicaly data structure in databases are bit more complex than plain table. But it is still possible to work with this pattern, combining with Repositories, Aggregates, Entities and Values.
</p></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DDD, Domain Driven Design]]></title>
    <link href="http://alexanderbeletsky.github.io/2010/06/ddd-domain-driven-development.html"/>
    <updated>2010-06-28T14:00:00+03:00</updated>
    <id>http://alexanderbeletsky.github.io/2010/06/ddd-domain-driven-development</id>
    <content type="html"><![CDATA[<div class='post'>
There is one great book by Jimmy Nilsson <a href="http://domaindrivendesign.org/books#DDD_apply">Applying Domain-Driven Design and Patterns</a> (russian translation of that book is just awful, so now I'm looking for orignal copy). Jimmy is describing DDD with a very nice examples and concepts, also he gives a good attension to TDD 
    and refactoring. If you want to start with DDD (and you have to) you should 
    check DDD website <a href="http://domaindrivendesign.org/">http://domaindrivendesign.org/</a> and I really liked personal <a href="http://jimmynilsson.com/blog/">blog</a> of Jimmy Nilsson. 
<br />
<br />
I already did use DDD in my previous <a href="http://abeletsky.blogspot.com/search/label/DDD">posts</a> while I designed registration functionality for web application. I believe that many of you are using DDD in your development practice but it could be rather implicit practice.
<br />
<br />
DDD is not something strict like methodologies or technologies are and give no strict rules how to do things, but rather a way of thinking how to work with domain specific within software development. What I personally like in DDD that it goes with a set of patterns that also helps to form common vocabulary for developers. There is a document that gives short summarize on DDD patterns, you can get is <a href="http://domaindrivendesign.org/sites/default/files/discussion/PatternSummariesUnderCreativeCommons.doc">here</a>.  
<br />
<br />
Let's review triangle of What/Why/Where for DDD.
<br />
<br />
<h2>What ?</h2>
<br />
Domain Driven Development is a way of thinking for development of software that do focus on:
<ul>
<li>
<u>Core domain</u> - Understanding of domain is vital for any software <i>product</i>. Proper representation of domain with tools and languages you have is vital for any software <i>project</i>.
</li>
<li>
<u>Patterns</u> - If I met some problem I'm really sure that I'm not first person who did, and probably this problem is alredy solved (probably well enought). Such "solved" problems forms so called patterns, something "know-how" that could be reused for another partcular needs. There are <i>no reasons</i> to reinvent wheeel.
</li>
<li>
<u>Collaboration</u> - Collaboration between developers and domain experts as more extensive as possible. Experts could be a customers (customer on site as XP says) or other representive who in charge of product (product owner as Scrum says).
</li>
</ul>  
<br />
<br />
<h2>Why ?</h2>
<br />
Software is something that suppose to solve problems we met in life. DDD focused on these problems and tries to desing software as closer to problems as possible. Personally I think that DDD is a native way of software development.
<br />
<br />
<h2>Where ?</h2>
<br />
Everywhere actually. DDD is not for some specific areas. So, Web, Desktop, Fun or Science.. everything is applicable.
<br />
<br />
<h2>Conclusions</h2>
<br />
<p>
As I said on a beginning DDD is something that every developer shound aware about it (I would highlight word "aware" meaning it is not expected to be an expert on it, that always good, but know that it is exists and know key priciples). You will easy found a start up materials in internet. Meanwhile if I meet some examples of DDD patterns implementation I'll do blog about it.
</p></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Web development: ASP.NET Ajax, ScriptManager to recover a password]]></title>
    <link href="http://alexanderbeletsky.github.io/2010/06/web-development-aspnet-ajax.html"/>
    <updated>2010-06-27T00:58:00+03:00</updated>
    <id>http://alexanderbeletsky.github.io/2010/06/web-development-aspnet-ajax</id>
    <content type="html"><![CDATA[<div class='post'>
Remember a site we started to create in previous articles. What we've got is simple web application, 
    with a registration functionality. During registration you submit email, password and secret phrase. We going to use this secret phrase today to recover forgotten passwords. Functionality is bit artifictial but my goal is to demonstrate usage of ASP.NET Ajax framework, namely ScripManager object as very usefully component for ajaxifying your applications.
<br />
<br />
<h2>Preparation</h2>
<br />
I've added another page called ForgetPassword.aspx, it looks like this:
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ5PtqTslI/AAAAAAAAG1I/r47hme6j7LA/s1600/forgetpass.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 252px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ5PtqTslI/AAAAAAAAG1I/r47hme6j7LA/s400/forgetpass.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5487206506859573842" /></a>
<br />
<br />
<a href="http://msdn.microsoft.com/en-us/magazine/cc163354.aspx">Script Manager</a> is really powerfull component and one of major feature is how it simplifies working with web services. So, let's add ScriptManager to application. The place to do that are typically MasterPage to make ScrpitManager be accessible from every content page. It have to be placed in 'form' with runat="server" attribute, otherwise runtime exception will appear on page loading.
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">&#60;</font><font color="#800000">div</font> <font color="#ff0000">class</font><font color="#0000ff">="content"</font><font color="#0000ff">&#62;</font><br>&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">div</font> <font color="#ff0000">id</font><font color="#0000ff">="left"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">form</font> <font color="#ff0000">id</font><font color="#0000ff">="form1"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">asp:ScriptManager</font> <font color="#ff0000">ID</font><font color="#0000ff">="ScriptManager"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">Scripts</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">asp:ScriptReference</font> <font color="#ff0000">Path</font><font color="#0000ff">="~/js/forgetpassword.js"</font> <font color="#ff0000">ScriptMode</font><font color="#0000ff">="Auto"</font> <font color="#0000ff">/&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">Scripts</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">Services</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">asp:ServiceReference</font> <font color="#ff0000">Path</font><font color="#0000ff">="~/services/ForgetPassword.asmx"</font> <font color="#0000ff">/&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">Services</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">asp:ScriptManager</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">asp:ContentPlaceHolder</font> <font color="#ff0000">ID</font><font color="#0000ff">="ContentPlaceHolder1"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">asp:ContentPlaceHolder</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">form</font><font color="#0000ff">&#62;</font>&nbsp;<br>&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">div</font><font color="#0000ff">&#62;</font>&nbsp;&nbsp;<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
Script Manager contains two references - ScriptReference, ServerReference. It is a declarative way to add references, in the same time it is possible to do it programmatically (that is more complicated). What you need to do is to add such declarations, the rest will be done by control. Next, we will add forgetpassword.js script to script folder and new web service instance to services folder. Now, application ready for AJAX!
<br />
<br />
<h2>Ajaxify It</h2>
<br />
Before we do something more serious let's check that setup we created are actually working. Go to webservice code (ForgetPassword.asmx.cs):
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">namespace</font> WebApplication.Services<br>{<br>&nbsp;&nbsp;<font color="#008000">/// &#60;summary&#62;</font><br>&nbsp;&nbsp;<font color="#008000">/// Summary description for ForgetPassword</font><br>&nbsp;&nbsp;<font color="#008000">/// &#60;/summary&#62;</font><br>&nbsp;&nbsp;[WebService(Namespace = <font color="#A31515">"http://tempuri.org/"</font>)]<br>&nbsp;&nbsp;[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]<br>&nbsp;&nbsp;[System.ComponentModel.ToolboxItem(<font color="#0000ff">false</font>)]<br>&nbsp;&nbsp;<font color="#008000">// To allow this Web Service to be called from script, using ASP.NET AJAX, uncomment the following line. </font><br>&nbsp;&nbsp;[System.Web.Script.Services.ScriptService]<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">class</font> ForgetPassword : System.Web.Services.WebService<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;[WebMethod]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">string</font> HelloWorld()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> <font color="#A31515">"Hello World"</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
Please note, there is attribute of service class [System.Web.Script.Services.ScriptService] that must be uncommented as soon as webservice is being used from java script code. Do not forget to uncomment it. And simple method is present there, HelloWorld that just returns a string. On a ForgetPassword.aspx page we have such form:
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">&#60;</font><font color="#800000">asp:Content</font> <font color="#ff0000">ID</font><font color="#0000ff">="Content2"</font> <font color="#ff0000">ContentPlaceHolderID</font><font color="#0000ff">="ContentPlaceHolder1"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">h2</font><font color="#0000ff">&#62;</font>Please fill form below<font color="#0000ff">&#60;/</font><font color="#800000">h2</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">div</font> <font color="#ff0000">class</font><font color="#0000ff">="box"</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">label</font><font color="#0000ff">&#62;</font>Email: <font color="#0000ff">&#60;/</font><font color="#800000">label</font><font color="#0000ff">&#62;&#60;</font><font color="#800000">asp:TextBox</font> <font color="#ff0000">ID</font><font color="#0000ff">="EmailText"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;&#60;/</font><font color="#800000">asp:TextBox</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">label</font><font color="#0000ff">&#62;</font>Secret Phrase: <font color="#0000ff">&#60;/</font><font color="#800000">label</font><font color="#0000ff">&#62;</font> <font color="#0000ff">&#60;</font><font color="#800000">asp:TextBox</font> <font color="#ff0000">ID</font><font color="#0000ff">="SecretPhraseText"</font> <font color="#ff0000">runat</font><font color="#0000ff">="server"</font><font color="#0000ff">&#62;&#60;/</font><font color="#800000">asp:TextBox</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">label</font><font color="#0000ff">&#62;</font>&#38;nbsp<font color="#0000ff">&#60;/</font><font color="#800000">label</font><font color="#0000ff">&#62;</font> <font color="#0000ff">&#60;</font><font color="#800000">input</font> <font color="#ff0000">id</font><font color="#0000ff">="forgot"</font> <font color="#ff0000">type</font><font color="#0000ff">="button"</font> <font color="#ff0000">value</font><font color="#0000ff">="Forget password"</font> <font color="#ff0000">class</font><font color="#0000ff">="button"</font> <font color="#ff0000">onclick</font><font color="#0000ff">="onForgotPasswordClick()"</font><font color="#0000ff">/&#62;</font>&nbsp; <br>&nbsp;&nbsp;<font color="#0000ff">&#60;/</font><font color="#800000">div</font><font color="#0000ff">&#62;</font><br>&nbsp;&nbsp;<font color="#0000ff">&#60;</font><font color="#800000">span</font> <font color="#ff0000">id</font><font color="#0000ff">="Password"</font><font color="#0000ff">&#62;&#60;/</font><font color="#800000">span</font><font color="#0000ff">&#62;</font><br><font color="#0000ff">&#60;/</font><font color="#800000">asp:Content</font><font color="#0000ff">&#62;</font><br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
By pressing on 'forget' button onForgotPasswordClick() javascript function will be called (this is the place where we would do AJAX calls). Currently the code is really simple:
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">function</font> onForgotPasswordClick() {<br>&nbsp;&nbsp;WebApplication.Services.ForgetPassword.HelloWorld(onMethodSucceeded, onMethodFailed);<br>}<br><br><font color="#0000ff">function</font> onMethodSucceeded(results, args) {<br>&nbsp;&nbsp;alert(results);<br>}<br><br><font color="#0000ff">function</font> onMethodFailed(error) {<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
One one line of code in onForgotPasswordClick() do a bit complex things. It register a call to web service (you have to reference web service with a full class name), HelloWorld does not have any arguments, so we are passing nothing, but register 2 callback functions. One that will be called on successfull finish of AJAX call, second will be called on any failure. Even it might seems no so 'magic' ones who created AJAX application without any frameworks would notice how less code have to be created to accomplish this. Finally, we displaying results in alert window. Just run application, click 'Forgot password' button and see:
<br />
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ5086ObnI/AAAAAAAAG1Q/Rd-q5Uhr68k/s1600/helloworld.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 251px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ5086ObnI/AAAAAAAAG1Q/Rd-q5Uhr68k/s400/helloworld.png" border="0" alt=""id="Img1" /></a>
<br />
<br />
<h2>Real work</h2>
<br />
As soon as we see its OK, let's do some real work. If users email and secret pharase matches corresponding record in database, we going to show user password on screen without reloading of page. We will add new business object and implementation for recovery of password. I would just paste tests and code of business object (as it is really small and simple one), the rest implementation you will be able to see by going to GitHub. (for ones who followed my previous articlies - I've done some refactoring switching to Repository pattern for DAL, since it is more correct and reusable way of working with data, please see details in code).
<br />
<br />
Tests:
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">using</font> System;<br><font color="#0000ff">using</font> System.Collections.<font color="#2B91AF">Generic</font>;<br><font color="#0000ff">using</font> System.Linq;<br><font color="#0000ff">using</font> System.Text;<br><font color="#0000ff">using</font> NUnit.Framework;<br><font color="#0000ff">using</font> Company.Product.BLL.Tests.Mocks;<br><font color="#0000ff">using</font> NUnit.Framework.SyntaxHelpers;<br><font color="#0000ff">using</font> Company.Product.DAL;<br><br><font color="#0000ff">namespace</font> Company.Product.BLL.Tests<br>{<br>&nbsp;&nbsp;[TestFixture]<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">class</font> ForgotPasswordTests<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> Smoke()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> data = <font color="#0000ff">new</font> ForgotPasswordDataMock();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT/POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> c = <font color="#0000ff">new</font> ForgotPassword(data);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> RestorePassword_NoUser()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> data = <font color="#0000ff">new</font> ForgotPasswordDataMock();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> forgot = <font color="#0000ff">new</font> ForgotPassword(data);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> password = forgot.RestorePassword(<font color="#A31515">"no such user"</font>, <font color="#A31515">"secret"</font>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(password, Is.Null, <font color="#A31515">"It is not possible to return password for non-existing user."</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> RestorePassword_WrongSecretPhrase()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> data = <font color="#0000ff">new</font> ForgotPasswordDataMock();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> forgot = <font color="#0000ff">new</font> ForgotPassword(data);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.InsertUser(<font color="#0000ff">new</font> User() { Email = <font color="#A31515">"user@a.com"</font>, Password = <font color="#A31515">"password"</font>, SecretPhrase = <font color="#A31515">"correct secret"</font> });<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> password = forgot.RestorePassword(<font color="#A31515">"user@a.com"</font>, <font color="#A31515">"wrong secret"</font>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(password, Is.Null, <font color="#A31515">"It is not possible to return password if wrong secret phrase used."</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;[Test]<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">void</font> RestorePassword_CorrectUserAndSecret()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//INIT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> data = <font color="#0000ff">new</font> ForgotPasswordDataMock();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> forgot = <font color="#0000ff">new</font> ForgotPassword(data);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> expectedPassword = <font color="#A31515">"password"</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.InsertUser(<font color="#0000ff">new</font> User() { Email = <font color="#A31515">"user@a.com"</font>, Password = expectedPassword, SecretPhrase = <font color="#A31515">"correct secret"</font> });<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//ACT</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> password = forgot.RestorePassword(<font color="#A31515">"user@a.com"</font>, <font color="#A31515">"correct secret"</font>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">//POST</font><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.That(password, Is.EqualTo(expectedPassword), <font color="#A31515">"Wrong password value returned."</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
Code:
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">using</font> System;<br><font color="#0000ff">using</font> System.Collections.<font color="#2B91AF">Generic</font>;<br><font color="#0000ff">using</font> System.Linq;<br><font color="#0000ff">using</font> System.Text;<br><font color="#0000ff">using</font> Company.Product.DAL;<br><br><font color="#0000ff">namespace</font> Company.Product.BLL<br>{<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">class</font> ForgotPassword<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">private</font> IUsersRepository _data;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> ForgotPassword(IUsersRepository data)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_data = data;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">string</font> RestorePassword(<font color="#0000ff">string</font> email, <font color="#0000ff">string</font> secret)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> user = _data.FindUserByEmail(email);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font> (user == <font color="#0000ff">null</font>)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> <font color="#0000ff">null</font>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">if</font> (user.SecretPhrase == secret)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> user.Password;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> <font color="#0000ff">null</font>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
After it is ready and tested we are going to integrate with object to Web Service method call.
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#008000">/// &#60;summary&#62;</font><br><font color="#008000">/// Summary description for ForgetPassword</font><br><font color="#008000">/// &#60;/summary&#62;</font><br>[WebService(Namespace = <font color="#A31515">"http://tempuri.org/"</font>)]<br>[WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]<br>[System.ComponentModel.ToolboxItem(<font color="#0000ff">false</font>)]<br><font color="#008000">// To allow this Web Service to be called from script, using ASP.NET AJAX, uncomment the following line. </font><br>[System.Web.Script.Services.ScriptService]<br><font color="#0000ff">public</font> <font color="#0000ff">class</font> ForgotPasswordService : System.Web.Services.WebService<br>{<br>&nbsp;&nbsp;[WebMethod]<br>&nbsp;&nbsp;<font color="#0000ff">public</font> <font color="#0000ff">string</font> RestorePassword(<font color="#0000ff">string</font> email, <font color="#0000ff">string</font> secret)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">var</font> forgotPassword = <font color="#0000ff">new</font> ForgotPassword(<font color="#0000ff">new</font> UsersRepository());<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">return</font> forgotPassword.RestorePassword(email, secret);<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote>
<br />
<br />
After that it is time to use Web Service from javascript code. I'm using <a href="http://jqueryui.com/">jQuery</a> library to work with divs, classes and so on. jQuery does not require any special to add about it, it is so popular that it has been included to VS 2010 and Microsoft is <a href="http://www.microsoft.com/Presspass/press/2010/mar10/03-16MIX10Day2PR.mspx">contributing</a> to jQuery as well. Code uses simple and cool effect of fadeOut slideDown effect, just to make application bit more attactive.
<br />
<br />
<blockquote><code><font size="2" face="Courier New" color="black"><font color="#0000ff">function</font> onForgotPasswordClick() {<br>&nbsp;&nbsp;<font color="#0000ff">var</font> email = $(<font color="#A31515">'#email'</font>).val();<br>&nbsp;&nbsp;<font color="#0000ff">var</font> secret = $(<font color="#A31515">'#secret'</font>).val();<br><br>&nbsp;&nbsp;$(<font color="#A31515">"#resultsdiv"</font>).fadeOut(<font color="#A31515">"fast"</font>, <font color="#0000ff">function</font>() {<br>&nbsp;&nbsp;&nbsp;&nbsp;removeClasses();<br>&nbsp;&nbsp;&nbsp;&nbsp;WebApplication.Services.ForgotPasswordService.RestorePassword(email, secret, onMethodSucceeded, onMethodFailed);&nbsp;&nbsp;<br>&nbsp;&nbsp;});&nbsp;&nbsp;<br>}<br><br><font color="#0000ff">function</font> onMethodSucceeded(results, args) {<br>&nbsp;&nbsp;<font color="#0000ff">var</font> password = results;<br><br>&nbsp;&nbsp;<font color="#0000ff">if</font> (password == <font color="#0000ff">null</font>) {<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).addClass(<font color="#A31515">"red"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).html(<font color="#A31515">"Your email or secret phrase is invalid"</font>);&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;<font color="#0000ff">else</font> {<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).addClass(<font color="#A31515">"green"</font>);<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).html(<font color="#A31515">"Your password: "</font> + password);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;$(<font color="#A31515">"#resultsdiv"</font>).slideDown(<font color="#A31515">"fast"</font>);<br>}<br><br><font color="#0000ff">function</font> onMethodFailed(error) {<br>}<br><br><font color="#0000ff">function</font> removeClasses() {<br>&nbsp;&nbsp;<font color="#0000ff">if</font> ($(<font color="#A31515">"#results"</font>).hasClass(<font color="#A31515">"green"</font>)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).removeClass(<font color="#A31515">"green"</font>);<br>&nbsp;&nbsp;} <font color="#0000ff">else</font> <font color="#0000ff">if</font> ($(<font color="#A31515">"#results"</font>).hasClass(<font color="#A31515">"red"</font>)) {<br>&nbsp;&nbsp;&nbsp;&nbsp;$(<font color="#A31515">"#results"</font>).removeClass(<font color="#A31515">"red"</font>);<br>&nbsp;&nbsp;}<br>}<br></font><br><font size="1" color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font size="1" color="gray">Source Code Highlighter</font></a>.</font></code></blockquote><br />
<br />
<h2>Results</h2>
<br />
As soon as I input some wrong data into email/secret phase control, I'll see fadding out div that informs me about problem. Like that,
<br />
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ6CkSb6rI/AAAAAAAAG1Y/zEBpoU-wqEw/s1600/real-forgetpass.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 252px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ6CkSb6rI/AAAAAAAAG1Y/zEBpoU-wqEw/s400/real-forgetpass.png" border="0" alt=""id="Img2" /></a>
<br />
<br />
But if I put correct values where, I'll get my password back:
<br />
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ6PBrttTI/AAAAAAAAG1g/iiJV3ATah3o/s1600/real-forgetpasscorrect.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 252px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TCZ6PBrttTI/AAAAAAAAG1g/iiJV3ATah3o/s400/real-forgetpasscorrect.png" border="0" alt=""id="Img3" /></a>
<br />
<br />
<h2>Conclusions</h2>
<br />
Nowadays it is even hard to imagine serious web application with out AJAX. It is mostly everywhere. Because of such usabilty and popularity a lot of vendors proposing tools and framework to hanlde common AJAX issues. And of cause, tools for working with AJAX is started to be included to .NET framework. ScriptManager is only one part of it framework. For futher exploration I would recomend to look on ASP.net AJAX Toolkit that is build upon .Net framework abilitites and propose a lot of interesting controls. Moreover, it is <a href="http://ajaxcontroltoolkit.codeplex.com/SourceControl/list/changesets">open source</a> and you can go ahead and hack it or contribute it.
<br />
<br />
<h2>Sources</h2>
<br />
<p>
Sources are available on GitHub: <a href="http://github.com/alexanderbeletsky/Concept">http://github.com/alexanderbeletsky/Concept</a>
</p>

<!-- AddThis Button BEGIN -->
<div><a expr:addthis:title='data:post.title' expr:addthis:url='data:post.url' class='addthis_button'><img src="http://s7.addthis.com/static/btn/v2/lg-share-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=xa-4c30246f249329c8"></script></div>
<!-- AddThis Button END --></div>

]]></content>
  </entry>
  
</feed>
