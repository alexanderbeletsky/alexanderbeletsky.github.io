
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Beletsky's development blog</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="A little bit on Javascript magic inside C# code Jul 15th, 2011 CSharp, JavaScript C# and Javascript are both my favorite languages. I believe that &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/blog/page/12/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><div class="blog-index">
  
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/07/little-bit-on-javascript-magic-inside-c.html">
    
      A little bit on Javascript magic inside C# code</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-07-15T17:28:00+03:00" pubdate data-updated="true">Jul 15<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/csharp/'>CSharp</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
C# and Javascript are both my favorite languages. I believe that those two are best languages in a world (perhaps I haven&#8217;t started to learn Ruby). With a quite long practice in Javascript, you start to feel real power of dynamic language. Even more, you are so much get used for particular code constructions that you try to do the same things in C#.
</p>
<p>
This is something you might do in javascript a lot. Consider that code, 
</p>
<a href="https://lh5.googleusercontent.com/-SXBYeXIMuWE/TiBNuueuVYI/AAAAAAAAHiA/vNR2Z8ttvPA/code-0.png">
<img src="https://lh5.googleusercontent.com/-SXBYeXIMuWE/TiBNuueuVYI/AAAAAAAAHiA/vNR2Z8ttvPA/code-0.png" alt="code" />
</a>
<p>
Method <code>createConfig</code> takes options object, dynamically construct <code>config</code> object and returns it back to client. Maybe it is the best example, but shows - I dynamically able to construct an object, just putting new properties into it.
</p>
<p>
Now, let&#8217;s try to do that same with C#. Believe me or not, but I can do exactly (OK, mostly exactly) code with C#.
</p>
<a href="https://lh3.googleusercontent.com/-WbEQBh89yfI/TiBNuo2MoAI/AAAAAAAAHiE/SeXq-aI6LvY/code-1.png">
<img src="https://lh3.googleusercontent.com/-WbEQBh89yfI/TiBNuo2MoAI/AAAAAAAAHiE/SeXq-aI6LvY/code-1.png" alt="code" />
</a>
<p>
We can play &#8220;Find a difference&#8221; game here. Anyway, what I can say: <strong>&#8220;anonymous types + dynamic + ExtendoObject&#8221;</strong>, is a magic spell that turn you C# code into Javascript.
</p>
<ul>
<li>
With <a href="http://msdn.microsoft.com/en-us/library/bb397696.aspx">Anonymous Types</a> you easy get a notion of JavaScript dynamic object, just use <code>new { MyProp = 1 }</code> JavaScript analog <code>{ MyProp: 1 }</code>.
</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/dd264741.aspx">Dynamic</a> would tell to compiler - &#8220;Do not check my type now, let Runtime do that&#8221;. So, with dynamic objects you can do <code>obj.MyProp</code>, compiler would allow this code, existence of property would be checked on runtime, if absent - exception will be thrown.
</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/system.dynamic.expandoobject.aspx">ExpandoObject</a> is a super-power of .NET, allows you to construct object at runtime. You can see, that I just assign new property, that property would be dynamically added to <code>config</code> object.
</li>
</ul>
<p>
Life would not be so interesting if every thing is so easy. My first implementation failed to work, in line <code>if (option.Ip || option.Proto)</code> then I called <code>createConfig</code> with object that actually contains no such properties. As I said above, dynamic simply throws an exception if property is missing. I could wrap code in some <code> try / catch</code> cases, but it would be to ugly and magic would gone. We have to extend our magic formula with one component - Reflection. So, let&#8217;s pronounce spell again, <strong>&#8220;anonymous types + dynamic + ExtendoObject + Reflection&#8221;</strong> and check out final secret piece of code.
</p>
<p>
<code>DynamicProxy</code> is simple wrapper around the dynamic, it overloads [] operator and check availability of property using Reflection.
</p>
<a href="https://lh5.googleusercontent.com/-wfeh6lG_zto/TiBNusNGmeI/AAAAAAAAHh8/ca_7jCdHEsk/code-2.png">
<img src="https://lh5.googleusercontent.com/-wfeh6lG_zto/TiBNusNGmeI/AAAAAAAAHh8/ca_7jCdHEsk/code-2.png" alt="code" />
</a>
<p>
That&#8217;s it. I&#8217;ve made C# code look like and behave like JavaScript, utilizing power of .NET platform. As always, you can find a source code on github - <a href="https://github.com/alexanderbeletsky/csharp-js">csharp-js</a>.
</p>
<h2>Disclaimer</h2>
<p>
You should not probably doing such tricks a lot. C# is still static language (even with dynamic features in it). It is better to rely on types, wherever it is possible to.. The code above is created to solve my particular problem and I had a lot of fun detecting this C# and JavaScript analogy. But now I still thinking to re-write that to statically typed less-beauty, less-magic solution :). 
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/07/switching-from-aspx-to-razor-view.html">
    
      Switching from ASPX to Razor view engine</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-07-14T16:22:00+03:00" pubdate data-updated="true">Jul 14<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
I&#8217;ve been moving my <a href="http://trackyt.net">application</a> to MVC3 quite time ago. There was absolutely no issues of migration, everything that worked OK in MVC2 worked fine with MVC3. One of major feature that MVC3 brings with is Razor. Razor is view engine which combines HTML and code in very elegant fashion. Just from first sight to Razor you begin to understand how much ASPX sucks (I don&#8217;t blame ASPX since it has been designed for WebForms, actually.. and it just does not fit MVC much). 
</p>
<p>
Of cause, till that time I had a lot of already made markup with ASPX. I have register <a href="https://github.com/alexanderbeletsky/trackyt.net/issues/80">task</a> to switch all my views to Razor. But for a long time it&#8217;s being un-touched, I just been either doing some other things or too lazy for that kind of job. Yes, it is not very exiting to change *.aspx to *.cshtml.. Finally I put all my will on that, thinking better late than never.
</p>
<p>
And you know, it was not so difficult and boring as I originally thought. Here are some obvious tips: 
</p>
<ul>
<li>Rename file from *.aspx to *.cshtml</li>
<li>If you have master page like (Public.Master) change it to _PublicLayout.cshtml (Razor don&#8217;t use term Master, but rather Layout)</li>
<li><code>&lt;%@ Control Language=&quot;C#&quot; Inherits=&quot;System.Web.Mvc.ViewUserControl&lt;Web.Models.LastArticleFromBlogModel&gt;&quot; %&gt;</code> became <code>@model Web.Models.LastArticleFromBlogModel</code></li>
<li>
<code>&lt;asp:ContentPlaceHolder ID=&quot;head&quot; runat=&quot;server&quot;/&gt;</code> became <code>@RenderSection("Head", required: false) in Layout pages</code>
</li>
<li><code>&lt;asp:ContentPlaceHolder ID=&quot;maincontent&quot; runat=&quot;server&quot;&gt;</code> became <code>@RenderBody() in Layout pages</code></li>
<li><code>&lt;%@Import Namespace=&quot;Web.Helpers.Extensions&quot; %&gt;</code> became <code>@using Web.Helpers.Extensions</code></li>
<li><code>&lt;%: </code> are changed to <code>@</code> and <code>%&gt;</code> changed to nothing (I simply used Find&Replace for that)</li>
<li>At the top of content page
<code><pre>@{
 ViewBag.Title = "Admin | Admin Dashboard";
 Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}</pre></code>
</li>
<li>For content pages, everything that is inside is Body (no special sections for that)</li>
<li>If you need to override Head section, simply <code>@section Head { }</code></li>
<li>Layout could be nested, in nested Layout page you should mention parent Layout, like above</li>
</ul>
<p>
That&#8217;s basically it.. Along the way I&#8217;ve changed all HTML to comply HTML5 standard and reformatted (with Ctrl K + Ctrl D) and now markup looks definitely better!
</p>
<p>
One really strange issue I should mention. As soon as I finished and pushed code to github my friend <a href="http://trackyt.net:8080/">Jenkins</a> immediately picked up changed and deployed them. But I as went to check it, I got 404 Error just from very beginning. After investigation I found the reason - as I was just renaming files *.aspx to *.cshtml, in *.csproj (project file) all of them are became in &#8220;None&#8221; item, instead on &#8220;Content&#8221;.. and site publishing just ignored that items. I have to manually change it back, as soon as I <a href="https://github.com/alexanderbeletsky/trackyt.net/commit/ef3868077e6307747724c464075475512037738e">committed</a>, it started to work like charm.
</p>
<p>
So, there are no any technical issues with moving from ASPX to Razor, just don&#8217;t be to lazy and do it today :)
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/07/git-with-svn-what-benefits-are.html">
    
      Git with SVN, what the benefits are?</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-07-13T08:50:00+03:00" pubdate data-updated="true">Jul 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/git/'>Git</a>, <a class='category' href='/blog/categories/gitsvn/'>GitSVN</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
My previous <a href="http://www.beletsky.net/2011/06/how-to-start-using-git-in-svn-based.html">post</a> about starting up of using Git inside on SVN organization appeared to be really attractive, I received many questions through <a href="http://twitter.com/#!/alexbeletsky">twitter</a> and <a href="http://java.dzone.com/articles/how-start-using-git-svn-based">dzone</a>. All of them are really interesting and I going to do a separate posting on that, but primary question is &#8220;Why, oh why?&#8221;.  
</p>
<p>
So, what actual benefits I see by using approach of git-svn?
</p>
<p>
First, let&#8217;s see the root, what kind of VCS Git is? It is distributed one. The distribution basically means that each developer host the repository on it&#8217;s own machine. Not a working copy as in SVN case, but real repository with all corresponding functionality - commits, reverts, branches, merges etc. You are not longer depend on server, even if sever is not available you still able to continue your job. 
</p>
<p>
Since you have your local repository, you can do whatever you want without interfering the rest of the world. In SVN all operations like commit or branch creation or tag - they are global one. As soon as you created branch for instance, everybody will notice that; if you committed something, everybody will notice that. In many organizations SVN has policies, like you have access only for some branches.. you can&#8217;t create branches, only by request to admin etc. But, what I basically do on my job - I want to try out something (new idea or apply some refactoring) without disturbing a lot of people, I want that quickly. It perfectly works with Git, I create the branch just by one command, work inside (means do what ever number of commits I want) and if I think I&#8217;m ready, merge it back to master and push changes to SVN.
</p>
<p>
Remember you last merge operation with SVN? If you haven&#8217;t seen &#8216;Tree conflict&#8217; type of conflict, you are not SVN user. I&#8217;ve seen them a lot and many people suffer much of it! This type of conflict happens because SVN keeping and tracking information about folder in which file is placed. Git does not do that, it is basically content tracking system - Git cares about content of the file, not file it self. Since the information about content (blob) and filesystem information (tree) is separated each of other, you will never get a &#8216;Tree conflict&#8217; in Git.
</p>
<p>
By the fact that branches and merges are very easy in Git you are getting one really cool bonus. Have you ever been in situation then in a middle of your flow, then tens files are already changed, but you still struggling with task, your boss is contacting you saying - &#8216;Hey, we have critical bug, required to be fixed now&#8217;? Such things make you a little uncomfortable, you already got some changes, but they are not &#8216;commitable&#8217;.. you could not throw it away, because some value is already there, but you need to get SVN update and start to fix bug. With git, you can switch from one task to another with out any problems. You just commit your results (even if they are not compliable or tests are red, who cares - it&#8217;s yours repository) create another branch for bugfix and start to work.  
</p>
<p>
To summarize that a little I would say that my personal benefits of starting using Git are: 
</p>
<ul>
<li><strong>Isolation</strong> - do whatever I want, whenever I want</li>
<li><strong>Merges</strong> - forget about &#8216;Tree conflicts&#8217;</li>
<li><strong>Task switching</strong> - no more, &#8220;please wait till I commit this, so I can start to work on that&#8221;</li>
<li><strong>Fun</strong> - it is interesting to me to learn new system and to change a mind how VCS can work</li>
</ul></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/07/inside-aspnet-mvc-controllerbuilder.html">
    
      Inside ASP.NET MVC: ControllerBuilder class</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-07-09T12:28:00+03:00" pubdate data-updated="true">Jul 9<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
Integral part of <code>MvcHanlder</code> is <code>ControllerBuilder</code>. <code>ControllerBuilder</code> is a singleton that is responsible to produce <code>IControllerFactory</code> instance. 
</p>
<a href="https://lh6.googleusercontent.com/-DCwP650y9-U/ThgeFaCgXPI/AAAAAAAAHgU/A0dkfOHBGqo/controllerbuilder-0.png">
<img src="https://lh6.googleusercontent.com/-DCwP650y9-U/ThgeFaCgXPI/AAAAAAAAHgU/A0dkfOHBGqo/controllerbuilder-0.png" alt="controller builder" />
</a>
<h2>Construction</h2>
<p>
<code>ControllerBuilder</code> have 2 constructors, the default one and one with parameter. One of the major changes between MVC2 and MVC3 was the improvements of <a href="http://bradwilson.typepad.com/blog/2010/07/service-location-pt1-introduction.html">Dependency Injection</a>. MVC is using <a href="http://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator</a> pattern for resolving dependencies.Default constructor calls constructor with parameter, passing <code>null</code> as argument, saying that <code>SingleServiceResolver</code> object have to be used as default service resolver.
</p>
<p>
Please note, even if MVC is using Service Locator to locate different entities (like Controllers, Views, Filters) and so on, it does not include any kind on IoC frameworks itself. 
</p>
<h2>Controller factory get/set</h2>
<p>
<code>MvcHanlder</code> uses <code>GetControllerFactory</code> method to get controller factory.
</p>
<a href="https://lh5.googleusercontent.com/-NVekFX42y9E/ThgeFNkIbvI/AAAAAAAAHgM/r_r--YJdVco/controllerbuilder-1.png">
<img src="https://lh5.googleusercontent.com/-NVekFX42y9E/ThgeFNkIbvI/AAAAAAAAHgM/r_r--YJdVco/controllerbuilder-1.png" alt="controller builder" />
</a>
<p>
Method itself is fairly simple, it just ask service resolver to get current instance of controller factory. 
</p>
<p>
Setter method allows you to change default controller factory with custom one. This an extremely useful then you want to change the way of Controller creation. The most useful case is delegate the controller creation to some DI container (Ninject, Unity, StructureMap) to allowing your application to get benefits of using IoC principles.
</p>
<p>
Basically, IControllerFactory is a strategy of controller creation. Depending of implementation it might use different techniques, later on we will see how <code>DefaultControllerFactory</code> works.
</p>
<p>As and additional option, it is possible to supply custom controller factory just from the specific type</p>
<a href="https://lh3.googleusercontent.com/-5z7-swBhCaI/ThgeFWwleXI/AAAAAAAAHgQ/En6NIHHkYWY/controllerbuilder-2.png">
<img src="https://lh3.googleusercontent.com/-5z7-swBhCaI/ThgeFWwleXI/AAAAAAAAHgQ/En6NIHHkYWY/controllerbuilder-2.png" alt="controller builder" />
</a>
<h2>Substitute default controller factory</h2>
<p>
As you see, we have to options of substitution default factory: 
</p>
<ol>
<li>Call SetControllerFactory method and pass custom object into.</li>
<li>Implementing new IDependencyResolver.</li>
</ol>
<p>
Here is an example of how that could be done (please note, it is just demostartion.. you typically should not use both approaches in the same type).
</p>
<a href="https://lh3.googleusercontent.com/-wolhzYhyE1w/ThgeFF2OawI/AAAAAAAAHgI/fLPsMlTuAzQ/controllerbuilder-3.png">
<img src="https://lh3.googleusercontent.com/-wolhzYhyE1w/ThgeFF2OawI/AAAAAAAAHgI/fLPsMlTuAzQ/controllerbuilder-3.png" alt="controller builder" />
</a>
<h2>Conclusions</h2>
<p>
<code>ControllerBuilder</code> is simple class that delegates responsibility to <code>IResolver</code> which is responsible to resolve <code>IControllerFactory</code> instance. <code>IControllerFactory</code> is a strategy of controllers creation. <code>ControllerBuilder</code> is designed in a way of chaning this strategy easily, either by using custom <code>IControllerFactory</code> or by custom <code>IDependencyResolver</code>.
</p>
<h2>What is next?</h2>
<p>
Next we are going to look closer into <code>SingleServiceResolver</code> and see how it actually acts for resolving types.
</p>
<p>
Previous: <a href="http://www.beletsky.net/2011/06/inside-aspnet-mvc-all-begins-here.html">Inside ASP.NET MVC: All begins here - MvcHanlder</a>
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/how-to-start-using-git-in-svn-based.html">
    
      How to start using Git in SVN-based organization</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-29T22:04:00+03:00" pubdate data-updated="true">Jun 29<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/git/'>Git</a>, <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/gitsvn/'>GitSVN</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
I&#8217;ve been using Git about a year now, immediately after creation my <a href="https://github.com/alexanderbeletsky">github</a> account. I got really nice impression of using this tool, but still - on my primary job at <a href="http://www.e-conomic.com/">e-conomic</a> we are using SVN as primary VCS tool.
</p>
<p>
You are probably aware about all good thing with Git. If you still don&#8217;t you might check out these great <a href="http://stackoverflow.com/questions/871/why-is-git-better-than-subversion">answers</a> on Stackoverflow. In short - Git adds benefits, but it adds complexity as well. 
</p>
<p>
After a bit evaluation I found that those benefits are worth to stop using SVN and switch to Git. But, if you ask your colleagues &#8220;Are you ready to go with Git?&#8221; you would probably hear &#8220;No!&#8221;. It is clear why, people are getting used to current tools.. infrastructure are build around them. And switching from one VCS to another seemed as destruction of building fundament for many developers.
</p>
<p>
Fortunately, Git has a killer feature that other DVCS does not have! And this feature will help you to smoothly start with Git even if your company is still using SVN as standard. Yes, I&#8217;m talking about <a href="http://www.kernel.org/pub/software/scm/git/docs/git-svn.html">git-svn</a>. 
</p>
<p>
Believe me, it is amazing! I always have a little distrust for such kind of integration tool, but so far it works as charm. So, I&#8217;ll give you a small instructions that will make you possible to get to your office tomorrow and start use Git as your own VCS.  
</p>
<h2>Setup you environment</h2>
<ul>
<li>
Download and install <a href="http://code.google.com/p/msysgit/downloads/detail?name=Git-1.7.4-preview20110204.exe&can=2&q=">msysgit</a> 
</li>
<li>
Setup local user information, example
<pre>
    git config --global user.name “alexander.beletsky”
    git config --global user.email “alexander.beletsky@gmail.com”
</pre>
</li>
<li>
If you are on Windows and doing only-Windows development, it is recommended to turn off <code>autocrlf</code>
<pre>
    git config core.autocrlf false
</pre>
</li>
</ul>
<h2>Checking out code from SVN repository</h2>
<ul>
<li>
Run git clone command (it might take some time, depending on repository and history size)
<pre>
    git svn clone https://mysvnserver/repo 
</pre>
</li>
</ul>
<p>
As clone finished, you will see that new folder <code>repo</code> created with the content of your SVN repository. Now, this folder is actually Git repository + you local sources copy. Try to run <code>git log</code> inside the repository and you will see that all your history are there!
</p>
<h2>Let&#8217;s do some work</h2>
<p>
Now, suppose you start to work on some bugfix. By default, git repository contains one branch called <code>master</code>. Good style is do not do direct commits into master at all, just keep it as synchronization point between SVN repository and your local repository. So, to do actual job you to create branch.
</p>
<pre>
    git checkout -b bugfix-id-1453
</pre>
<p>
This command will create new branch called <code>bugfix-id-1453</code> and immediately switch to it. If you haven&#8217;t noticed how that happened - please welcome to git&#8217;s high performance world.
</p>
<p>
You changed some file and ready to commit. In git it&#8217;s a 2 steps operation. First, you need to put content to stage.. second, you store the content in new commit object.
</p>
<pre>
    git add .
    git commit -m "issue has been fixed"
</pre>
<h2>Commit changes back to SVN</h2>
<p>
You&#8217;ve fixed a bug and now fixed is placed in <code>bugfix-id-1453</code>. But you should give it back to rest of the world. 
</p>
<p>
Checkout your master branch:
</p>
<pre>
    git checkout master
</pre>
<p>
Get the latest changes from SVN:
</p>
<pre>
    git svn rebase
</pre>
<p>
Now SVN server and local master branch are identical. We have to merge our fix into master:
</p>
<pre>
    git merge bugfix-id-1453
</pre>
<p>
Now master contains previous SVN state + new fix. We have to synchronize local repository and SVN server:
</p>
<pre>
    git svn dcommit
</pre>
<h2>Conclusions</h2>
<p>
Git-svn is perfect tool to start using git without radical changes in organization. It gives everybody change to try it out, how much it really fits your needs. I&#8217;m having a big pleasure now of working with Git. I&#8217;m not saying it&#8217;s ideal smooth process, sure I met some difficulties. But for me those difficulties are nothing comparing the benefits I&#8217;m getting with it.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/thinking-about-cloud.html">
    
      Thinking about cloud..</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-22T10:09:00+03:00" pubdate data-updated="true">Jun 22<span>nd</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/cloud/'>Cloud</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<img src="http://t0.gstatic.com/images?q=tbn:ANd9GcStTBpwTeKUQEuBeVN6mrRWGCQD3B-2scSFb_Yro1HLzMvXPW5_" alt="cloud" />
<p>
I&#8217;m really inspired with cloud ideas since I first time met it. No doubt, that clouds are future of computing. I like the metaphor comparing cloud and electric power plant: &#8220;Last century if you plan your business depend on electricity, you have to afford huge and expensive electric generator - you have to host it, support it and do all maintenance stuff by yourself. You pay for everything by yourself, just to be able to plug one device. Then power plant come and electric wires covered a country, you no longer need your own electric generator, you can buy the electricity from power plant station. You pay only for that you used and it is much cheeper, since a lot of people using it together with you&#8221;. Clouds are modern power plants - to be online you no longer need to buy servers, establish a data center, maintenance all infrastructure. You could by the resources from cloud services provider. 
</p>
<p>
Clouds are about to change the business. It is much more easy to start-up new product in web, since you have to care only about product, not infrastructure. I knew some companies in past with quite good ideas, but those ideas buried under infrastructure complexity and expensiveness. And the clouds are about to solve that problem, microISV should be happy about.
</p>
<p>
I was thinking about all my current and future products are going to in cloud for sure. First and obvious point to look was Microsoft Azure. But after some elaboration I disappointed a bit: 
</p>
<ol>
<li>Azure is overcomplicated. I&#8217;m not saying I&#8217;m not able to understand that.. But all those Roles, Processes, Blobs - it is just too much details. But what I basically waht is to place my <a href="http://trackyt.net">existing</a> working product into elastic space, that&#8217;s it.
</li>
<li>
It is still expensive. This Azure price calculator, my simplest configuration would be ~50 USD/month. This is more than I currently pay for VPS.
</li>
</ol>
<p>
So, I saw not enough reasons to switch immediately. 
</p>
<p>
Yesterday, I&#8217;ve been contacted by <a href="http://www.host1plus.com/">Host1Plus</a> company. They started out beta cloud in the new datacenter which is located in Frankfurt Main, Germany. And they are looking for beta testers of new service. The proposition looks really fine to me, since I could try the power of clouds and in the same time help a company with a feedback I could provide.  
</p>
<p>
I&#8217;m going to join. If it is interesting for you, join with me. Here is some links that could be helpful:
</p>
<ul>
<li><a href="http://www.host1plus.com/press/beta-cloud-vps-will-be-launched-by-host1plus/">http://www.host1plus.com/press/beta-cloud-vps-will-be-launched-by-host1plus/</a> press release about it</li>
<li><a href="http://www.host1plus.com/beta-invitations/">http://www.host1plus.com/beta-invitations/</a> mailing list for all the beta testers who wants to join the campaign</li>
<li><a href="http://www.host1plus.com/forum/">http://www.host1plus.com/forum/</a> the community forum where all beta testers can join to start the discussions</li>
</ul></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/inside-aspnet-mvc-all-begins-here.html">
    
      Inside ASP.NET MVC: All begins here - MvcHanlder</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-18T18:46:00+03:00" pubdate data-updated="true">Jun 18<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
<a href="http://www.beletsky.net/2011/06/inside-aspnet-mvc-route-to-mvchanlder.html">Last time</a> we explored a way of HTTP request from the IIS up to <code>MvcHanlder</code>. Then <code>UrlRouting</code> module match URL we registered in <code>Application_Start()</code>, it gets corresponding <code>IRouteHandler</code> class and calls for <code>GetHttpHandler</code> method. In ASP.NET MVC URL <code>IRouteHandler</code> interface is implemented by <code>MvcRouteHandler</code> class which return <code>MvcHanlder</code> instance. The actual MVC story begins exactly in <code>MvcHanlder</code> internals.
</p>
<h2>Generic overview</h2>
<p>
We know that HttpHandlers are special objects that handles requests and produce a response. <code>MvcHanlder</code> produce nothing by itself. Instead, it uses <code>ControllerBuilder</code> object for creating <code>Controller</code> and call controller <code>Execute</code> method. It is <code>Execute</code> method responsibility to find corresponding action, call action and wrap action return result it HTTP response.
</p>
<a href="https://lh5.googleusercontent.com/-oJHL461Fj-w/TfzI2KJsFaI/AAAAAAAAHe0/MDVtQS77gGw/handler.declaration.1.png">
<img src="https://lh5.googleusercontent.com/-oJHL461Fj-w/TfzI2KJsFaI/AAAAAAAAHe0/MDVtQS77gGw/handler.declaration.1.png" alt="mvc handler declaration" />
</a>
<p>
As you can see, it implements 3 interfaces: <code>IHttpHandler</code>, <code>IHttpAsyncHandler</code> and <code>IRequiresSessionState</code>. The handler could operate in 2 modes: sync and async, depending on caller. ASP.NET frameworks <code>ProcessRequestInternal</code> method try to utilize asynchronous mode of work first.
</p>
<p>
The constructor of <code>MvcHanlder</code> receives <code>RequestContext</code> class, that is part of System.Web.Routing and contains information about <code>HttpContext</code>.  
</p>
<h2>Synchronous and Asynchronous modes</h2>
<p>
Of course, the details of operation in synchronous and asynchronous modes are differ from each other, but main algorithm of work is exactly the same.. Let&#8217;s first see how it operates in sync mode.
</p>
<h2>Process the request</h2>
<p>
Due to <code>IHttpHandler</code> interface, <code>MvcHanlder</code> expected to support one property and one method:
</p>
<a href="https://lh4.googleusercontent.com/-GCULpCDs5Uk/TfzI1RGGfpI/AAAAAAAAHeo/XZ3FTPT_jMI/handler.declaration.2.png">
<img src="https://lh4.googleusercontent.com/-GCULpCDs5Uk/TfzI1RGGfpI/AAAAAAAAHeo/XZ3FTPT_jMI/handler.declaration.2.png" alt="mvc handler declaration" />
</a>
<p>
<code>IsReusable</code> is always false, meaning that for each request the runtime would create new instance of handler. <code>ProcessRequest</code> receives <code>HttpContext</code> and basically delegates call to internal <code>ProcessRequest</code> method.
</p>
<a href="https://lh3.googleusercontent.com/-D3MUti1Eh7g/TfzI3RIRXXI/AAAAAAAAHe8/ADmoHG1wnQo/handler.declaration.3.png">
<img src="https://lh3.googleusercontent.com/-D3MUti1Eh7g/TfzI3RIRXXI/AAAAAAAAHe8/ADmoHG1wnQo/handler.declaration.3.png" alt="mvc handler declaration" />
</a>
<p>
Notice to the first line.. <code>HttpContext</code> is being wrapped with <code>HttpContextWrapper</code> and casted to <code>HttpContexBase</code>. Rest of code never (mostly) using <code>HttpContext</code> directly, but through <code>HttpContexBase</code>. The <code>HttpContexBase</code> have been introduced to improve testability of ASP.NET applications, since <code>HttpContext</code> is unable to be mocked.
</p>
<h2>ControllerBuilder, ControllerFactory, Controller</h2>
<p>
Let&#8217;s see inside the <code>ProcessRequest</code> method to see how exactly the controller is being constructed and called.
</p>
<a href="https://lh5.googleusercontent.com/-hGQmALFmXyw/TfzI1BGwhQI/AAAAAAAAHek/Ts_T-BAo85U/handler.declaration.4.png">
<img src="https://lh5.googleusercontent.com/-hGQmALFmXyw/TfzI1BGwhQI/AAAAAAAAHek/Ts_T-BAo85U/handler.declaration.4.png" alt="mvc handler declaration" />
</a>
<p>
The call is wrapped with a little security handler, that would do perform the check for Trust settings, before calling internal action. Inside the action <code>IController</code> and <code>IControllerFactory</code> are being declared and initialized in <code>ProcessRequestInit</code> method.
</p>
<a href="https://lh4.googleusercontent.com/-8WV5t8II9XU/TfzI1qyxG8I/AAAAAAAAHes/PB4NiaWZJts/handler.declaration.5.png">
<img src="https://lh4.googleusercontent.com/-8WV5t8II9XU/TfzI1qyxG8I/AAAAAAAAHes/PB4NiaWZJts/handler.declaration.5.png" alt="mvc handler declaration" />
</a>
<p>
First, it puts MVC version information into HTTP response header, removes optional parameters from routes (one we mark with <code>UrlParameter.Optional</code>) and gets the name of controller from <code>RequestContext</code>. Remember, in global.asax we define URL pattern like &#8220;{controller}/{action}/{index}&#8221;, so in case of such URL <code>products/search/122</code> the <code>GetRequiredString</code> will return &#8220;products&#8221;.
</p>
<p>
<code>ControllerBuilder</code> is a singleton and factory method that creates <code>IControllerFactory</code> instance. 
</p>
<p>
<code>ControllerFactory</code> is responsible for creation of controller by given name. 
</p>
<p>
The <code>ProcessRequestInit</code> gets the factory from <code>ControllerBuilder</code>, ask factory to create controller by the name from URL and returns results back to <code>ProcessRequest</code>.
</p>
<p>
Here we also could see good example of comments that lies.. &#8220;// Instantiate the controller and call Execute&#8221; - maybe sometime ago that was true, but not its false since Execute is not called here. 
</p>
<h2>Execution</h2>
<p>
As soon as controller factory and controller are successfully created, <code>ProcessRequest</code> calls for controller <code>Execute</code> method. Now, it is controller responsibility to produce the output and we will see how it does that in next &#8220;Inside MVC&#8221; posts. Execution is wrapped inside <code>try / finally</code> block and finalize code will release the controller by calling <code>ReleaseContoller</code> method of factory.
</p>
<h2>Meanwhile in Asynchronous&#8230;</h2>
<p>
In async world the things are bit more complex. There are no one single method, but 2 instead. <code>BeginProcessRequest</code> and <code>EndProcessRequest</code>.
</p>
<p>
The request initialization and creation of factory and controller is exactly the same. The difference in execution, for async controller 2 delegates are being created, 
</p>
<a href="https://lh3.googleusercontent.com/--qjZrorgG88/TfzI1xDv_dI/AAAAAAAAHew/RvZm0UMDQ8k/handler.declaration.7.png">
<img src="https://lh3.googleusercontent.com/--qjZrorgG88/TfzI1xDv_dI/AAAAAAAAHew/RvZm0UMDQ8k/handler.declaration.7.png" alt="mvc handler declaration" />
</a>
<p>
In fact, that than the request execution begins, <code>beginDelegate</code> is called that would call <code>BeginExecute</code> of the controller. At the end of request <code>endDelegate</code> called that would call <code>EndExecute</code> of controller.
</p>
<h2>What about tests?</h2>
<p>
That was a great surprise to me that <code>MvcHandler</code> is well unit tested. All aspects of its work are covered with corresponding tests.. I&#8217;ve heard a lot of developers complains like, &#8220;oh, it is so low-level code.. could not test it&#8221;. But MVC team, proof it is wrong. <code>HttpContexBase</code> could be easy mocked, so no excuse of not writing unit tests for modules/handlers. As I said in into, test code is really clean, following AAA principle&#8217;s, so I got a lot of pleasure of looking inside.
</p>
<p>
BTW, they are using <a href="http://code.google.com/p/moq/wiki/QuickStart">Moq</a> framework for mocking, that I personally like as well :).
</p>
<p>
Previous: <a href="http://www.beletsky.net/2011/06/inside-aspnet-mvc-route-to-mvchanlder.html">Inside ASP.NET MVC: Route to MvcHandler</a>
Next: <a href="http://www.beletsky.net/2011/07/inside-aspnet-mvc-controllerbuilder.html">Inside ASP.NET MVC: ControllerBuilder class</a>
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/candidatenet-application-i-made-on.html">
    
      Candidate, Application I Made on Hackatone</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-13T19:26:00+03:00" pubdate data-updated="true">Jun 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/candidate/'>Candidate</a>, <a class='category' href='/blog/categories/hackatone/'>Hackatone</a>, <a class='category' href='/blog/categories/open-source/'>Open source</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>Here is quick description of application application I made on <a href="http://www.beletsky.net/2011/06/hackatone-in-kiev-11-12-june.html">Hackatone</a> this weekend. </p><p>Candidate.net is just working name for the project that I&#8217;m going to change as soon as I got better idea :). It supposed to be a kind of service that provides integration with your github repositories and provides a Continues Deployment cycle for that repositories. Namely, every code change that being pushed to github is immediately build, tested and deployed, so the time between code push and production is very short excludes any manual work. </p><p>I&#8217;ve spent ~16 hours for building up this application, sure I haven&#8217;t managed to make it as a service.. but - during the process I&#8217;ve changed my vision for project, so first I would like to create good continues build engine (like Team City or Jenkins) and base my future service on top of it (yeah, I already got some further plans :). </p><p>Technologies behind: </p><ul><li>ASP.NET MVC3</li>
<li>jQuery + some small pluggins</li>
<li>UppercuT build framework</li>
</ul><p>A picture says 1000 words, so here my little screencast of Candidate.net in action. It demonstrates the ability of setting up new application and hooking github push requests to build new application instance. </p><iframe src="http://www.screenr.com/embed/X48s" width="560" height="345" frameborder="0"></iframe> <p>Source code is hosted on github <a href="https://github.com/alexanderbeletsky/candidate">https://github.com/alexanderbeletsky/candidate</a>. Don&#8217;t forget it is really early prototype, the code is in big mess now.. I&#8217;m going to improve it much soon, so please keep watching repository. </p><p>I had a lot of fun of building this and have a better vision of how the application should look like. Hope to share it soon. I would be happy to hear some feedback on this.. and of cause you are free to fork repo and make your improvement (especially in UI/UX :). </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/hackatone-in-kiev-11-12-june.html">
    
      Hackatone in Kiev 11-12 June</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-13T14:44:00+03:00" pubdate data-updated="true">Jun 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/hackatone/'>Hackatone</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
This weekend I&#8217;ve been visiting very interesting event - <a href="http://www.developers.org.ua/calendar/615/">Hackatone</a> that took place in <a href="http://www.ciklum.net/">Ciklum</a> office. Hackatone is whole night hacking session there every team or person could came up with any idea, implement it and present to crowd. Many times I heard about similar events either in podcasts or blogs that I read.. but never tried that myself. Thank&#8217;s for <a href=""http://www.developers.org.ua/">DOU</a> enthusiasts I got opportunity to try that. Here is my report of that event. There would be some mix of English and Russian language, hope that would not make you confuse :)
</p>
<p>
The event began with common meeting there people were sharing ideas of applications they are going to build. During my pretty long journey with in <a href="http://www.beletsky.net/2011/05/continuous-production-make-it-work.html">Continues Production</a> I already got my idea - I wanted to build Deployment-as-Service product that easily integrated with github and utilizes power of UppercuT for building .NET web applications. There was very few .NET developers there, already having their own ideas to build.. so I went alone. 
</p>
<p>
If you have been to Ciklum office, you probably know what SkyPoint is.. It is 20-th floor in office that resides on one Kiev&#8217;s hills, so you might imagine this exceptional view from there. I grabbed a chair started to work. 
</p>
<p>
Due to experience I got with .NET deployments and Jenkins I had pretty much well understanding what the workflow should be. I&#8217;ve created ASP.NET MVC3 in my Visual Studio and stared to develop. The scope of work I planned to do was pretty much big and I a little nervous about my ability to finish everything. I tried to work as fast as I can.. Full hour, that 10 minutes break and full hour again. Maybe because of that creative atmosphere around or straight orientation on final result but I think I really got a <a href="http://en.wikipedia.org/wiki/Flow_(psychology)">Flow</a>..
</p>
<p>
So, after ~3 hour of work I&#8217;ve created my github repository for new project - Candidate.net:
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79592735673303040">
<img src="https://lh5.googleusercontent.com/-EB45A9ltPj4/TfX3yjW1xBI/AAAAAAAAHeQ/6flibleXfdk/tweet-github.png" alt="tweet" />
</a>
<p>
Keeping that rhythm I continued to work mostly till 3.00 AM.. About 60% of work were done. I felt a little tired and decided to stop for today and had a good sleep to continue tomorrow. My plans were ruined as soon as I stepped to 19th there people gathered together.. So, in 5 minutes I got several shots of cognac and was sitting on a floor with guitar in my hands :). I had a real fun and relax there. Haven&#8217;t noticed at all how 2 hours are gone and sun started to rise.. We had a really nice moment of meeting new day on staying on office balcony. 
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79730442869293056">
<img src="https://lh5.googleusercontent.com/-YoDuw9t7AxU/TfX3yt71IQI/AAAAAAAAHeI/GZ-utUiR0IQ/tweet-morning.png" alt="tweet" />
</a>
<p>
I have to continue the implementation, so I went back to SkyPoint and run my Visual Studio again. Of cause I could not get such rhythm as I got yesterday, the process were much slower. I had to refuse of several more ideas I wanted to build, ignore the rules of Clean Code, SOLID and DRY. Did some ugly tricks, just to make application work. I had issues with testing and deployment since WiFi connection were quite slow. But, long story short - I implemented very basic workflow and realized that would be it for presentation.
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79814256295550976">
<img src="https://lh5.googleusercontent.com/--LWi6MlSOjo/TfX3ysS1-WI/AAAAAAAAHeM/XdE5KC4fx5w/tweet-done.png" alt="tweet" />
</a>
<p>
I found a sofa and finally got a change to have a sleep. Don&#8217;t know why but I managed to sleep only for one hour, just woke up and could not sleep again. So, I had a shower (yes, there are showers in Ciklum office), coffee.. and very nice breakfast. I had some time before presentation began, so I re-tested my application several times more and was happy about results. 
</p>
<p>
At 15.00 PM presentations began! I showed Candidate.net ability to initialize new application, build and deploy it in minutes.. How you can deliver with just a push a code to github, the rest of job done by Candidate. I don&#8217;t think I really impress people there, because of .NET crowd were to small.. but I tried to do best. After the presentation I&#8217;ve been contacted by several guys who interested with such concept.
</p>
<p>
Most of the presented projects were either old-school games implemented with new technologies or mobile applications. One guys did a nice linux kernel exploration and share his ideas. 
</p>
<p>
After there was a manual voting for each project to decide on 3 best, I didn&#8217;t win :). Winners got their congratulations and presents for sponsors. I quit really quickly since I was a little late for my friend wedding that was that day :) 
</p>
<p>
That was really nice experience for me. I appreciate <a href="http://www.ciklum.net/">Ciklum</a>, <a href=""http://www.developers.org.ua/">DOU</a> and everyone involved, who make that possible. Thank you guys :)
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/inside-aspnet-mvc-route-to-mvchanlder.html">
    
      Inside ASP.NET MVC: Route to MvcHandler</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-06T10:28:00+03:00" pubdate data-updated="true">Jun 6<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
In my <a href="http://www.beletsky.net/2011/05/inside-aspnet-mvc-setting-up-project.html">previous post</a> I promised to start with exploration of <code>MvcHanlder</code> as entry point of ASP.NET MVC application. <code>MvcHandler</code> plays the major role in MVC infrastructure, but as I fugured out - the whole story does not begin there. The story is actually begins inside ASP.NET framework.
</p>
<h2>ASP.NET framework</h2>
<p>
ASP.NET framework is heart of ASP.NET MVC application. Basically, ASP.NET is a request processing engine. It takes incoming request as input and sends it through <i>internal pipeline</i> till the <i>end point</i>. The architecture allows extensibility, you could plug either into pipeline (modules) or end points (handlers). Interesting fact that ASP.NET designed to be decoupled from actual request source. So, the source of request could be any application - IIS, Cassini or any custom one.
</p>
<p>
We could imagine that each request pass through the set of filters (<i>internal pipeline</i>) lands up on request handler (<i>end point</i>), request handler creates a response object and sent it back. There are a lot of hidden details of dealing with managed/unmanaged code that you could find in this <a href="http://www.west-wind.com/presentations/howaspnetworks/howaspnetworks.asp">brilliant article</a> by Rick Strahl. 
</p>
<p>
For us it is important to understand two basic abstractions, HttpModules and HttpHandlers.
</p>
<h2>HttpModules and HttpHandlers</h2>
<p>
From the developers point of view the difference between those are: one implements <code>IHttpModule</code> interface another implements <code>IHttpHandler</code> interface. 
</p>
<p>
<strong>Module</strong> participates in the request processing of every request in order to change or add to it in some way.  
</p>
<p>
<strong>Handler</strong> is responsible for handling the request and producing the response for specific content types.  
</p>
<p>
ASP.NET MVC is HttpHandler. 
</p>
<a href="https://lh3.googleusercontent.com/-8EBxpoh7R0w/Tex-Zo80FfI/AAAAAAAAHc8/eMI-FEEurCg/mvchandler.png">
<img src="https://lh3.googleusercontent.com/-8EBxpoh7R0w/Tex-Zo80FfI/AAAAAAAAHc8/eMI-FEEurCg/mvchandler.png" alt="MVC handler" />
</a>
<p>
There a bunch of default HttpModules and HttpHandlers in your IIS configuration. Just take a look here - %WINDOWS%\Microsoft.NET\Framework\v4.0.30319\Config\web.config. 
</p>
<p>
But if you look closer you won&#8217;t notice any mention of <code>System.Web.Mvc.MvcHanlder</code>. Hey. what&#8217;s wrong? How the runtime actually knows that <code>MvcHanler</code> have to be called to handle our request? That was absolutely unclear to me at very beginning. 
</p>
<h2>From request to handler</h2>
<p>
I opened WebRuntime.sln and found all references to <code>MvcHandler</code>. It is only one place there, in the <code>MvcRouteHandler</code> (MvcRouteHandler.cs) class. MvcRouteHandler implements <code>IRouteHandler</code> interface, with one single method <code>GetHttpHandler</code>. I put the breakpoint there and started application for debug.
</p>
<a href="https://lh6.googleusercontent.com/-qcToxPI6g3o/Tex-ZsGfgdI/AAAAAAAAHdA/9SLS0GaX5GQ/mvcroutehandler.get.png">
<img src="https://lh6.googleusercontent.com/-qcToxPI6g3o/Tex-ZsGfgdI/AAAAAAAAHdA/9SLS0GaX5GQ/mvcroutehandler.get.png" alt="MVC route handler" />
</a>
<p>
As application got started I halted on breakpoint with such call stack:
</p>
<a href="https://lh4.googleusercontent.com/-95WwV5VbvNA/Tex-ZV9WcgI/AAAAAAAAHc4/RK9EdEXJS3E/s912/gethandler.debug.png">
<img src="https://lh4.googleusercontent.com/-95WwV5VbvNA/Tex-ZV9WcgI/AAAAAAAAHc4/RK9EdEXJS3E/s912/gethandler.debug.png" alt="MVC debug" />
</a>
<p>
Let&#8217;s try to read and decrypt it.
</p>
<p>
It begins with <code>WebDev.WebHost40.dll</code> (Cassini Web Server) that receives request and <code>System.Web.HttpRuntime.ProcessRequest</code>. Here is ASP.NET framework start to work:  
</p>
<ol>
<li>
<strong>ProcessRequestInternal</strong> method called. This is the primary method of whole pipeline. First, it initialize the <code>HttpContext</code> object.
</li>
<a href="https://lh5.googleusercontent.com/-T9pgTJlG10Q/Tex-Z8zRAGI/AAAAAAAAHdM/duxzWFuPwy0/processrequestinternal.1.png">
<img src="https://lh5.googleusercontent.com/-T9pgTJlG10Q/Tex-Z8zRAGI/AAAAAAAAHdM/duxzWFuPwy0/processrequestinternal.1.png" alt="System.Web.Dll ProcessRequestInternal"/>
</a>
<li>
Next it get <code>HttpApplication</code> instance, initialize it and calls either <code>BeginProcessRequest</code> for <code>IHttpAsyncHandler</code> or <code>ProcessReques</code> for <code>IHttpHandler</code>. 
</li>
<a href="https://lh5.googleusercontent.com/-E2zMvxF0Kjs/Tex-Z399b2I/AAAAAAAAHdE/uuZWDF99pLg/processrequestinternal.2.png">
<img src="https://lh5.googleusercontent.com/-E2zMvxF0Kjs/Tex-Z399b2I/AAAAAAAAHdE/uuZWDF99pLg/processrequestinternal.2.png" alt="System.Web.dll GetApplicationInstance"/>
</a>
<li>
If I go to <code>global.asax.cs</code> of our application it is clear that <code>System.Web.HttpApplication</code> implementation is inherited and <code>System.Web.HttpApplication</code> is a usual <code>IHttpAsyncHandler</code>. So, async <code>BeginProcessRequest</code> starts.
</li>
<a href="https://lh3.googleusercontent.com/-o9FWdeP1IRk/Tex-ZYGZAmI/AAAAAAAAHcw/M9vfv2DB6EM/httpapplication.png">
<img src="https://lh3.googleusercontent.com/-o9FWdeP1IRk/Tex-ZYGZAmI/AAAAAAAAHcw/M9vfv2DB6EM/httpapplication.png" alt="HttpApplication"/>
</a>
<li>In <code>BeginProcessRequest</code> there is a cycle that iterates all modules and execute each of it. Reflector code looks messy, but the point is clear</li>
<a href="https://lh5.googleusercontent.com/-9wj99HDJiOM/Tex-ZEIIEqI/AAAAAAAAHcs/DV6Qy3ewRMM/execute.steps.png">
<img src="https://lh5.googleusercontent.com/-9wj99HDJiOM/Tex-ZEIIEqI/AAAAAAAAHcs/DV6Qy3ewRMM/execute.steps.png" alt="System.Web.dll ExecuteSteps"/>
</a>
<li>And finally, the control goes to <strong>UrlRoutingModule</strong> that calls our factory method for <code>MvcHandler</code>. Aha!</li>
</ol>
<h2>UrlRouting module</h2>
<p>
UrlRouting is an HttpModule, registered in global web.config:
</p>
<a href="https://lh3.googleusercontent.com/-tb3Q5OzOn2k/Tex-aX1BawI/AAAAAAAAHdU/4AFsqAMjD_A/urlrouting.register.png">
<img src="https://lh3.googleusercontent.com/-tb3Q5OzOn2k/Tex-aX1BawI/AAAAAAAAHdU/4AFsqAMjD_A/urlrouting.register.png" alt="UrlRouting register"/>
</a>
<p>
The goal of this module is basically matching incoming request by URL with pre-defined Route configuration and return corresponding handler for this request. In <code>PostResolveRequestCache</code> method it gets the RouteHandler and asks for corresponding HttpHanlder. 
</p>
<a href="https://lh4.googleusercontent.com/-n1rd7SudO7k/Tex-aBhr-tI/AAAAAAAAHdQ/XaEaL3dPmJY/urlrouting.postresolve.png">
<img src="https://lh4.googleusercontent.com/-n1rd7SudO7k/Tex-aBhr-tI/AAAAAAAAHdQ/XaEaL3dPmJY/urlrouting.postresolve.png"/>
</a>
<p>
Wow, I didn&#8217;t know that!.. UrlRouting plays a major role inside the MVC infrastructure. But there the Routes are initialized and how <code>MvcRouteHandler</code> is associated with request?
</p>
<h2>Back to roots - Application_Start() method</h2>
<p>
I should actually start from here, <code>Application_Start()</code> is entry point of application. By my journey turn to be just other way around.
</p>
<a href="https://lh3.googleusercontent.com/-BTvRzBgusNQ/Tex-Y-X7yrI/AAAAAAAAHcg/0FJT4hP1FM4/applicationstart.png">
<img src="https://lh3.googleusercontent.com/-BTvRzBgusNQ/Tex-Y-X7yrI/AAAAAAAAHcg/0FJT4hP1FM4/applicationstart.png" alt="Application_Init()"/>
</a>
<p>
Inside the <code>RegisterRoutes</code> we register route by giving: route name and constraints.
</p>
<a href="https://lh5.googleusercontent.com/-iKaDvwunU-M/Tex-ZftTanI/AAAAAAAAHc0/6ssXZ32Zva0/maproute.png">
<img src="https://lh5.googleusercontent.com/-iKaDvwunU-M/Tex-ZftTanI/AAAAAAAAHc0/6ssXZ32Zva0/maproute.png" alt="MVC map route"/>
</a>
<p>
The <code>MapRoute</code> is actually extension method in RouteCollectionExtensions.cs.
</p>
<a href="https://lh5.googleusercontent.com/-qvU8dVWiIpw/Tex-aJuc0RI/AAAAAAAAHdI/u3OgdJCf8EA/routecollection.png">
<img src="https://lh5.googleusercontent.com/-qvU8dVWiIpw/Tex-aJuc0RI/AAAAAAAAHdI/u3OgdJCf8EA/routecollection.png" alt="MVC register route"/>
</a>
<p>
Now, you can see how the route with particular URL is being register and associated with <code>MvcRouteHandler</code>.
</p>
<h2>Putting it all together</h2>
<p>
Now it is time to get deep breath and finally understand the route of HTTP request to MvcHttpHandler. Here we go:
</p>
<ul>
<li>ASP.NET framework starting to process incoming request in <code>ProcessRequest</code> method, but interesting stuff going in <code>ProcessRequestInternal</code></li>
<li><code>ProcessRequestInternal</code> calls <code>GetApplicationInstance</code> method that get application instance and calls it <code>Application_Init()</code></li>
<li><code>Application_Init()</code> registers routes that map URL (like &#8220;home/index&#8221;) with <code>MvcRouteHandler</code> instance</li>
<li>ASP.NET framework starts to iterate modules for incoming request and found <code>UrlRouting</code> module</li>
<li><code>UrlRouting</code> module matches incoming request URL with registered collections of Routes</li>
<li>For found matched Route it gets corresponding route handler (MvcRouteHandler)</li>
<li><code>MvcHandler</code> is being returned by GetHttpHandler of MvcRouteHandler</li>
</ul>
<p>
That&#8217;s the routing that is being executed each time you put URL and hit your browser button.
</p>
<h2>What&#8217;s next?</h2>
<p>
I hope next time we indeed look closer to <code>MvcHandler</code> :).
</p>
<p>
Previous: <a href="http://www.beletsky.net/2011/05/inside-aspnet-mvc-setting-up-project.html">Inside ASP.NET MVC: Part 2: Setting up project for hacking</a>
Next: <a href=http://www.beletsky.net/2011/06/inside-aspnet-mvc-all-begins-here.html">Inside ASP.NET MVC: All begins here - MvcHanlder</a>
</p></div>

      
      
    </div>
  </div>

    </article>
  
  <div class="pagination inner pure-u-1">
    
      <a class="prev" href="/blog/page/13/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/11/">Newer &rarr;</a>
    
  </div>
</div></div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright © 2010 - 2013 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>