
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Beletsky's development blog</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="Hackatone in Kiev 11-12 June Jun 13th, 2011 Hackatone This weekend I&#8217;ve been visiting very interesting event - Hackatone that took place in &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/blog/page/14/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><div class="blog-index">
  
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/hackatone-in-kiev-11-12-june.html">
    
      Hackatone in Kiev 11-12 June</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-13T14:44:00+03:00" pubdate data-updated="true">Jun 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/hackatone/'>Hackatone</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
This weekend I&#8217;ve been visiting very interesting event - <a href="http://www.developers.org.ua/calendar/615/">Hackatone</a> that took place in <a href="http://www.ciklum.net/">Ciklum</a> office. Hackatone is whole night hacking session there every team or person could came up with any idea, implement it and present to crowd. Many times I heard about similar events either in podcasts or blogs that I read.. but never tried that myself. Thank&#8217;s for <a href=""http://www.developers.org.ua/">DOU</a> enthusiasts I got opportunity to try that. Here is my report of that event. There would be some mix of English and Russian language, hope that would not make you confuse :)
</p>
<p>
The event began with common meeting there people were sharing ideas of applications they are going to build. During my pretty long journey with in <a href="http://www.beletsky.net/2011/05/continuous-production-make-it-work.html">Continues Production</a> I already got my idea - I wanted to build Deployment-as-Service product that easily integrated with github and utilizes power of UppercuT for building .NET web applications. There was very few .NET developers there, already having their own ideas to build.. so I went alone. 
</p>
<p>
If you have been to Ciklum office, you probably know what SkyPoint is.. It is 20-th floor in office that resides on one Kiev&#8217;s hills, so you might imagine this exceptional view from there. I grabbed a chair started to work. 
</p>
<p>
Due to experience I got with .NET deployments and Jenkins I had pretty much well understanding what the workflow should be. I&#8217;ve created ASP.NET MVC3 in my Visual Studio and stared to develop. The scope of work I planned to do was pretty much big and I a little nervous about my ability to finish everything. I tried to work as fast as I can.. Full hour, that 10 minutes break and full hour again. Maybe because of that creative atmosphere around or straight orientation on final result but I think I really got a <a href="http://en.wikipedia.org/wiki/Flow_(psychology)">Flow</a>..
</p>
<p>
So, after ~3 hour of work I&#8217;ve created my github repository for new project - Candidate.net:
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79592735673303040">
<img src="https://lh5.googleusercontent.com/-EB45A9ltPj4/TfX3yjW1xBI/AAAAAAAAHeQ/6flibleXfdk/tweet-github.png" alt="tweet" />
</a>
<p>
Keeping that rhythm I continued to work mostly till 3.00 AM.. About 60% of work were done. I felt a little tired and decided to stop for today and had a good sleep to continue tomorrow. My plans were ruined as soon as I stepped to 19th there people gathered together.. So, in 5 minutes I got several shots of cognac and was sitting on a floor with guitar in my hands :). I had a real fun and relax there. Haven&#8217;t noticed at all how 2 hours are gone and sun started to rise.. We had a really nice moment of meeting new day on staying on office balcony. 
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79730442869293056">
<img src="https://lh5.googleusercontent.com/-YoDuw9t7AxU/TfX3yt71IQI/AAAAAAAAHeI/GZ-utUiR0IQ/tweet-morning.png" alt="tweet" />
</a>
<p>
I have to continue the implementation, so I went back to SkyPoint and run my Visual Studio again. Of cause I could not get such rhythm as I got yesterday, the process were much slower. I had to refuse of several more ideas I wanted to build, ignore the rules of Clean Code, SOLID and DRY. Did some ugly tricks, just to make application work. I had issues with testing and deployment since WiFi connection were quite slow. But, long story short - I implemented very basic workflow and realized that would be it for presentation.
</p>
<a href="http://twitter.com/#!/alexbeletsky/status/79814256295550976">
<img src="https://lh5.googleusercontent.com/--LWi6MlSOjo/TfX3ysS1-WI/AAAAAAAAHeM/XdE5KC4fx5w/tweet-done.png" alt="tweet" />
</a>
<p>
I found a sofa and finally got a change to have a sleep. Don&#8217;t know why but I managed to sleep only for one hour, just woke up and could not sleep again. So, I had a shower (yes, there are showers in Ciklum office), coffee.. and very nice breakfast. I had some time before presentation began, so I re-tested my application several times more and was happy about results. 
</p>
<p>
At 15.00 PM presentations began! I showed Candidate.net ability to initialize new application, build and deploy it in minutes.. How you can deliver with just a push a code to github, the rest of job done by Candidate. I don&#8217;t think I really impress people there, because of .NET crowd were to small.. but I tried to do best. After the presentation I&#8217;ve been contacted by several guys who interested with such concept.
</p>
<p>
Most of the presented projects were either old-school games implemented with new technologies or mobile applications. One guys did a nice linux kernel exploration and share his ideas. 
</p>
<p>
After there was a manual voting for each project to decide on 3 best, I didn&#8217;t win :). Winners got their congratulations and presents for sponsors. I quit really quickly since I was a little late for my friend wedding that was that day :) 
</p>
<p>
That was really nice experience for me. I appreciate <a href="http://www.ciklum.net/">Ciklum</a>, <a href=""http://www.developers.org.ua/">DOU</a> and everyone involved, who make that possible. Thank you guys :)
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/06/inside-aspnet-mvc-route-to-mvchanlder.html">
    
      Inside ASP.NET MVC: Route to MvcHandler</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-06-06T10:28:00+03:00" pubdate data-updated="true">Jun 6<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
In my <a href="http://www.beletsky.net/2011/05/inside-aspnet-mvc-setting-up-project.html">previous post</a> I promised to start with exploration of <code>MvcHanlder</code> as entry point of ASP.NET MVC application. <code>MvcHandler</code> plays the major role in MVC infrastructure, but as I fugured out - the whole story does not begin there. The story is actually begins inside ASP.NET framework.
</p>
<h2>ASP.NET framework</h2>
<p>
ASP.NET framework is heart of ASP.NET MVC application. Basically, ASP.NET is a request processing engine. It takes incoming request as input and sends it through <i>internal pipeline</i> till the <i>end point</i>. The architecture allows extensibility, you could plug either into pipeline (modules) or end points (handlers). Interesting fact that ASP.NET designed to be decoupled from actual request source. So, the source of request could be any application - IIS, Cassini or any custom one.
</p>
<p>
We could imagine that each request pass through the set of filters (<i>internal pipeline</i>) lands up on request handler (<i>end point</i>), request handler creates a response object and sent it back. There are a lot of hidden details of dealing with managed/unmanaged code that you could find in this <a href="http://www.west-wind.com/presentations/howaspnetworks/howaspnetworks.asp">brilliant article</a> by Rick Strahl. 
</p>
<p>
For us it is important to understand two basic abstractions, HttpModules and HttpHandlers.
</p>
<h2>HttpModules and HttpHandlers</h2>
<p>
From the developers point of view the difference between those are: one implements <code>IHttpModule</code> interface another implements <code>IHttpHandler</code> interface. 
</p>
<p>
<strong>Module</strong> participates in the request processing of every request in order to change or add to it in some way.  
</p>
<p>
<strong>Handler</strong> is responsible for handling the request and producing the response for specific content types.  
</p>
<p>
ASP.NET MVC is HttpHandler. 
</p>
<a href="https://lh3.googleusercontent.com/-8EBxpoh7R0w/Tex-Zo80FfI/AAAAAAAAHc8/eMI-FEEurCg/mvchandler.png">
<img src="https://lh3.googleusercontent.com/-8EBxpoh7R0w/Tex-Zo80FfI/AAAAAAAAHc8/eMI-FEEurCg/mvchandler.png" alt="MVC handler" />
</a>
<p>
There a bunch of default HttpModules and HttpHandlers in your IIS configuration. Just take a look here - %WINDOWS%\Microsoft.NET\Framework\v4.0.30319\Config\web.config. 
</p>
<p>
But if you look closer you won&#8217;t notice any mention of <code>System.Web.Mvc.MvcHanlder</code>. Hey. what&#8217;s wrong? How the runtime actually knows that <code>MvcHanler</code> have to be called to handle our request? That was absolutely unclear to me at very beginning. 
</p>
<h2>From request to handler</h2>
<p>
I opened WebRuntime.sln and found all references to <code>MvcHandler</code>. It is only one place there, in the <code>MvcRouteHandler</code> (MvcRouteHandler.cs) class. MvcRouteHandler implements <code>IRouteHandler</code> interface, with one single method <code>GetHttpHandler</code>. I put the breakpoint there and started application for debug.
</p>
<a href="https://lh6.googleusercontent.com/-qcToxPI6g3o/Tex-ZsGfgdI/AAAAAAAAHdA/9SLS0GaX5GQ/mvcroutehandler.get.png">
<img src="https://lh6.googleusercontent.com/-qcToxPI6g3o/Tex-ZsGfgdI/AAAAAAAAHdA/9SLS0GaX5GQ/mvcroutehandler.get.png" alt="MVC route handler" />
</a>
<p>
As application got started I halted on breakpoint with such call stack:
</p>
<a href="https://lh4.googleusercontent.com/-95WwV5VbvNA/Tex-ZV9WcgI/AAAAAAAAHc4/RK9EdEXJS3E/s912/gethandler.debug.png">
<img src="https://lh4.googleusercontent.com/-95WwV5VbvNA/Tex-ZV9WcgI/AAAAAAAAHc4/RK9EdEXJS3E/s912/gethandler.debug.png" alt="MVC debug" />
</a>
<p>
Let&#8217;s try to read and decrypt it.
</p>
<p>
It begins with <code>WebDev.WebHost40.dll</code> (Cassini Web Server) that receives request and <code>System.Web.HttpRuntime.ProcessRequest</code>. Here is ASP.NET framework start to work:  
</p>
<ol>
<li>
<strong>ProcessRequestInternal</strong> method called. This is the primary method of whole pipeline. First, it initialize the <code>HttpContext</code> object.
</li>
<a href="https://lh5.googleusercontent.com/-T9pgTJlG10Q/Tex-Z8zRAGI/AAAAAAAAHdM/duxzWFuPwy0/processrequestinternal.1.png">
<img src="https://lh5.googleusercontent.com/-T9pgTJlG10Q/Tex-Z8zRAGI/AAAAAAAAHdM/duxzWFuPwy0/processrequestinternal.1.png" alt="System.Web.Dll ProcessRequestInternal"/>
</a>
<li>
Next it get <code>HttpApplication</code> instance, initialize it and calls either <code>BeginProcessRequest</code> for <code>IHttpAsyncHandler</code> or <code>ProcessReques</code> for <code>IHttpHandler</code>. 
</li>
<a href="https://lh5.googleusercontent.com/-E2zMvxF0Kjs/Tex-Z399b2I/AAAAAAAAHdE/uuZWDF99pLg/processrequestinternal.2.png">
<img src="https://lh5.googleusercontent.com/-E2zMvxF0Kjs/Tex-Z399b2I/AAAAAAAAHdE/uuZWDF99pLg/processrequestinternal.2.png" alt="System.Web.dll GetApplicationInstance"/>
</a>
<li>
If I go to <code>global.asax.cs</code> of our application it is clear that <code>System.Web.HttpApplication</code> implementation is inherited and <code>System.Web.HttpApplication</code> is a usual <code>IHttpAsyncHandler</code>. So, async <code>BeginProcessRequest</code> starts.
</li>
<a href="https://lh3.googleusercontent.com/-o9FWdeP1IRk/Tex-ZYGZAmI/AAAAAAAAHcw/M9vfv2DB6EM/httpapplication.png">
<img src="https://lh3.googleusercontent.com/-o9FWdeP1IRk/Tex-ZYGZAmI/AAAAAAAAHcw/M9vfv2DB6EM/httpapplication.png" alt="HttpApplication"/>
</a>
<li>In <code>BeginProcessRequest</code> there is a cycle that iterates all modules and execute each of it. Reflector code looks messy, but the point is clear</li>
<a href="https://lh5.googleusercontent.com/-9wj99HDJiOM/Tex-ZEIIEqI/AAAAAAAAHcs/DV6Qy3ewRMM/execute.steps.png">
<img src="https://lh5.googleusercontent.com/-9wj99HDJiOM/Tex-ZEIIEqI/AAAAAAAAHcs/DV6Qy3ewRMM/execute.steps.png" alt="System.Web.dll ExecuteSteps"/>
</a>
<li>And finally, the control goes to <strong>UrlRoutingModule</strong> that calls our factory method for <code>MvcHandler</code>. Aha!</li>
</ol>
<h2>UrlRouting module</h2>
<p>
UrlRouting is an HttpModule, registered in global web.config:
</p>
<a href="https://lh3.googleusercontent.com/-tb3Q5OzOn2k/Tex-aX1BawI/AAAAAAAAHdU/4AFsqAMjD_A/urlrouting.register.png">
<img src="https://lh3.googleusercontent.com/-tb3Q5OzOn2k/Tex-aX1BawI/AAAAAAAAHdU/4AFsqAMjD_A/urlrouting.register.png" alt="UrlRouting register"/>
</a>
<p>
The goal of this module is basically matching incoming request by URL with pre-defined Route configuration and return corresponding handler for this request. In <code>PostResolveRequestCache</code> method it gets the RouteHandler and asks for corresponding HttpHanlder. 
</p>
<a href="https://lh4.googleusercontent.com/-n1rd7SudO7k/Tex-aBhr-tI/AAAAAAAAHdQ/XaEaL3dPmJY/urlrouting.postresolve.png">
<img src="https://lh4.googleusercontent.com/-n1rd7SudO7k/Tex-aBhr-tI/AAAAAAAAHdQ/XaEaL3dPmJY/urlrouting.postresolve.png"/>
</a>
<p>
Wow, I didn&#8217;t know that!.. UrlRouting plays a major role inside the MVC infrastructure. But there the Routes are initialized and how <code>MvcRouteHandler</code> is associated with request?
</p>
<h2>Back to roots - Application_Start() method</h2>
<p>
I should actually start from here, <code>Application_Start()</code> is entry point of application. By my journey turn to be just other way around.
</p>
<a href="https://lh3.googleusercontent.com/-BTvRzBgusNQ/Tex-Y-X7yrI/AAAAAAAAHcg/0FJT4hP1FM4/applicationstart.png">
<img src="https://lh3.googleusercontent.com/-BTvRzBgusNQ/Tex-Y-X7yrI/AAAAAAAAHcg/0FJT4hP1FM4/applicationstart.png" alt="Application_Init()"/>
</a>
<p>
Inside the <code>RegisterRoutes</code> we register route by giving: route name and constraints.
</p>
<a href="https://lh5.googleusercontent.com/-iKaDvwunU-M/Tex-ZftTanI/AAAAAAAAHc0/6ssXZ32Zva0/maproute.png">
<img src="https://lh5.googleusercontent.com/-iKaDvwunU-M/Tex-ZftTanI/AAAAAAAAHc0/6ssXZ32Zva0/maproute.png" alt="MVC map route"/>
</a>
<p>
The <code>MapRoute</code> is actually extension method in RouteCollectionExtensions.cs.
</p>
<a href="https://lh5.googleusercontent.com/-qvU8dVWiIpw/Tex-aJuc0RI/AAAAAAAAHdI/u3OgdJCf8EA/routecollection.png">
<img src="https://lh5.googleusercontent.com/-qvU8dVWiIpw/Tex-aJuc0RI/AAAAAAAAHdI/u3OgdJCf8EA/routecollection.png" alt="MVC register route"/>
</a>
<p>
Now, you can see how the route with particular URL is being register and associated with <code>MvcRouteHandler</code>.
</p>
<h2>Putting it all together</h2>
<p>
Now it is time to get deep breath and finally understand the route of HTTP request to MvcHttpHandler. Here we go:
</p>
<ul>
<li>ASP.NET framework starting to process incoming request in <code>ProcessRequest</code> method, but interesting stuff going in <code>ProcessRequestInternal</code></li>
<li><code>ProcessRequestInternal</code> calls <code>GetApplicationInstance</code> method that get application instance and calls it <code>Application_Init()</code></li>
<li><code>Application_Init()</code> registers routes that map URL (like &#8220;home/index&#8221;) with <code>MvcRouteHandler</code> instance</li>
<li>ASP.NET framework starts to iterate modules for incoming request and found <code>UrlRouting</code> module</li>
<li><code>UrlRouting</code> module matches incoming request URL with registered collections of Routes</li>
<li>For found matched Route it gets corresponding route handler (MvcRouteHandler)</li>
<li><code>MvcHandler</code> is being returned by GetHttpHandler of MvcRouteHandler</li>
</ul>
<p>
That&#8217;s the routing that is being executed each time you put URL and hit your browser button.
</p>
<h2>What&#8217;s next?</h2>
<p>
I hope next time we indeed look closer to <code>MvcHandler</code> :).
</p>
<p>
Previous: <a href="http://www.beletsky.net/2011/05/inside-aspnet-mvc-setting-up-project.html">Inside ASP.NET MVC: Part 2: Setting up project for hacking</a>
Next: <a href=http://www.beletsky.net/2011/06/inside-aspnet-mvc-all-begins-here.html">Inside ASP.NET MVC: All begins here - MvcHanlder</a>
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/05/inside-aspnet-mvc-setting-up-project.html">
    
      Inside ASP.NET MVC: Setting up project for hacking</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-05-29T20:58:00+03:00" pubdate data-updated="true">May 29<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
As we <a href="http://www.beletsky.net/2011/05/inside-aspnet-mvc-part-1-packing-bags.html">already got</a> debug assembly and pdb file, it it time to create a test project that would be a sandbox for all experiments. This would be classic MVC application, but we going to substitute release version of MVC framework with our locally built version, which allows us easily debug it.
</p>
<h2>Create new project</h2>
<p>
Let&#8217;s create new project. It would be MVC 3 Application:
</p>
<!-- newproject.png -->
<a href="https://lh3.googleusercontent.com/-1wuOdUmqbUI/TeKIMTnbcUI/AAAAAAAAHcM/-kBRSXGB0bc/s720/newproject.png">
<img src="https://lh3.googleusercontent.com/-1wuOdUmqbUI/TeKIMTnbcUI/AAAAAAAAHcM/-kBRSXGB0bc/s720/newproject.png" alt="new project" />
</a>
<p>
On a second step just select &#8220;Empty&#8221; in &#8220;Select template&#8221; dialog. &#8220;Razor&#8221; would be for view engine.
</p>
<h2>Correct system.web assemblies section</h2>
<p>
Go to <code>web.config</code> of a new project and comment out <code>System.Web.Mvc</code> and <code>System.Web.WebPages</code> assemblies. By doing that we saying: &#8220;those 2 assemblies are no longer a part of compilation of our application&#8221;.
</p>
<!-- webconfig.png -->
<a href="https://lh3.googleusercontent.com/-Va0g0ltK6WE/TeKIMjzGltI/AAAAAAAAHcQ/dyR3mI2B1B4/webconfig.png">
<img src="https://lh3.googleusercontent.com/-Va0g0ltK6WE/TeKIMjzGltI/AAAAAAAAHcQ/dyR3mI2B1B4/webconfig.png" alt="web.config" />
</a>
<p>
<strong>UPDATE:</strong> If you do just that, later you will get an exception from Razor assemblies, about wrong type cast. To avoid that, it is even better to remove all assemblies in this section, plus Find/Replace PublicKeyToken=31bf3856ad364e35 to PublicKeyToken=null. That would do not make application to search GAC for missing assemblies and load locally built ones.
</p>
<h2>Correct application references</h2>
<p>
Now, remove existing references for <code>System.Web.Mvc</code> and <code>System.Web.WebPages</code> and put locally built ones instead. Right click on references project section and browse to the Debug folder of mvc3-rtm build directory. Try to build application now, it should be build without any issues.
</p>
<a href="https://lh4.googleusercontent.com/-ZxDsNTzlZ8w/TeKIMIG5lgI/AAAAAAAAHcE/f-RS0YrnwXM/addreferences.png">
<img src="https://lh4.googleusercontent.com/-ZxDsNTzlZ8w/TeKIMIG5lgI/AAAAAAAAHcE/f-RS0YrnwXM/addreferences.png" alt="setup" />
</a>
<h2>Home controller</h2>
<p>
Further steps are pretty simple, just add a test controller - <code>HomeController</code> with <code>Index</code> action. Add just a simple view for that.
</p>
<!-- controller.png -->
<a href="https://lh5.googleusercontent.com/-WMscnqODvIU/TeKIMHyuGBI/AAAAAAAAHcA/-3W-2nlB_RQ/controller.png">
<img src="https://lh5.googleusercontent.com/-WMscnqODvIU/TeKIMHyuGBI/AAAAAAAAHcA/-3W-2nlB_RQ/controller.png" alt="controller" />
</a>
<h2>Check it out!</h2>
<p>
Place a breakpoint into action method and press F5 to start debugger. Now you we&#8217;ve got a full stack trace that allows to see every aspect of MVC world.
</p>
<!-- stack.png -->
<a href="https://lh5.googleusercontent.com/-H0makF0CB_4/TeKIMbLt2bI/AAAAAAAAHcI/0nhnBobKnuA/stack.png">
<img src="https://lh5.googleusercontent.com/-H0makF0CB_4/TeKIMbLt2bI/AAAAAAAAHcI/0nhnBobKnuA/stack.png" alt="stack" />
</a>
<h2>Conclusion</h2>
<p>
The setup is easy and allows to jump in very quick. If you got any issues with that, please let me know.
</p>
<h2>
What is next?
</h2>
<p>
Next I will hack the entry point of MVC application called <code>MvcHandler</code> and understand how it works.
</p>
<p>
Please stay tuned.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/05/inside-aspnet-mvc-part-1-packing-bags.html">
    
      Inside ASP.NET MVC: Packing bags for journey</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-05-25T22:57:00+03:00" pubdate data-updated="true">May 25<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
I&#8217;m big fan of ASP.NET MVC framework. It is smart, clean and testable. A lot of stuff you can do with MVC are very intuitive, you don&#8217;t have to go thought pages of documentation to do some basic stuff. I do not use MVC on my primary work yet (unfortunately) but my small <a href="http://trackyt.net">project</a> became very nice sandbox to play around and learn stuff. 
</p>
<p>
I definitely learned something thought the year of hooked up with MVC. But feel I still miss a lot of details. Moreover, my hackers curiosity always force to look - &#8220;what is inside?&#8221;.
</p>
<p>
Great stuff about ASP.NET MVC project is that is open source. It is been released as open source and remain open source project till version 3.0.. In fact, it is very easy to start learning framework from inside! This what I&#8217;m going to do. I would like to go depth and hope that journey would be interesting and valuable.
</p>
<p>
Today I&#8217;ll to prepare everything I need for journey. I would be happy if you join me, so we would help each other along the way :).
</p>
<h2>Getting out source code</h2>
<p>
That&#8217;s easy. Just google for &#8220;MVC3 source code&#8221; and it would bring you directly to <a href="http://aspnet.codeplex.com/releases/view/58781">ASP.NET Codeplex</a> site.
</p>
<p>
Download <code>mvc3-rtm-sources.zip</code>. Unpack the archive and you will see the solution file <code>WebRuntime.sln</code> and 2 folders: <code>mvc3</code> and <code>webpages</code>. Layout of both folders are similar:
</p>
<pre>
    /--- bin
    /--- src
    /--- tests
    /--- tools
</pre>
<p>
Source code package is pretty much organized. Solution does not using NuGet, btw :)
</p>
<h2>Meet the solution</h2>
<p>
It&#8217;s time open up solution! Fire up Visual Studio and open <code>WebRuntime.sln</code>. Let the journey begins! 
</p>
<p>
Nothing fancy there. Minimal number of solution folders, just <code>MVC</code> and <code>WebPages</code>. Each of folder contains a bunch of projects in it. In nearest future we would be much interested in one <code>System.Web.Mvc</code> - heart of MVC framework.
</p>
<!-- solution.png -->
<a href="https://lh5.googleusercontent.com/_stL4bIIuRUs/Td1ccQNmpmI/AAAAAAAAHbI/9_D1bnR-u2U/solution.png">
<img src="https://lh5.googleusercontent.com/_stL4bIIuRUs/Td1ccQNmpmI/AAAAAAAAHbI/9_D1bnR-u2U/solution.png" alt="solution" />
</a>
<h2>Build it</h2>
<p>
Don&#8217;t waste any time and just build the solution. As it usually happened to me, with OSS projects - you always have some issues during build. It is not the case for MVC. Build runs smoothly as possible. The output is being placed in <code>mvc3/bin/debug</code> folder. So, as soon as build finished check it out and see for content.
</p>
<!-- output.png -->
<a href="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dFx0z8wI/AAAAAAAAHbQ/2GGnooqDpVA/output.png">
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dFx0z8wI/AAAAAAAAHbQ/2GGnooqDpVA/output.png" alt="output" />
</a>
<h2>Run tests</h2>
<p>
All TDD lovers would be really pleased with a number of tests in solution. There is 5004 tests actually, solid number of tests. No surprise <code>MsTest</code> framework is used. Let&#8217;s just try to run them!
</p>
<p>
In menu Test -> Run -> Tests in Current Context. Here we go.. It took a bit time to run all. I was a little disappointed to see that some tests are failing.
</p>
<p>
I did an inspection of failures and found out that all of them are actually related to my Local Settings. I use &#8220;Ukrainian Locale&#8221; that means time format, decimal point symbol etc. are differs from &#8220;United States Local&#8221;. It&#8217;s a quite common issue of units, workaround could be a simply change your locale to the one that rest development team uses. The rests of tests run&#8217;s just fine!
</p>
<!-- tests.png -->
<a href="https://lh5.googleusercontent.com/_stL4bIIuRUs/Td1dGBUDDoI/AAAAAAAAHbY/0Lqffzp4lLA/tests.png">
<img src="https://lh5.googleusercontent.com/_stL4bIIuRUs/Td1dGBUDDoI/AAAAAAAAHbY/0Lqffzp4lLA/tests.png" alt="tests" />
</a>
<h2>Conclusions</h2>
<p>
So, my initial impression are: 
</p>
<ul>
<li>Easy to build and start up</li>
<li>Code looks really nice</li>
<li>Code style a little differs from default C# especially in with &#8220;{&#8221;</li>
<!-- code.png -->
<a href="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dFxvjw5I/AAAAAAAAHbU/MvOwune0ItA/code.png">
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dFxvjw5I/AAAAAAAAHbU/MvOwune0ItA/code.png" alt="code"/>
</a>
<li>Tests following AAA pattern really nicely</li>
<!-- test.png -->
<a href="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dGNxu8NI/AAAAAAAAHbc/yTr-v0_oCww/test.png">
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/Td1dGNxu8NI/AAAAAAAAHbc/yTr-v0_oCww/test.png" alt="test" />
</a>
<li>Code contracts are not used, but code pretty defensive with check for <code>null</code> arguments etc.</li>
<!-- exception.png -->
<a href="https://lh6.googleusercontent.com/_stL4bIIuRUs/Td1dF7ZxCuI/AAAAAAAAHbM/7IORamYJ-fA/exception.png">
<img src="https://lh6.googleusercontent.com/_stL4bIIuRUs/Td1dF7ZxCuI/AAAAAAAAHbM/7IORamYJ-fA/exception.png" alt="exception" />
</a>
<li>All members are with &#8220;_&#8221; underscore - I like that :)</li>
<li>Methods are small and clean</li>
</ul>
<p>
What I don&#8217;t like to far:
</p>
<ul>
<li>Solution is quite big - I would be happy to have separation between MVC part and WebPages (if it is possible)</li>
<li>Tests are really slow. Suite run for 3-4 minutes (upd: I blame MsTest runner for that, with TD.NET all tests passed for 89 sec&#8217;s)</li>
<li>Already found some comments that lie (one more point to try to avoid comments if possible)</li>
</ul>
<h2>
What is next?
</h2>
<p>
Next, I will setup a test project which allow us to fully get in deep of details and see how it work.
</p>
<p>
Please stay tuned.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/05/net-saturday-in-ciklum.html">
    
      .NET Saturday in Ciklum</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-05-14T21:19:00+03:00" pubdate data-updated="true">May 14<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/conference/'>Conference</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
This Saturday it was really nice event organized and hosted by <a href="http://www.ciklum.net/">Ciklum</a>. I had a big pleasure to be part of the event and was given a speech about Continues Production (Delivery) and my experience of using UppercuT, RoundhouE and Jenkinks for that. 
</p>
<img style="position: relative; display: inline; float: left; " src="https://lh6.googleusercontent.com/_stL4bIIuRUs/Tc68_M3LaaI/AAAAAAAAHaM/TrFD0GQgQq0/IMG_4956.JPG" />
<p>
The organization of event was really nice. Only the speakers were one who introduced disorder there :). Some speeches were bit longer than planned, that&#8217;s why schedule ruined from the very beginning of event. My speech was planned for 0.5 hour, but I&#8217;ve been 1 hour on stage.
</p>
<p>
I&#8217;ve been pretty nervous since I never gave public speeches, but I really liked that experience. I hope to visit/participate more .NET events in future. At the end I was happy that everything is alright and I&#8217;m finally done. So, in great mood and relaxed I stayed to listen for the rest of speakers.
</p>
<p>
Also I was really nice to meet <a href="http://twitter.com/#!/skalinets">Sergey Kalinets</a>, <a href="http://twitter.com/#!/antonvidishchev">Anton Vidishchev</a> who shared their experience in TDD and ASP.net MVC framework. Such type of event are really great for professionals gathering, helping to better communication and knowledge sharing. 
</p>
<p>
Let me wish Ciklum and Inna Tueva in particular to have will and energy for organizing such events. Thanks a lot!
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/05/continuous-production-make-it-work.html">
    
      Continuous Delivery: Make it work</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-05-11T10:27:00+03:00" pubdate data-updated="true">May 11<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/continuous/'>Continuous</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
As soon as we <a href="http://www.beletsky.net/2011/05/continues-production-setup-and-run.html">setup</a> project infrastructure in a way that build and deploy is done by one batch command, we are ready to run this process continuously. It is possible to take any CI server you want, I stopped on <a href="http://jenkins-ci.org/">Jenkins</a>.. basically it contains everything I need. But before start with Jenkins, let&#8217;s one more time take a look current infrastructure and goals.
</p>
<h2>Git branching model</h2>
<p>
There is great <a href="http://nvie.com/posts/a-successful-git-branching-model">article</a> on that topic, I used main ideas from that. So, I have 2 branches in my <code>origin</code> that exists all the time. They are: <code>master</code> and <code>development</code>. All pushes I do during implementation are going to <code>development</code> branch. No direct pushes are made to <code>master</code> at all (there are some exceptions of cause, but I try to follow that rule). As soon as code in <code>development</code> is stabilized, I prepare special <code>release</code> branch (update version and small clean up there) and <code>release</code> is being merged to <code>master</code> as it tested and everything is fine.
</p>
<h2>Staging and Production environments</h2>
<p>
I define 2 types of environments: Staging and Production. Environment includes: binaries, markup, database, deploy scripts.
</p>
<p>Everything that is being developed are goes to staging environment immediately (and automatically). Production update is being run manually as soon as all testing on Staging are finished. Separation of environments is great idea. Even if we are trying hard to have potentially shippable software during each build, this is not true. It is usually a lot of problems in latest version that need to be fixed before production server update.
</p>
<p>
So, Staging is a result of build/deploy of <code>development</code>; Production is a result of build/deploy of <code>master</code>. 
</p>
<p>
In my case, everything you see <a href="http://stage.trackyt.net/">here</a> is a result of build of <a href="https://github.com/alexanderbeletsky/trackyt.net/tree/development">this</a>. Everything you see <a href="http://www.trackyt.net/">here</a> is a result of <a href="https://github.com/alexanderbeletsky/trackyt.net">this</a>.
</p>
<h2>What I want to get?</h2>
<p>
I want to have automatic system that would update my <a href="http://stage.trackyt.net/">Staging</a> with every push to <code>development</code> branch and I want automatic system that would update my <a href="http://www.trackyt.net/">Production</a> as soon as <code>master</code> branch is ready to. As it said in <a href="http://www.beletsky.net/2011/04/continues-production-overview-and.html">overview</a> having such system is great reduce of deployment overhead. Let&#8217;s make this happen!
</p>
<p>
As I said earlier I would use <a href="http://jenkins-ci.org/">Jenkins</a>. Great stuff about this software that is very intuitive! Setup is easy and fun, I would put just a little guidance of process.
</p>
<h2>Local Jenkins server setup</h2>
<p>
As you download Jenkins WAR file, it is easy to start just with <code>java -jar jenkins.war</code>. Now, the dashboard is available at <code>http://localhost:8080/</code>.
</p>
<h3>Plugins</h3>
<p>
First, you should add all required plugins. It already contains some, but some are missing. I&#8217;ve add such to my default configuration:
</p>
<ul>
<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Git+Plugin">Jenkins GIT plugin</a></li>
<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/Github+Plugin">Github plugin</a></li>
<li><a href="http://wiki.jenkins-ci.org/display/JENKINS/NUnit+Plugin">NUnit Plugin</a></li>
</ul>
<p>
Go to &#8220;Manage Jenkins&#8221; -> &#8220;Manage Plugins&#8221; and install missing one.
</p>
<p>
So, my configuration looks like this:
</p>
<!-- plugins.png -->
<img src="https://lh6.googleusercontent.com/_stL4bIIuRUs/Tco7BUnOiGI/AAAAAAAAHZk/XSxs5Y_zrR0/plugins.png" alt="plugins" />
<h3>Configure system</h3>
<p>
Now go to &#8220;Manage Jenkins&#8221; -> &#8220;Configure System&#8221; and find &#8220;Git&#8221; section there. You should provide with your user name and path to Git. I have git in my PATH variable (recommend you do the same). 
</p>
<h3>Create new job</h3>
<p>
After basic configuration is done, let&#8217;s define new job. Go to &#8220;New job&#8221;. In common section you should give your job name and provide with githib path to repository.
</p>
<img src="https://lh5.googleusercontent.com/_stL4bIIuRUs/Tco7A-XTqYI/AAAAAAAAHZg/0kLPsWXWj6k/common-section.png" alt="common section" />
<p>
In Source Control Management: URL to Git repository, Branch to build and Repository browser (optional).
</p>
<!-- SCM.png -->
<img src="https://lh6.googleusercontent.com/_stL4bIIuRUs/Tco7Bh2RuUI/AAAAAAAAHZs/p568dcfUStk/SCM.png" alt="SCM" />
<p>
Build triggers (explain a bit later).
</p>
<!-- build-triggers.png -->
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/Tco7A6XC3ZI/AAAAAAAAHZY/X39bPBs9U3Q/build-triggers.png" alt="build-triggers" />
<p>
In Build section you specify commands to build/test/package and to deploy results. See my <a href="http://www.beletsky.net/2011/05/continues-production-setup-and-run.html">previous post</a> for details.
</p>
<!-- build.png -->
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/Tco7A76md_I/AAAAAAAAHZc/5JPyCIL5Pek/build.png" alt="build" />
<p>
Finally in Post-build section, specify path to grab artifacts.
</p>
<!-- post-build.png -->
<h3>Test it locally</h3>
<p>
As soon as configuration is done, you can test your build locally. Just start your job and make sure that: build run, tests executed, new database deployed, new application deployed. Basically if everything done correctly in previous <a href="http://www.beletsky.net/2011/05/continues-production-setup-and-run.html">steps</a> you should not experience any troubles. If it is fine that means the configuration is simply ready to be put to production server.
</p>
<h2>Move it to production</h2>
<p>
As it defined, our goal is to update staging and production with out any manual work. The simplest scenario then CI server resides on the same machine as production server. 
</p>
<p>
Great thing about Jenkins is that it requires no installation. So, I packed all content of <code>~/User/Jenkins</code> folder and Git into one single package and FTP&#8217;ed to my production server. As you unpack, configure Git in PATH variable, setup up your private repository keys it is just simply ready to work. Now, test it remotely - staging and production should be able to update with one single click on Jenkins dashboard. 
</p>
<h3>Little adjustments for production server</h3>
<p>
My VPS has Windows auto-update enabled, so It is being rebooted from time to time. As it is being rebooted, you should start Jenkins manually. Fortunately it has really nice feature - Jenkins might be run as <a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+as+a+Windows+service">Windows Service</a>. This is extremely useful, I recommend to do it from very beginning. 
</p>
<h3>Using Github hook to automate build run</h3>
<p>
I want my every commit to <code>development</code> to be tested and to be visible on Stage. As it said in <strong>Configure system</strong> part, you can setup build triggers. With build trigger you can run build just by requesting this URL <code>http://jenkins.server/jobname/build?token=TOKEN</code>.
</p>
<p>
In github repository go to Admin section and setup new hook in &#8220;Post Recieve URLs&#8221; section, like this:
</p>
<!-- gtihub -->
<img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/TcpDr67qBpI/AAAAAAAAHZ4/bL1s9Lwhh7g/s912/github.png" alt="github" />
<p>
This concludes the setup.
</p>
<h2>Control your builds all the time</h2>
<p>
What we did is only very basic setup, but it already gives a lot of power. It is really easy to track all builds/artifacts/history of changes. Downtime of site is extreamly slow (comparing to manual changes). Dashboard is very convenient to control builds:
</p>
<!-- dashboard -->
<img src="https://lh6.googleusercontent.com/_stL4bIIuRUs/TcpEsDXvmmI/AAAAAAAAHZ8/c7ttFDLm_fA/s912/dashboard.png" alt="dashboard" /></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/05/continues-production-setup-and-run.html">
    
      Continuous Delivery: Setup and run</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-05-02T11:39:00+03:00" pubdate data-updated="true">May 2<span>nd</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/continuous/'>Continuous</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
In my <a href="http://www.beletsky.net/2011/04/continuous-production-overview-and.html">previous post</a> I tried to make it clear that continuous production is for good. This post I&#8217;ll show how to prepare environment for continuous production. The idea is that you should be able to configure and test it locally. All configurations have to be part of source code under SCM. It should not depend on machine and run any environment you like. Success criteria is: pick up clean machine, do checkout, run build.bat/deploy.bat and have installed web application.
</p>
<h2>Integration and database deployment</h2>
<p>
As I said, <a href="http://www.beletsky.net/2010/10/uppercut-your-builds.html">UppercuT</a> and <a href="http://www.beletsky.net/2010/10/roundhouse-your-database.html">RoundhousE</a> are really nice tools for that. As soon as you follow the instruction&#8217;s you will have a <code>build.bat</code>, that would be able to build up all binaries, run tests against that and put all build artifacts to package. That is pretty good for start, but we still missing &#8220;deployment&#8221; part.
</p>
<p>
As you a little bit more familiar with UppercuT, it provides good facilities for deployment as well. Basically, there are folder <code>deployment\templates\</code> where you able to define your custom deployment scripts. Typical web application requires 2 scripts:
</p>
<ul>
<li>AppDeployment.bat - for web site deployment</li>
<li>DbDeployment.bat - for database deployment</li>
</ul>
<p>
There files are templates, from which script for particular <code>environment</code> is generated. The environment is defined in <code>settings</code> folder and include such information as deploy folder, web site name, database name, server name as number of variables. Example,
</p>
<pre class="brush: xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;project name=&quot;Settings&quot;&gt;
  &lt;!-- environment settings --&gt;
  &lt;property name=&quot;environment&quot; value=&quot;PRODUCTION&quot; /&gt;
  &lt;!-- servers --&gt;
  &lt;property name=&quot;server.database&quot; value=&quot;.\SQLEXPRESS&quot; /&gt;
  &lt;property name=&quot;web.deploy.folder&quot; value=&quot;c:\trackyt.net\web\&quot; /&gt;
  &lt;property name=&quot;web.site.name&quot; value=&quot;trackyt.net&quot; /&gt;

  &lt;property name=&quot;database.name&quot; value=&quot;trackytdb&quot; /&gt;
  &lt;property name=&quot;log.level&quot; value=&quot;DEBUG&quot; /&gt;
  &lt;property name=&quot;app.user.name&quot; value=&quot;alexander.beletsky&quot; /&gt;

  &lt;!-- base settings --&gt;
  &lt;property name=&quot;project.name&quot; value=&quot;trackyt.net&quot; overwrite=&quot;false&quot; /&gt;
  &lt;property name=&quot;repository.path&quot; value=&quot;git://github.com/alexanderbeletsky/trackyt.net&quot; /&gt;
  &lt;property name=&quot;folder.app.drop&quot; value=&quot;${project.name}&quot; overwrite=&quot;false&quot; /&gt;
  &lt;property name=&quot;folder.database&quot; value=&quot;db&quot; overwrite=&quot;false&quot; /&gt;

  &lt;!-- database deployment --&gt;
  &lt;property name=&quot;dirs.db&quot; value=&quot;..\${folder.database}&quot; /&gt;
  &lt;property name=&quot;file.version&quot; value=&quot;_BuildInfo.xml&quot; overwrite=&quot;false&quot; /&gt;
  &lt;property name=&quot;restore.from.path&quot; value=&quot;..\${database.name}.bak&quot; overwrite=&quot;false&quot; /&gt;
  
&lt;/project&gt;
</pre>
<p>
In template .bat file it is possible to refer, to some particular variable, so it is possible to make those quite generic. After build, template .bat files are post-processed and actual batch is generated. The name would be like <code>ENVIRONMENT.AppDeployment.bat</code>, where ENVIRONMENT is type of environment you defined.
</p>
<h2>Web site deployment script</h2>
<p>
If you do ASP.net (MVC) website in 99.9% cases you will be happy with simple <code>XCOPY</code> deployment type. Basically it means, simple copy of website to defined IIS folder. 
</p>
<p>
But, as soon it is continuous production deploy it means that Web Site is already running. It would not be possible to re-write some files, since they could be used by IIS. So, we need to stop the site before update. I found very good possibility for that with <code>%windir%\system32\inetsrv\appcmd</code> command. After site is stopped, we just copy full content of Web folder, remove some redundant files and run site again. In batch code it would look like,
</p>
<pre class="brush: plain">
@echo off

SET DIR=%~d0%~p0%

SET web.deploy.folder="${web.deploy.folder}"

echo stopping web site..
call %windir%\system32\inetsrv\appcmd stop site ${web.site.name}
if %ERRORLEVEL% NEQ 0 goto errors

echo copy application content
rmdir /s /q %web.deploy.folder%
xcopy /E /F /H /R ..\_PublishedWebSites\Web %web.deploy.folder%
xcopy ..\build_artifacts\_BuildInfo.xml %web.deploy.folder%
if %ERRORLEVEL% NEQ 0 goto errors

echo remove redudant files
del %web.deploy.folder%*Tests*.htm*
del %web.deploy.folder%Web.Debug.config  
del %web.deploy.folder%Web.Release.config 
del %web.deploy.folder%*packages* 
if %ERRORLEVEL% NEQ 0 goto errors

echo starting web site
%windir%\system32\inetsrv\appcmd start site ${web.site.name}
if %ERRORLEVEL% NEQ 0 goto errors

goto finish

:errors
EXIT /B %ERRORLEVEL%

:finish
</pre>
<h2>Database deployment script</h2>
<p>
<a href="http://www.beletsky.net/2010/10/roundhouse-your-database.html">RoundhousE</a> does all infrastructure work for us. All we need to create a batch file, that would be able to run during continuous production cycle. As well as <code>AppDeployment.bat</code> I defined <code>DbDeployment.bat</code> in <code>deployment\templates\</code> folder. But before any update of database it is always good to have a backup, to be able to restore from it if something went wrong. Actually, RoundhousE should have such ability, but unfortunately I didn&#8217;t get how to use it. I&#8217;ve created my simple SQL script that is able to backup.
</p>
<pre class="brush: sql">
USE $(Database);
GO
BACKUP DATABASE $(Database)
TO DISK = 'C:\backup\$(Database).bak'
   WITH FORMAT,
      MEDIANAME = 'C_SQLServerBackups',
      NAME = 'Full Backup of $(Database)';
GO
</pre>
<p>
And corresponding batch file, that would run <code>backup.sql</code>.
</p>
<pre class="brush: plain">
@echo off

if '%1' == '' goto usage
if '%2' == '' goto usage

sqlcmd -S %1 -i .\scripts\backupdb.sql -v Database = %2 -e
if %ERRORLEVEL% NEQ 0 goto errors

goto finish

:usage
echo.
echo Usage: backup.bat [server] [database]
echo [server] - server eg. mymachine\SQLEXPRESS
echo [database] - name of database to backup
echo.
EXIT /B 1

:errors
EXIT /B %ERRORLEVEL%

:finish
</pre>
<p>
Both files are placed into <code>deployment\scripts</code> folder. So, the <code>DbDeployment.bat</code> template, would first run database backup and if it is successfull, run RoundhousE to update database.
</p>
<pre class="brush: plain">
@echo off

SET database.name="${database.name}"
SET sql.files.directory="${dirs.db}"
SET server.database="${server.database}"
SET repository.path="${repository.path}"
SET version.file="${file.version}"
SET version.xpath="//buildInfo/version"
SET environment="${environment}"

echo backup database
call .\scripts\backupdb.bat %server.database% %database.name%
if %ERRORLEVEL% NEQ 0 goto errors

echo update database
"%DIR%rh\rh.exe" /d=%database.name% /f=%sql.files.directory% /s=%server.database% /vf=%version.file% /vx=%version.xpath% /r=%repository.path% /env=%environment% --ni --simple
if %ERRORLEVEL% NEQ 0 goto errors

goto finish

:errors
EXIT /B %ERRORLEVEL%

:finish
</pre>
<h2>Putting it all together</h2>
<p>
We already have <code>build.bat</code> as part of UppercuT, now we need to define <code>deploy.bat</code> that would do deployment of product. It would be called immediately after build.bat finished, so binaries are ready, tests passed and <code>code_drop</code> folder contains all artifacts for deployment. The script is rather simple and utilize stuff we did previously.
</p>
<pre class="brush: plain">
@echo off

if '%1' == '' goto usage

SET ENV=%1

cd .\code_drop\deployment

echo Deploy database
call .\%ENV%.DbDeployment.bat
if %ERRORLEVEL% NEQ 0 goto errors

echo Deploy application
call .\%ENV%.AppDeployment.bat
if %ERRORLEVEL% NEQ 0 goto errors

goto finish

:usage
echo.
echo tracky.net deploy script
echo Usage: deploy.bat [environment]
echo [environment] - deployment environment could be STAGING or PRODUCTION
echo.
EXIT /B 1

:errors
echo Build FAILED
EXIT /B %ERRORLEVEL%

:finish
echo Build SUCCESS
</pre>
<p>
Notice, it receives the parameter <code>ENV</code>. It will contain type of environment for deployment. For staging environment, you should call <code>deploy.bar STAGING</code>, for production <code>deploy.bat PRODUCTION</code>.
</p>
<h2>Testing it out</h2>
<p>
That&#8217;s basically it. Now, you should make sure everything works as expected. Run <code>build.bat/deploy.bat</code>, make sure build went with no errors, deploy.bat correctly does back up of database, updates database and update site content. 
</p>
<p>
As I said on top, it is very important that configuration is part of product, part of source code. If you follow this, it will be possible to deploy application but just getting sources from SCM. This is first step of setting up your Continuous Production server.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/04/continues-production-overview-and.html">
    
      Continuous Delivery: Overview and benefits</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-04-28T22:50:00+03:00" pubdate data-updated="true">Apr 28<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/continuous/'>Continuous</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
First time I&#8217;ve heard about continuous production systems about 5 years ago. I was amazed with simple idea, not only build binaries and run tests against it but: generate documentation, deploy and release! Wow. But that time, I&#8217;ve been working on product that distributed on CD&#8217;s and it was not really easy to build Continuous Production around that. Web changed the way of distribution of software - you need only to update one &#8220;place&#8221; and all users would immediately receive latest version. Continuous Production very much suites web product development and month ago I&#8217;ve created my own Continues Production configuration and now would like to share some thoughts and that topic.
</p>
<h2>(Integration + Deployment) * Continues = (Continuous Production)</h2>
<p>
As for me, formula of continuous production is simple.. Decide how to do integration, decide how to do deployment and make it run continuously. The process is triggered by event. Event is raised by some event source.
</p>
<h2>What I used for that?</h2>
<p>
It is basically 4 components: <a href="http://www.beletsky.net/2010/10/uppercut-your-builds.html">UppercuT</a> and <a href="http://www.beletsky.net/2010/10/roundhouse-your-database.html">RoundhousE</a> for Integration and Deployment. <a href="http://jenkins-ci.org/">Jenkins</a> as build server. <a href="http://github.com">Github</a> as event source and SCM. 
</p>
<p>
You should check my previous posts about configuration of <a href="http://www.beletsky.net/2010/10/uppercut-your-builds.html">UppercuT</a> and <a href="http://www.beletsky.net/2010/10/roundhouse-your-database.html">RoundhousE</a>. It rather simple and allowed me version all assemblies and database, build all binaries and web site, run tests and put all build artifacts to single package. It also generates deployment and database migration scripts.
</p>
<p>
I was really happy about <a href="http://jenkins-ci.org/">Jenkins</a>. It is easy to install, understand and configure. Even it is Java application, it allows you to work with .NET and contains infinite number of plugins for every need (Batch build, Nant, Git, Svn, Msbuild etc).
</p>
<h2>Why should I use that?</h2>
<p>
Ok, to explain you the value, I would describe my production process <strong>Before</strong> and <strong>After</strong> implementation of CP.
</p>
<h3>Before</h3>
<ol>
<li>Prepare release branch and merge all required changes there</li>
<li>Update version in uppercut.config</li>
<li>Commit changes to SCM</li>
<li>Run build.bat</li>
<li>FTP package to deployment server</li>
<li>RDP to deployment server</li>
<li>Unpackage .zip content to temp folder</li>
<li>Manually backup <em>staging</em> database</li>
<li>Stop Stage Web site in IIS manager</li>
<li>Run migration scripts for <em>staging</em> database</li>
<li>Run deployment scripts for <em>staging</em> environment</li>
<li>Run Stage Web site in IIS manager</li>
<li>Test manually that on <em>staging</em> server, that build works fine</li>
<li>If something missed (note it is 60% of all cases) go to 1</li>
<li>Manually backup <em>production</em> database</li>
<li>Stop Production Web site in IIS manager</li>
<li>Run migration scripts for <em>production</em> database</li>
<li>Run deployment scripts for <em>production</em> environment</li>
<li>Run Production Web site in IIS manager</li>
<li>Test manually that on <em>production</em> server, that build works fine</li>
</ol>
<p>
Depending on how much lucky I&#8217;m that took from 0.5 hour to 1.5 hour to update production server. Moreover, because it is all manual changes Down time of web site was about 3-5 minutes. Sad figures.
</p>
<h3>After</h3>
<ol>
<li>Prepare release branch and merge all required changes there</li>
<li>Update version in uppercut.config</li>
<li>Commit changes to SCM</li>
</ol>
<p>
That&#8217;s it! The rest is steps is being automated by CP server. 
</p>
<p>
It takes from 1 to 2 minutes total. Down time of site is now only 1 second. That means velocity of &#8220;going live&#8221; improved in 45x, site down time improved 300x. Taking into account that I spent near 10 hours to configure whole system, I would say - that was pretty good investment on time. My staging server is being updated every time I push new code changes, so I could immediately test it and correct. Production server update run manually, as soon as I got stable release branch with only one button click.
</p>
<h2>Further reading</h2>
<ul>
<li>Setup and run <a href="http://www.beletsky.net/2011/05/continues-production-setup-and-run.html">http://www.beletsky.net/2011/05/continues-production-setup-and-run.html</a></li>
<li>Make it work <a href="http://www.beletsky.net/2011/05/continuous-production-make-it-work.html">http://www.beletsky.net/2011/05/continuous-production-make-it-work.html</a>

</ul></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/04/prevention-of-jscss-content-to-be.html">
    
      Prevention of JS/CSS content to be cached</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-04-22T18:50:00+03:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
To do not waste a time in pauses between <a href="http://www.beletsky.net/search/label/Agile">AgileBaseCamp</a> talks I&#8217;ve created an utility that I wish to have, but had not time to do. It is very simple and solves caching issue for CSS and JS that we all suffered many times. Because every modern browsers try to cache static content, to make site rendering faster, we having trap then CSS or JS is being updated, but after deployment on production customers still see no results, because they use previous versions of files.
</p>
<h2>Classical way</h2>
<p>
Classical way of solving the issue is to add version info to content url and update it after each production update.
</p>
<pre class="brush: html">    
&lt;link rel=&quot;stylesheet&quot; href=&quot;Content/public.css?v=123&quot; type=&quot;text/css&quot; media=&quot;all&quot; /&gt;
&lt;script src=&quot;Scripts/script.js?v=123&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</pre>
<p>
The problem is that you have to remember to update version manually, before each deployment to production. That was something I was doing a lot and now decieded to automate it.
</p>
<h2>Better way</h2>
<p>
Idea is very simple, create a helper that would use version from assembly and append version to resource. Now, in markup I wrote:
</p>
<pre class="brush: html">
&lt;link rel=&quot;stylesheet&quot; href=&quot;@Url.ContentWithVersion(&quot;~/Content/public.css&quot;)&quot; type=&quot;text/css&quot; media=&quot;all&quot; /&gt;
&lt;script src=&quot;@Url.ContentWithVersion(&quot;~/Scripts/script.js&quot;)&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</pre>
<h2>Code</h2>
<pre class="brush: csharp">
namespace Web.Helpers.Extensions
{
    public static class UrlContentWithVersionExtension
    {
        private static string _currentAssemblyVersion;

        public static string ContentWithVersion(this UrlHelper helper, string path)
        {
            var contentPath = helper.Content(path);
            var assemblyVersionString = GetAssemblyVersionString();

            return string.Format("{0}?ver={1}", contentPath, assemblyVersionString);
        }

        private static string GetAssemblyVersionString()
        {
            if (_currentAssemblyVersion == null)
            {
                var currentAssemblyVersion = Assembly.GetExecutingAssembly().GetName().Version;
                _currentAssemblyVersion = currentAssemblyVersion.ToString().Replace(".", "");
            }

            return _currentAssemblyVersion;
        }
    }
}
</pre>
<p>
And don&#8217;t forget that each page that uses the extension method, should include this namespace:
</p>
<pre class="brush: html">
&lt;!-- For MVC2 --&gt;
&lt;%@Import Namespace=&quot;Web.Helpers.Extensions&quot; %&gt;

&lt;!-- For MVC3 (Razor) --&gt;
@using Web.Helpers.Extensions
</pre>
<h2>Example of usage</h2>
<p>
As always all code is on github, so extension itself is <a href="https://github.com/alexanderbeletsky/trackyt.net/blob/master/src/Web/Helpers/Extensions/UrlContentWithVersionExtension.cs">here</a>. And commit there I integrated changes is <a href="https://github.com/alexanderbeletsky/trackyt.net/commit/ef38ebcd1230404b9e5c62877e256aff7e95ad64">here</a> (would be useful to review, before your actual changes).
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/04/agilebasecamp-kiev-2011-dmitry-mindra.html">
    
      AgileBaseCamp Kiev 2011: Dmitry Mindra: Design by Contract in .NET</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-04-20T12:05:00+03:00" pubdate data-updated="true">Apr 20<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/agile/'>Agile</a>, <a class='category' href='/blog/categories/conference/'>Conference</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
<small>
<strong>Disclaimer:</strong> text below is compilation of notes I made on AgileBaseCamp 2011 conference, listening to different speakers. I do it to keep knowledge I got on conference, share it with my colleagues and anyone else who interested. It is only about how I heard, interpret, write down the original speech. It also includes my subjective opinion on some topics. So it could not 100% reflects author opinion and original ideas. 
</small>
</p>
<p>
<a href="http://kiev.agilebasecamp.org/mindra/">Dmitry Mindra</a> prepared very nice speech dedicated to <a href=http://en.wikipedia.org/wiki/Design_by_Contract">Code Contracts</a>. He opens ideas what the Code Contacts are and more important how to &#8220;Design by contract&#8221;. This speech has been especially interested to me, since I never heard/used such type of design.
</p>
<h2>Design by contract in short</h2>
<p>
Desing by contracts has been introduced by <a href="http://en.wikipedia.org/wiki/Bertrand_Meyer">Bertrand Mayer</a>. He is one of original creator of Eiffel language. No surprise that first time contract&#8217;s have been added in Eiffel. The contract consists on 3 parts: Preconditions/Postconditions/Invariants.
</p>
<ul>
<li><strong>Preconditions</strong> - check that client does everything OK</li>
<li><strong>Postconditions</strong> - check that server does everything OK</li>
<li><strong>Invariant</strong> - check that state of object valid for next call</li>
</ul>
<p>
In Eiffel you have special sections in each method called (require, do, post) there it is possible to put contract definition.
</p>
<p>
By specifying the contract we specify exact constraints for code. Typically methods have some input parameters and return some results to outside world. For instance we have class <code>Account</code> with method <code>Withdraw</code>, we are expecting that argument that <code>Withdraw</code> receives are always positive and return results also is greater than zero. 
</p>
<h2>Wait, I can already specify contract with my beloved exceptions</h2>
<p>
Many of us, get used to write such code..
</p>
<pre class="brush: csharp">
public Amount Withdraw(Amount amountToWithdraw)
{
 if (amountToWithdraw == null)
 {
  throw new ArgumentException("amountToWithdraw");
 }
 
 if (amountToWithdraw.Value <= 0)
 {
  throw new ArgumentException("amountToWithdraw.Value");
 }
 
 var result = //.. calculate operation here.. ;
 
 if (result.Value <= 0)
 {
  throw new AccountOperationException();
 }
 
 return result;
}
</pre>
<p>
It is definitely the way of creation robust application (in case of all those conditions are tested and client code properly handles exceptions). But is has several drawbacks:
</p>
<ul>
<li>It is only run-time mechanism</li>
<li>It is not possible to turn on or turn off the exceptions</li>
<li>This type of contract is &#8220;method-wide&#8221;, but how can you specify &#8220;class-wide&#8221; contract?</li>
<li>All of if / throw statements are &#8220;code-garbage&#8221; that make it difficult to read</li>
</ul>
<h2>What we have in .NET?</h2>
<p>
The Common Language Runtime (CLR) team is introducing a library to allow programming with contracts in the Microsoft .NET Framework 4. Adding them as a library allows all .NET languages to take advantage of contracts. This is different from Eiffel or Spec#, a language from Microsoft Research (research.microsoft.com/en-us/projects/specsharp/), where the contracts are baked into the language. Code Contracts System in .NET consists of 4 parts: 
</p>
<ul>
<li><code>System.Diagnostics.Contracts</code> contract library where <code>Contract</code> class is defined.</li>
<li><code>ccrewrite.exe</code> tool that modifies the Microsoft Intermediate Language (MSIL) instructions of an assembly to place the contract checks where they belong.</li>
<li><code>cccheck.exe</code> contract static checker, that examines code without executing it and tries to prove that all of the contracts are satisfied.</li>
<li><code>ccrefgen.exe</code> which will create separate contract reference assemblies that contain only the contracts.
</ul>
<h2>Why is it useful?</h2>
<p>
Let&#8217;s rewrote the previous example with code contracts:
</p>
<pre class="brush: csharp">
public Amount Withdraw(Amount amountToWithdraw)
{
 // preconditions..
 Contract.Requires&lt;NullReferenceException&gt;(amountToWithdraw);
 Contract.Requires(amountToWithdraw.Value);

 // action
 var result = //.. calculate operation here.. ;
 
 // postconditions 
 Contract.Ensures(result.Value <= 0);
 
 return result;
}
</pre>
<p>
I like the style, because this code a little reminds me TDD AAA (arrange/act/assert) pattern, code side is smaller and we are getting benefits of .NET Code Contracts.
</p>
<p>
What benefits here?
</p>
<ul>
<li>Static code analysis - during the compilation code is checked for contracts, if somewhere I wrote <code>account.Withdraw(null)</code> it would be immediately caught by cccheck.exe</li>
<li>Runtime execution - if error is missed on compilation time, it would be caught on run time and proper exception is thrown</li>
<li>I could configure to include or exclude contracts check at final assembly</li>
</ul>
<h2>Ok, I want to use it</h2>
<p>
To have a full support of Code Contracts you have to have .NET framework 4.0 and Visual Studio Premium or Ultimate. So, Code contracts are pretty expensive stuff. As far as I get from Dmitry speech it is possible to use <code>System.Diagnostics.Contracts</code> but limited capabilities are enabled only.
</p>
<p>
So, contract are great for building Life-critical and High-robust application where the quality / cost ratio makes sense for you.
</p>
<h2>Materials</h2>
<ul style="list-style: none outside none;">
<li><a href="http://www.slideshare.net/dmytromindra/code-contracts-abc-16042011-7656875?from=ss_embed">http://www.slideshare.net/dmytromindra/code-contracts-abc-16042011-7656875?from=ss_embed</a></li>
<li><a href="http://msdn.microsoft.com/en-us/magazine/ee236408.aspx">http://msdn.microsoft.com/en-us/magazine/ee236408.aspx</a></li>
<li><a href="http://msdn.microsoft.com/en-us/devlabs/dd491992">http://msdn.microsoft.com/en-us/devlabs/dd491992</a></li>
</ul></div>

      
      
    </div>
  </div>

    </article>
  
  <div class="pagination inner pure-u-1">
    
      <a class="prev" href="/blog/page/15/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/13/">Newer &rarr;</a>
    
  </div>
</div></div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright © 2010 - 2013 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>