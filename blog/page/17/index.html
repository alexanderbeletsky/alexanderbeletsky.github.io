
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Beletsky's development blog</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="The best day in developer&#8217;s life Mar 16th, 2011 Life What would you think is best day in developers life? First day of work, last one? Salary &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/blog/page/17/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/medium">Medium</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><div class="blog-index">
  
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/03/best-day-in-developers-life.html">
    
      The best day in developer&#8217;s life</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-03-16T20:27:00+01:00" pubdate data-updated="true">Mar 16<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/life/'>Life</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
What would you think is best day in developers life? First day of work, last one? Salary or bonuses payment day? All of those are pretty nice, indeed. But I think best day in developers life is day of Release. It is exactly the time than the code you created recently is being pushed out to production and customers are able to see what changes you&#8217;ve done so far. Release makes a really good feeling of &#8220;work is done&#8221;. In reality, of cause, work is not stopped but only begins after release date - production issues, customer reports, change requests.. all of these still need to be handled.
</p>
<p>
Releasing a product is big job. And it is not all about coding. First of all it is well coordinated effort of all groups - Development, QA, Documentation, Product Owners, Stakeholders etc. I&#8217;ve seen situations than products that could be potentially released just stuck on a line, because of lack of coordination. Here the team atmosphere plays important role. If team sees the goal, agreed on method and tools and communicated well it is a big step to success.  
</p>
<p>
Yesterday, Report Designer product that is part of <a href="http://e-conomic.com">E-conomic</a> has been released. It took about an year to make this happen. Huge amount of work were done, many lessons learned. We&#8217;ve passed long way from Specification till Integration code to main branch. I personally that it was just too long. With current experience I see a lot of value in frequent releases, so I tend to just-in-time production practices as <a href="http://en.wikipedia.org/wiki/Kanban">Kanban</a>. I world of web products, feedback is extremely fast and cost of defect is not so high, comparing to desktop. 
</p>
<p>
It is good time to exhale, inhale fresh air and self-motivate for next interesting projects. We are now looking forward to make a better codebase, better processes and better products as result. Let&#8217;s start new adventure!
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/03/clean-tests-with-sharptestsex.html">
    
      Clean tests with SharpTestsEx</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-03-12T09:25:00+01:00" pubdate data-updated="true">Mar 12<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/clean-code/'>Clean Code</a>, <a class='category' href='/blog/categories/open-source/'>Open source</a>, <a class='category' href='/blog/categories/tdd/'>TDD</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
I was recently been adding NUnit to one of mine project&#8217;s and noticed one interesting framework in <a href="http://nuget.codeplex.com/">Nuget</a> channel. It is <a href="http://sharptestex.codeplex.com/">SharpTestsEx</a> by <a href="http://twitter.com/#!/fabiomaulo">Fabio Maulo</a> and its primary goal is to make your assertions shorter, cleaner and easy to read.
</p>
To start with, it is just enough to install it through Nuget (or manually) and add using statement in your test class file.
<p>
<pre class="brush: csharp">
using SharpTestsEx;
</pre>
<p>
SharpTestsEx would add number of <code>Should()</code> extension methods. Suppose you have such case:
</p>
<pre class="brush: csharp">
[Test]
public void Compile_Div_EmptyDivElement()
{
    // arrange
    var compiler = new Compiler();

    // act
    var result = compiler.Compile("div");

    // assert
    Assert.That(result, Is.Equal("&lt;div&gt;&lt;/div&gt;"), "expected and actual results are different");
}
</pre>
<p>
With SharpTestsEx I&#8217;m changing assert part of test to,
</p>
<pre class="brush: csharp">
[Test]
public void Compile_Div_EmptyDivElement()
{
    // arrange
    var compiler = new Compiler();

    // act
    var result = compiler.Compile("div");

    // assert
    result.Should().Be.EqualTo("&lt;div&gt;&lt;/div&gt;");
}
</pre>
<p>
Note, it is much shorter and mostly plain English sentence: <i>result should be equal to something</i>.. The assertion message for this test is really clean and sufficient, so you mostly won&#8217;t needed and custom messages.
</p>
<p>
If I go further and implement extension method for this <code>Compile</code> method:
</p>
<pre class="brush: csharp">
static class CompilerTestExtension
{
    public static string Compile(this string expression)
    {
        var c = new Compiler();
        return —Å.Compile(expression);
    }
}
</pre>
<p>
My tests case would be just one line of code:
<pre class="brush: csharp">
[Test]
public void Compile_Div_EmptyDivElement()
{
    // arrange / act / assert
    "div".Compile().Should().Be.EqualTo("&lt;div&gt;&lt;/div&gt;");
}
</pre>
<p>
This is very short and clean notation of test case, even not technical person could read this. You can do more complicated assertions, combining them by <code>And</code> / <code>Not</code> conditions. There are also bunch of useful extensions for strings, sequences.
</p>
</p>
Additional information on project <a href="http://sharptestex.codeplex.com/">site</a> as well as author <a href="http://fabiomaulo.blogspot.com/search/label/SharpTestEx">blog</a>.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/03/my-first-year-in-company.html">
    
      My first year in company</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-03-10T09:02:00+01:00" pubdate data-updated="true">Mar 10<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/e-conomic/'>e-conomic</a>, <a class='category' href='/blog/categories/life/'>life</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
It is exactly one year since I joined <a href="http://e-conomic.com">E-conomic</a> company. Last year I decided to switch the jobs and now I realize how much right decision it was. I got invitation on interview to <a href="http://e-conomic.com">E-conomic</a> where I did a small test application and presented it to management and technical guys (hi Jakob, Chistian). I had no great experience with ASP.net that time, since last years of my career I spent mostly on management tasks. Really, I just reviewed the code that I created year ago and I see it was not so good :). Fortunately, those guys believed that I could bring a value and offer me a job. Since then I try to do my best to proof - you were not wrong.
</p>
<p>
I see work in company as kind of mariage. Indeed, to feel happy in marriage you should have really strong match and level of trust to each other. Probably it is <a href="http://e-conomic.com">E-conomic</a> where I first time understood how important trust between development and management. I forgot what the &#8220;estimation negotiation&#8221;, I forgot the problems with unrealistic project plans created by management and business guys. A lot of problems that only created conflicts on my previous jobs here done in very smooth way.
</p>
<p>
We are developer-centric company. Developers have power here, developers take a decisions, developers do the job. But <a href="http://en.wikipedia.org/wiki/Uncle_Ben">with great power comes great responsibility</a>. Developers are totally responsible for product quality. Here I saw a new model, not &#8220;Software Developer&#8221; but rather &#8220;Product Developer&#8221;.. Product developers job is not ended on coding and integration changes, but it is more for verification, configuration management and release. We don&#8217;t have testers here, but we have QA. And developers are part of QA also.
</p>
<p>
I enjoy the environment here very much. Even we are highly distributed team I feel the shoulder of each team mate. We working closer, doesn&#8217;t matter we are sitting &gt;1000 km from each other. That was not so fast to get used to work like that, but now I have no problems at all. I really think that I&#8217;m part of the rest of team who mainly located in Copenhagen. This environment constantly inspires: I was happy to restore my blog (that I created in 2008, but then froze it), I do a lot of reading to understand modern web development, I <a href="http://www.beletsky.net/2010/11/ive-release-my-own-product-trackytnet.html">released</a> my small product.. and have bunch of new ideas and feel only lack of time to work on all of them :).
</p>
<p>
I would also say that <a href="http://www.ciklum.net/">Ciklum</a> as Ukrainian representative does job very well. Basically 2 major things that I see Ciklum is great: it handles all infrastructure and finance very professional and does not interfere to work directly with client. If I have some kind of problem I know Ciklum would solve it, this is also good level of trust and I appreciate that.
</p>
<p>
Yes, I&#8217;m just happy developer now. And I really much correlate this with <a href="http://e-conomic.com">E-conomic</a>. Last year decision changed my life. I think I found the place where I like to work, even if I spend more than 7 years for that.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/03/integrating-elmah-to-aspnet-mvc-in.html">
    
      Integrating ELMAH to ASP.NET MVC in right way</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-03-05T18:36:00+01:00" pubdate data-updated="true">Mar 5<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/elmah-dot-mvc/'>ELMAH.MVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p><small> I&#8217;ve received great feedback on this article. Thanks all of you guys, who provided valuable comments and pull requests on github. I edited the article several time, hope its up-to-date now. You can go directly to <a href="https://github.com/alexbeletsky/elmah.mvc.controller">code repository</a> and get the test application, to see what it is all about. In case if you having some issues, just let me know. </small> </p><p style="color: red"><strong>UPDATE:</strong> Elmah.MVC is now <a href="http://www.beletsky.net/2011/08/elmah-mvc-controller-released-on-nuget.html">released</a> as NuGet package. No need to read that long blog post, just install it.  <p>Many of you know what the ELMAH is. If you still don&#8217;t, go and read <a href="http://code.google.com/p/elmah/">here</a>. If you care about monitoring and stability of your web application, you definitely consider to integrate ELMAH. There are number of guidelines of how to do that. But all of them do not answer several question that MVC developers really concerned about: </p><ul><li> How to add ELMAH as usual MVC controller? </li>
<li> How to add ELMAH handler to make it secure (accessible only by authorized users) in MVC application? </li>
</ul><p>I&#8217;ll shed the light on both questions here. </p><h2>Quick start up </h2><p>The best way to add ELMAH is to use <a href="http://nuget.codeplex.com/">Nuget</a> package manager (really recommend to install it). I&#8217;m using Nuget UI, so just right click on MVC application, select <i>&#8220;Add Library Package Reference</i> and pickup ELMAH from nuget feed. Nuget will add reference and update <code>web.config</code> with all required configuration. Basically you can start you application with <code>http://localhost/yourapp/elmah.asx</code> and see main ELMAH page. </p><h2>Changing the configuration </h2><p>ELMAH have been developed in ancient history times of Web Forms. And it is nicely done to be as much universal as possible and implemented as HttpHandler. In <code>web.config</code> you have several line of configuration that register this handler. This is of cause works, but URI like this <code>http://localhost/yourapp/elmah.asx</code> is absolutely not MVC way. So, what you have to do is simply comment out those configuration. </p><pre class="brush: xml">&lt;system.web&gt;

        &lt;!--&lt;httpHandlers&gt;
            &lt;add verb=&quot;POST,GET,HEAD&quot; path=&quot;elmah.axd&quot; type=&quot;Elmah.ErrorLogPageFactory, Elmah&quot; /&gt;
        &lt;/httpHandlers&gt;--&gt;

    &lt;/system.web&gt;

&lt;system.webServer&gt;

    &lt;!--&lt;handlers&gt;
    &lt;remove name=&quot;Wild&quot; /&gt;
    &lt;add name=&quot;Elmah&quot; verb=&quot;POST,GET,HEAD&quot; path=&quot;elmah.axd&quot; type=&quot;Elmah.ErrorLogPageFactory, Elmah&quot; /&gt;
    &lt;/handlers&gt;--&gt;

&lt;/system.webServer&gt;
</pre><h2>Add ELMAH controller </h2><p>Now add ELMAH controller to application, the code of controller is: </p><pre class="brush: csharp">public class ElmahController : Controller
{
    public ActionResult Index(string type)
    {
        return new ElmahResult(type);
    }
}
</pre><p>And setup a proper routing for it: </p><pre class="brush: csharp">context.MapRoute(
    "Admin_elmah",
    "Admin/elmah/{type}",
    new { action = "Index", controller = "Elmah", type = UrlParameter.Optional }
);
</pre><h2>Implementation of ElmahResult action result </h2><p>He we go for most interesting part. I&#8217;ve checked the sources of ELMAH and reused <code>Elmah.ErrorLogPageFactory</code> to handle those custom HTTP request. After several modifications and pull request by <a href="https://github.com/seba-i">seba-i</a> the code is: </p><pre class="brush: csharp">class ElmahResult : ActionResult
{
    private string _resouceType;

    public ElmahResult(string resouceType)
    {
        _resouceType = resouceType;
    }

    public override void ExecuteResult(ControllerContext context)
    {
        var factory = new Elmah.ErrorLogPageFactory();

        if (!string.IsNullOrEmpty(_resouceType)) {
            var pathInfo = "." + _resouceType;
            HttpContext.Current.RewritePath(PathForStylesheet(), pathInfo, HttpContext.Current.Request.QueryString.ToString());
        }

        var httpHandler = factory.GetHandler(HttpContext.Current, null, null, null);
        httpHandler.ProcessRequest(HttpContext.Current);
    }

    private string PathForStylesheet()
    {
        return _resouceType != "stylesheet" ? HttpContext.Current.Request.Path.Replace(String.Format("/{0}", _resouceType), string.Empty) : HttpContext.Current.Request.Path;
    }
}
</pre><h2>Try it now </h2><p>Just build the application and put <code>http://localhost/yourapp/admin/elmah</code> and you will get nice looking ELMAH main page. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/-4zN-4tT3uVQ/TXJ0td3aMhI/AAAAAAAAHUs/i9qSfE3rG3w/s1600/screen.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://4.bp.blogspot.com/-4zN-4tT3uVQ/TXJ0td3aMhI/AAAAAAAAHUs/i9qSfE3rG3w/s400/screen.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5580651212725432850" /></a> <h2>Making it secure </h2><p><a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.authorizeattribute.aspx">AuthorizeAttribute</a> works great for this purpose. Just put this attribute to <code>ElmahController</code> and now it is only Admin, who has access to it.  </p><pre class="brush: csharp">[Authorize(Users = "Admin")]
public class ElmahController : Controller
{
    // ...
</pre><p>In my applications I use a custom attribute, but the idea still the same.  </p><h2>Allow to view results remotely </h2><p>You definitely want to see results remotely, with no need to access hosting machine. By default, ELMAH do not allow this, but it is easily changed in configuration: </p><pre class="brush: xml">&lt;elmah&gt;
  &lt;security allowRemoteAccess=&quot;yes&quot; /&gt;
</pre><h2>Code example </h2><p>Full code example is located in my github repository <a href="https://github.com/alexbeletsky/trackyt.net/blob/master/src/Web/Areas/Admin/Controllers/ElmahController.cs">here</a>. </p><br />
<h2>UPD:</h2><p>I&#8217;ve moved out controller to separate github repostitory. You are free and very welcome to use/fork/pull changes :). Fork & fix it here - <a href="https://github.com/alexbeletsky/elmah.mvc.controller">https://github.com/alexbeletsky/elmah.mvc.controller</a>. </p><h2>UPD2:</h2><p>Instead of placing just controller I create test MVC3 application that clearly show how to use Elmah in MVC. Plese check code and README  <a href="https://github.com/alexbeletsky/elmah.mvc.controller">here</a>. </p><h2>UPD3:</h2><p>Code placed in this blog post has been changed drastically by latest feedback I recieved for this controller. Please better refer code on github or latest blog post here <a href="http://www.beletsky.net/2011/08/latest-version-of-elmah-mvc-controller.html">Latest version of ELMAH MVC controller</a> </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/seleniumcamp-conference-in-kiev.html">
    
      SeleniumCamp conference in Kiev</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-28T13:56:00+01:00" pubdate data-updated="true">Feb 28<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/conference/'>Conference</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
I had a chance to be present on a <a href="http://seleniumcamp.com/">SeleniumCamp</a> conference that took place 26 of February. It was first Selenium dedicated conference in a <a href="http://seleniumcamp.com/about/">world</a>, so it was bad idea to miss it. Moreover, my colleague from Dnepropetrovsk <a href="http://samarskyy.blogspot.com/">Anton</a> was coming there also, so we had a good time to meet each other again. 
</p>
<p>
Event has been organized by <a href="http://xpinjection.com/">Xp Injection</a> group. I&#8217;ve been <a href="http://www.beletsky.net/2010/10/agileee-2010-mikalai-alimenkau-aleksey.html">listen</a> those guys last year on Agileee, I also read their blog from time to time, so I was pretty confident of what is going be all about. Event took place in Bratislava hotel. Here is a brief summary of stuff I heard there:
</p>
<ul>
<li>
<a href="http://seleniumcamp.com/speakers/#burns">David Burns</a> was the one who did open speech. He is Senior Software Engineer in Test at Mozilla working as the Automation Lead in WebQA and one of Selenium Core commiter. David was describing Selenium 2 and <a href="http://google-opensource.blogspot.com/2009/05/introducing-webdriver.html">WebDriver</a> ideas as primary part on Selenium 2 framework. In spite of Selenium RC, Web driver: 
    <ul>
        <li>Uses native browser API, so works much more faster</li>
        <li>Reduces and clear API</li>
        <li>More reliable</li>
    </ul>
    It means that WebDrivers should be tool of choice for functional testing in nearest future. As far as I get Selenium 2 is not officially release and currently in Beta phase.
</li>
<li>
<a href="http://twitter.com/#!/f0g">Kirill Klimov</a> did an speech about his experience of deployment Selemium in company. He shared some pros and cons of each Selenium umbrella products: from Core to Grid. They stated to use Selenium from IDE, seems the most easy scenario of using functional tests. Then they switched to Core and RC. Kirill has very good understanding of &#8220;what&#8217;s going on&#8221; and summaries speech with several recommendations I think very useful:
    <ul>
    <li>
        Don&#8217;t be hurry to start up
    </li>
    <li>
        Understand the difference in tools and pick up right one
    </li>
    <li>
        Try to elaborate in several years perspective
    </li>
    </ul>
    Slides from his presentation is <a href="http://www.slideshare.net/f0g/selenium-guide">here</a>
</li>
<li>
    <a href="http://twitter.com/#!/mairbek">Mairbek Khadikov</a> shared his own vision of web applications testing automation. Through 2 years of usage Selenium they came up with bunch of tests and realized the power of automation. Most important that value shared between business and development. He touch such important issues as performance, tests isolations. It is very important to write tests that might be read 
    by non-technical guys. In such case tests starting to be a part of project documentation and used not only be development team. He also noticed that test should be architecture to be run in parallel as early as possible, it is just matter of time then you going to run tests by Grid (for instance) and you will meet a problem. He did several examples of Tests written on Java, so developers had a little fun to see the code. His presentation is stored <a href="http://www.slideshare.net/mairbek/ss-7079843">here</a>.
</li>
<li>
    <a href="http://twitter.com/#!/twincengray">Alexey Rezhchikov</a> did one of the most impressive speech as for me. He works on huge and high complexity project(s) for Ebay Motors (as far as I got). They are dealing with complex requirements, multicultural, high loaded sites with difficult configuration management. He clearly described problems any big project meet in a way towards Release. Nevertheless, they&#8217;ve implemented and successfully using solution stack based on Selenium platform (not only). Using different level of testing to meet acceptance goal, they are very flexible in decision &#8220;go or not to go with automated test&#8221; and &#8220;what kind of test is OK for this particular scenario&#8221;. I also bit impressed by usage a <a href="http://code.flickr.com/blog/2009/12/02/flipping-out/">Feature Flags</a> as opposite way of multibranch development. . His presentation <a href="http://slidesha.re/f3uMra">here</a>.
</li>
<li>
    <a href="http://twitter.com/#!/xpinjection">Nikolai Alimenkov</a> was selling ideas of using Wiki as &#8220;live&#8221; requirements. The whole approach back us to Fitnesse ideas of keeping requirements in a Wiki-style storage, placing acceptance conditions into to tables and &#8220;somehow&#8221; run Fitnesse tests against target applications. With my big respect to <a href="http://en.wikipedia.org/wiki/Robert_Cecil_Martin">Robet C. Martin</a>, original developer of Fitnesse, I don&#8217;t believe that stuff works. I don&#8217;t believe that Product Owner will ever work with requirements in Wiki will run them. Moreover, it seems a big overhead to me to support all that wiki&#8217;s in up-to-date in world of changing requirements. Nikolai showed Fitnesse based tools as Fitnium, Selenesse and some tests examples but it was to artificial to me. You can find his presentation <a href="http://www.slideshare.net/alimenkou/selenium-wiki-executable-specification">here</a>.
</li>
<li>
    <a href="http://automated-testing.info/users/kanon">Nikolai Kolesnik</a> seems to have a good plan to describe BDD, but was quite nervous and shy that interfered him to make a good speech. Nevertheless, he expressed his understanding and application of BDD for real projects, pitfals and solutions based on Selenium RC. You can find his presentation <a href="http://www.slideshare.net/kolesnik_nickolay/bdd-approach-with-selenium-rc">here</a>. 
</li>
</ul>
<p>
In short, I enjoyed the conference.. but I would not say it is something I expected. Most speeches I visited, was a kind of &#8220;too many word&#8217;s, too few real examples&#8221;. Guys, please if you are talking about product for developers - <strong>show me the code</strong>. All the idea&#8217;s of ATDD, BDD, Acceptance testing, Wiki are requirements are already <strong>sold</strong> years ago, don&#8217;t do the job that is already done. But, show some your projects, show real test cases, show examples. 
</p>
<p>
I would like to THANK my <a href="http://e-conomic.com">company</a> who make it possible to me to visit this conference.
</p>
<p>
PS. for foreign guys: Bratislava hotel is very cold, avoid it to stay on winter time :).
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/github-commits-activity-widget.html">
    
      Github commits activity widget</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-26T12:43:00+01:00" pubdate data-updated="true">Feb 26<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/open-source/'>Open source</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
The most important factor about each open source project is how much community is active around this project. It is good to understand the factor. One of the indicators of activity is of cause commits to repository. You probably want to demonstrate how much active your project is by placing some information on a web site.
</p>
<p>
Having this idea on my mind I created <code>github.commits.widget</code>, small javascript that could be easily integrated to your website and show something like this:
</p>
<div id="github-commits" style="border: 1px solid grey; padding: 5px; list-style: none"></div>
<p>
Note, it is not just html pasted.. but widget added to this blog post.
</p>
<p>
The code is really simple for that:
</p>
<pre class="brush: html">
&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;github.commits.widget-min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    $(function () {
        $('#github-commits').githubInfoWidget(
      { user: 'alexanderbeletsky', repo: 'github.commits.widget', branch: 'master', last: 5 });
    });
&lt;/script&gt;
</pre>
<p>
To configure all you need to do: specify your github account, repository and branch to watch. For more documenation, please visit <a href="https://github.com/alexbeletsky/github.commits.widget">project page</a>. If you like it and want to use it on your website, you are very welcome to do it! Please just give a little feedback to either by <a href="https://github.com/alexbeletsky">github</a>, <a href="http://twitter.com/#!/alexbeletsky">twitter</a> or <a href="mailto:alexander.beletsky@gmail.com">mail</a>.
</p>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
<script src="https://github.com/alexbeletsky/github.commits.widget/raw/master/js/github.commits.widget-min.js"></script>
<script>
    $(function () {
        $('#github-commits').githubInfoWidget(
  { user: 'alexanderbeletsky', repo: 'github.commits.widget', branch: 'master', last: 5 });
    });
</script></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/implementation-of-rest-web-service.html">
    
      Implementation of REST web service adapter on .NET</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-24T13:58:00+01:00" pubdate data-updated="true">Feb 24<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/rest/'>REST</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
The REST web services are quite common thing nowadays. Sure, web application just expose API through HTTP protocol, basically allowing any application to be integrated with. Simple? Yes, this is the power of REST, just simple. But vendor should consume the API somehow. The environment could really be different: .NET, Java, Python, PHP etc., and it it not so convenient to work with HTTP directly from your custom application. Instead of that you expect on &#8220;native&#8221; API that you work with like the rest of application: having a model, methods that returns of change model state. You expect on having <code>Adapter</code> - the entity which would adapt REST HTTP methods into your platform/language methods. I&#8217;m going to give example of creation such adapter for .NET code.
</p>
<p>
Doesn&#8217;t matter what language you write it the steps of adapting is quite common, here they are:
</p>
<h2>Learn the API</h2>
<p>
Let&#8217;s have <a href="http://www.trackyt.net/Home/ApiV11">Trackyt.net API</a> as an example. First thing you need to do is to learn API. REST API differs much from site to site, depending of developers tools and choice. All you need to understand the exact methods you need, their signature and data they operate with. Let&#8217;s take <code>Authenticate</code> method: so we see, it takes 2 arguments, email and password and in response it returns JSON object, containing operation result and API token. That means:
</p>
<pre class="brush: plain">
URL: http://trackyt.net/api/v1.1/authenticate
</pre>
<p>
Will be transformed in such C# method, like <code>Authenticate</code> that receives email and password as arguments and return ApiToken as results. Note, <code>ApiToken</code> is first model class we identified.
</p>
<p>
And call like this:
</p>
<pre class="brush: plain">
http://trackyt.net/api/v1.1/af005f695d300d0dfebbd574a4b1c0fa/tasks/all
</pre>
<p>
Is actually transformed in something like <code>GetAllTasks</code> that recieves ApiToken object and returns <code>IList&lt;Task&gt;</code>. <code>Task</code> is yet another model class we have to deal with.
</p>
<p>
This is a kind of analysis stage of implementation, you just need to understand interface and model.
</p>
<h2>Define interface and model</h2>
<p>
After you done you are ready to define interface:
</p>
<pre class="brush: csharp">
public interface ITrackytApiAdapter
{
    ApiToken Authenticate(string email, string password);

    IList&lt;Task&gt; GetAllTasks(ApiToken token);
    Task AddTask(ApiToken token, string description);
    int DeleteTask(ApiToken apiToken, int taskId);
    Task StartTask(ApiToken apiToken, int taskId);
    Task StopTask(ApiToken apiToken, int taskId);
    void StartAll(ApiToken apiToken);
    void StopAll(ApiToken apiToken);
}
</pre>
<p>
You see that all methods, defined in <a href="http://www.trackyt.net/Home/ApiV11">documentation</a> are reflected as interface methods, all data accepted/returned by methods are defined as <a href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object">POCO</a>.
</p>
<pre class="brush: csharp">
public class ApiToken
{
    public ApiToken(string token)
    {
        Value = token;
    }

    public String Value { get; private set; }
}

public class Task
{
    public int Id { set; get; }
    public string Description { set; get; }
    public DateTime CreatedDate { set; get; }
    public DateTime? StartedDate { set; get; }
    public int Status { set; get; }
}
</pre>
<h2>Integration testing</h2>
<p>
Is it possible to code without tests? I don&#8217;t think so. So, what we are going to do - one by one, tests all adapter methods. That&#8217;s should not be &#8220;super-duper-complex&#8221; test (at least during initial implementation), but rather smoke test ones. Do the call and see that results back. Here is just a several examples of tests for <code>Authentication</code> and <code>GetAllTasks</code>.
</p>
<pre class="brush: csharp">
[Test]
public void Authenticate_AuthenicationSuccess_ReturnApiToken()
{
    // arrange
    var adapter = TrackytApiAdapterFactory.CreateV11Adapter();

    // act
    var apiToken = adapter.Authenticate(_email, _password);

    // assert
    Assert.That(apiToken, Is.Not.Null);
    Assert.That(apiToken.Value, Is.Not.Null);
}

[Test]
[ExpectedException(typeof(NotAuthenticatedException))]
public void Authenticate_AuthenticationFailed_ExceptionThrown()
{
    // arrange
    var adapter = TrackytApiAdapterFactory.CreateV11Adapter();

    // act
    var apiToken = adapter.Authenticate("nouser", "noemail");
}
</pre>
<h2>Implementation</h2>
<p>
There are 2 very suitable components you might use for any REST API adapters:
</p>
<ul>
<li>
<a href="http://james.newtonking.com/pages/json-net.aspx">James Newton JSON.net</a> library - the best framework to handle JSON&#8217;s in .NET (imho). I enjoy how easy to serialize and deserialize of data with JSON.net.
</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/system.net.webclient(v=vs.80).aspx">WebClient</a> object - that is part of .NET framework and encapsulate all basic HTTP functions.
</li>
</ul>
<p>
Here we go. Our task is to send HTTP request to server, check it for correctness and transform server reply to .NET objects. To do that is great to model all responses into POCO (as we did with model classes <code>ApiToken</code> and <code>Task</code>). The difference is that <code>Responses</code> are actually internal classes, part of implementation and adapter users should know nothing about them. For instance let&#8217;s see <code>AuthenticationResponse</code>
</p>
<pre class="brush: csharp">
class AuthenticationResponse : BaseResponse
{
    internal class ResponseData
    {
        [JsonProperty("apiToken")]
        public string ApiToken { set; get; }
    }

    [JsonProperty("data")]
    public ResponseData Data { set; get; }
}
</pre>
<p>
The base response is some common part of data that every response suppose to contain. In my case:
</p>
<pre class="brush: csharp">
class BaseResponse
{
    [JsonProperty("success")]
    internal bool Success { set; get; }

    [JsonProperty("message")]
    public string Message { set; get; }
}
</pre>
<p>
We should deserialize responses with JSON.net and send requests with WebClient. Let&#8217;s just see simple code example:
</p>
<pre class="brush: csharp">
public ApiToken Authenticate(string email, string password)
{
    using (var client = new WebClient())
    {
        var authenticationJson = JsonConvert.SerializeObject(new { Email = email, Password = password });
        client.Headers.Add(HttpRequestHeader.ContentType, "application/json");
        var responseString = client.UploadString(ApiUrl + "authenticate", authenticationJson);
        var response = JsonConvert.DeserializeObject&lt;AuthenticationResponse&gt;(responseString);
        if (!response.Success)
        {
            throw new NotAuthenticatedException();
        }

        return new ApiToken(response.Data.ApiToken);
    }
}
</pre>
<p>
It simply creates new WebClient instance, <code>UploadString</code> method perform&#8217;s POST by default and places string object as POST payload. Then we receive response as string and try to deserialize to target response type. In case it could not serialize that, exception will be thrown. Next, it check result of operation and return required data back to client.
</p>
<p>
The implementation of the rest of methods is mostly the same, differing by type of HTTP request (GET, POST, DELETE, PUT) and request/response objects. Let&#8217;s see <code>GetAllTasks</code> method that does GET request and returns all users tasks:
</p>
<pre class="brush: csharp">
public IList&lt;Task&gt; GetAllTasks(ApiToken token)
{
    using (var client = new WebClient())
    {
        client.Headers.Add(HttpRequestHeader.ContentType, "application/json");
        var responseString = client.DownloadString(ApiUrl + token.Value + "/tasks/all");
        var getAllTasksResponse = JsonConvert.DeserializeObject&lt;GetAllTasksResponse&gt;(responseString);

        if (!getAllTasksResponse.Success)
        {
            throw new Exception("Can't get users tasks. " + getAllTasksResponse.Message);
        }

        return getAllTasksResponse.Data.Tasks;
    }
}
</pre>
<p>
As reference I&#8217;ll give you implementation of <a href="https://github.com/alexbeletsky/trackyt.api.csharp">trackyt.api.csharp</a> by me and <a href="https://github.com/erikzaadi/GithubSharp">GithubSharp</a> API by <a href="http://erikzaadi.com/">Erik Zaadi</a>.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/refactoring-to-testability.html">
    
      Refactoring to testability</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-21T09:33:00+01:00" pubdate data-updated="true">Feb 21<span>st</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/refactoring/'>Refactoring</a>, <a class='category' href='/blog/categories/tdd/'>TDD</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
Suppose you are working on some web <a href="http://www.beletsky.net/2010/12/lets-take-rest.html">REST</a> API adapter. It would be basically one class with bunch of methods. Each method would represent each supported API call. Through the implementation you would probably landed with something like this,
</p>
<pre class="brush: csharp">
public class ApiAdapter
{
    private HttpClient _client;
    private RequestFormatHelper _requestFormatHelper;
    private ResponseFormatHelper _responseFormatHelper;

    // ...
    
    public ApiAdapter()
    {
        _client = new HttpClient(/* ... */);
        _requestFormatHelper = RequestFormatHelper(/* ... */);
        _responseFormatHelper = ResponseFormatHelper(/* ... */);
    }

    void CreateNewTask(Task task)
    {
        // implementation
    }

    void DeleteTask(Task task)
    {
        // implementation
    }

    // rest of methods...
}
</pre>
<p>
Nevertheless, the code works it has several code smells: 
</p>
<ul>
<li>
<strong>High cohesion</strong> - the relation between objects are really strong. Objects are aggregated and aggregation is the one of strongest types of links between objects. 
</li>
<li>
<strong>Violation of <a href="http://en.wikipedia.org/wiki/Open/closed_principle">Open/Closed principle</a></strong> - one of the SOLID object oriented design principles.
</li>
<li>
<strong>Lack of testability</strong> - if you decide to unit test this code, you will be in problem. Unit testing is supposed to be done in <a href="http://c2.com/cgi/wiki?UnitTestIsolation">isolation</a>. Having high cohesion code you can&#8217;t get required level of isolation. Moreover it is not possible to substitute concrete class with <a href="http://en.wikipedia.org/wiki/Mock_object">mock object</a> by using some famous JMock, RhinoMocks or Moq.
</li>
<li>
<strong>Lack of flexibility</strong> - if you decide to change implementation of some of depended objects, say <code>ResponseFormatHelper</code> you would probably change the implementation of <code>ApiAdapter</code> as well.
</li>
</ul>
<p>
If you think that you code is not testable or flexible, don&#8217;t waste your time.. apply the power of refactoring.
</p>
<p>
What to do? It is basically very simple to correct such code, you just need to follow this:
</p>
<ul>
<li>
<strong>Always hide the details behind the interface</strong> - all behavior objects must conform to particular interface. Other objects must refer to another object only with knowledge of the interface. In terms of programming languages, if you pass object to client code you must always pass it by interface (e.g <code>public SomeAction(IHttpClient client, Type type, Data data);</code>.
</li>
<li>
<strong>Use dependency injection for louse coupled code</strong> - try to avoid to create depended object by <code>new</code>, inject the dependency by constructor of public property. (e.g <code>public ApiAdapter(IHttpClient client, IRequestFormatHelper requestHelper, IResponseFormatHelper responseHelper)</code>.
</li>
</ul>
<p>
How the code might look after refactoring:
</p>
<pre class="brush: csharp">
public interface IHttpClient
{
    void WebCall(/*...*/);
}

public interface IRequestFormatHelper
{
    string Format(/*...*/);
}

public interface IResponseFormatHelper
{
    string Format(/*...*/);
}


public class ApiAdapter
{
    private IHttpClient _client;
    private IRequestFormatHelper _requestFormatHelper;
    private IResponseFormatHelper _responseFormatHelper;

    // ...

    public ApiAdapter(IHttpClient client, IRequestFormatHelper requestFormatHelper, IResponseFormatHelper responseFormatHelper)
    {
        _client = client;
        _requestFormatHelper = requestFormatHelper;
        _responseFormatHelper = requestFormatHelper;
    }
</pre>
<p>
Now, you can easily test this code using mocks, like this simple test:
</p>
<pre class="brush: csharp">
[Test]
public void CreateNewTask_SendPutRequest_WithJson()
{
    // arrange
    var client = new Mock&lt;IHttpClient&gt;();
    var requestFormatter = new Mock&lt;IRequestFormatHelper&gt;();
    var responseFormater = new Mock&lt;responseFormatHelper&gt;();

    // act 
    var api = new ApiAdapter(client, requestFormatter, responseFormater);
    api.CreateTask (new Task());

    // arrange
    client.Verify(client.WebCall(/*...*/)).Called().WithArguments(/*...*/;
}
</pre>
<p>
And change any details of injected objects, without any changes in <code>ApiAdapter</code>. Refactoring to testablity is important, as much testable code you got as much flexible code you got.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/aspnet-mvc-controllers-action-with-name.html">
    
      ASP.NET MVC controller&#8217;s action with name View()</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-15T18:59:00+01:00" pubdate data-updated="true">Feb 15<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
If you want to have action with name <code>View</code> in your controller, you will meet a small problem. Base class of any controller <code>Controller</code> already contains a method, with same name (and it is overloaded):
</p>
<pre class="brush: csharp">
protected internal ViewResult View();
protected internal ViewResult View(IView view);
protected internal ViewResult View(object model);
protected internal ViewResult View(string viewName);
</pre>
<p>
So, you code like this:
</p>
<pre class="brush: csharp">
public ActionResult View(string url)
{
    // some action logic...

    return View();
}
</pre>
<p>
Won&#8217;t complied, because you are adding method with same signature (name and parameters list). You have 2 options here: gave up to compiler and rename action, to something new like <code>ViewPost</code> or insist and try to make it happen.
</p>
<p>
Fortunately C# have beautiful feature for doing this. It is <a href="http://msdn.microsoft.com/en-us/library/435f1dw2.aspx">new Modifier</a>. It hides the member on base class and explicitly says, that now your method is substituting it. So, everything you need is basically this: 
</p>
<pre class="brush: csharp">
new public ActionResult View(string url)
{
    // some action logic...

    return View();
}
</pre>
<p>
It will make application compliable and work as expected.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/ninject-provider-as-factory-method.html">
    
      Ninject provider as factory method</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-13T18:22:00+01:00" pubdate data-updated="true">Feb 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/design/'>Design</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>, <a class='category' href='/blog/categories/trackyt-dot-net/'>Trackyt.net</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
<a href="http://ninject.org/">Ninject</a> is a very nice and easy to use, open source dependency injection framework. It is very popular within ASP.net MVC developers community and de-facto framework of choice for MVC applications.
</p>
<p>
I was implementing small feature recently. As user registered on site, he receives confirmation email and registration details. Pretty common functionality along the sites. So, I add next application service <code>INotificationService</code> that took responsibility of sending email message to user. Nothing special, nothing complex. 
</p>
<pre class="brush: csharp">
namespace Trackyt.Core.Services
{
    public class NotificationService : INotificationService
    {
        private IEMailService _emailService;

        public NotificationService(IEMailService emailService)
        {
            _emailService = emailService;
        }

        public void NotifyUserOnRegistration(string usersEmail, string password)
        {
            var emailMessage = CreateEmailMessageForUser(usersEmail, password);
            _emailService.SendEmail(emailMessage, "support");
        }

        //...
</pre>
<p>
As I&#8217;ve tested and integrated it to application, everything were just fine. Till the time I reset database and re-run tests. The problem, that <code>INotificationService</code> itself depends on <code>IEmailService</code> that uses <code>ICredentialsRepository</code> to extract email server credentials (account, password, settings) from database. After database is reset, <code>Credentials</code> table is just empty and <code>IEmailService</code> throws exception that there are no credentials, so send email is impossible. I could not add credentials as SQL to database script, since it depend on configuration and exposes private password. Do it manually after each reset of database is boring task. Furthermore, I don&#8217;t want my application to send any emails as I just do some development testing.
</p>
<p>
The obvious design workaround is - define <code>INotificationServiceFactory</code> that responsible for <code>NotificationService</code> instantiation. Factory decides, if application run in <code>debug</code> mode, just stub of <code>NotificationService</code> is used, otherwise real implementation is used.
</p>
<pre class="brush: csharp">
namespace Trackyt.Core.Services
{
    public class NotificationServiceFactory : INotificationServiceFactory
    {
        public INotificationService GetService()
        {
            if (HttpContext.Current.IsDebuggingEnabled)
            {
                // just stub..
                return new NotificationServiceForDebug();
            }

            // here I need to pass EmailService to constructor
            return new NotificationService ( // ??? );
        }

        // ...
</pre>
<p>
But it is not so easy as it seems to.. Here the problem: <code>NotificationService</code> have to accept <code>EmailService</code>, that have to be created created by DI framework (I could not create it by <code>new</code> since I loose all benefits of inversion of control). So, in factory I need to have a <code>IKernel</code> object - Ninject core object, for instantiating of objects from Inversion of Control container. It should be extended with constructor taking <code>IKernel</code> as argument.
</p>
<p>Issues:</p>
<ul>
<li><strong>Circular dependency</strong> - factory is defined in Core assembly, kernel is defined in Web application.. Web application references Core, to make it work now Core need to reference Web (it is actually possible, but very ugly.. I try to avoid such things).</li>
<li><strong>Additional references</strong> - now Core also need to reference Ninject, to make it compliable.</li>
<li><strong>Violation of Dependency inversion principle</strong> - <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">one</a> of the <a href="http://en.wikipedia.org/wiki/Solid_(object-oriented_design)">SOLID</a> principles of object oriented systems. Model must not depend on infrastructure.</li>
</ul>
<p>
Fortunately Ninject provides functionality to avoid issues mentioned above! Instead of binding to exact type, like
</p>
<pre class="brush: csharp">

    Bind&lt;INotificationServiceFactory&gt;().To&lt;NotificationServiceFactory&gt;();

</pre>
<p>
I can bind creation of type to Provider:
</p>
<pre class="brush: csharp">

    Bind&lt;INotificationService&gt;().ToProvider&lt;TrackyNotificationServiceProvider&gt;();

</pre>
<p>
Provider is class that implement <a href="https://github.com/ninject/ninject/wiki/Providers,-Factory-Methods-and-the-Activation-Context">IProvider</a> interface, which is actually just one method <code>CreateInstance</code>. CreateInstance, receives <code>IContext</code> object as parameter that contains <code>IKernel</code>. <code>TrackyNotificationServiceProvider</code> is placed on same level as the rest of Ninject infrastructure code is placed. Model remains clear and exact and do not mess up with infrastructure code.
</p>
<pre class="brush: csharp">
namespace Web.Infrastructure
{
    public class TrackyNotificationServiceProvider : Provider&lt;INotificationService&gt; 
    {
        protected override INotificationService CreateInstance(IContext context)
        {
            if (HttpContext.Current.IsDebuggingEnabled)
            {
                return new NotificationServiceForDebug();
            }

            return new NotificationService(context.Kernel.Get&lt;IEMailService&gt;());
        }
    }
}
</pre>
<p>
Now, in case of <code>INotificationService</code> object need to be instantiated (in my case it is injected to <code>RegistrationController</code> as constructor parameter), <code>CreateInstance</code> is called. If web.config contains <code>&lt;compilation debug="true" targetFramework="4.0"&gt;</code> the stub of service is created. On production, where <code>&lt;compilation debug="false" targetFramework="4.0"&gt;</code>, real instance of NotificationService is put to work.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  <div class="pagination inner pure-u-1">
    
      <a class="prev" href="/blog/page/18/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/16/">Newer &rarr;</a>
    
  </div>
</div></div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright ¬© 2010 - 2018 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>