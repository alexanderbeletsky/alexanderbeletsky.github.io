
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Beletsky's development blog</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="Github commits activity widget Feb 26th, 2011 GitHub, Open source, Tools The most important factor about each open source project is how much &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/blog/page/15/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><div class="blog-index">
  
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/github-commits-activity-widget.html">
    
      Github commits activity widget</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-26T13:43:00+02:00" pubdate data-updated="true">Feb 26<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/open-source/'>Open source</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
The most important factor about each open source project is how much community is active around this project. It is good to understand the factor. One of the indicators of activity is of cause commits to repository. You probably want to demonstrate how much active your project is by placing some information on a web site. 
</p>
<p>
Having this idea on my mind I created <code>github.commits.widget</code>, small javascript that could be easily integrated to your website and show something like this:
</p>
<div id="github-commits" style="border: 1px solid grey; padding: 5px; list-style: none"></div>
<p>
Note, it is not just html pasted.. but widget added to this blog post.
</p>
<p>
The code is really simple for that:
</p>
<pre class="brush: html">
&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;github.commits.widget-min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    $(function () {
        $('#github-commits').githubInfoWidget(
      { user: 'alexanderbeletsky', repo: 'github.commits.widget', branch: 'master', last: 5 });
    });
&lt;/script&gt;  
</pre>
<p>
To configure all you need to do: specify your github account, repository and branch to watch. For more documenation, please visit <a href="https://github.com/alexanderbeletsky/github.commits.widget">project page</a>. If you like it and want to use it on your website, you are very welcome to do it! Please just give a little feedback to either by <a href="https://github.com/alexanderbeletsky">github</a>, <a href="http://twitter.com/#!/alexbeletsky">twitter</a> or <a href="mailto:alexander.beletsky@gmail.com">mail</a>.
</p>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
<script src="https://github.com/alexanderbeletsky/github.commits.widget/raw/master/js/github.commits.widget-min.js"></script>
<script>
    $(function () {
        $('#github-commits').githubInfoWidget(
  { user: 'alexanderbeletsky', repo: 'github.commits.widget', branch: 'master', last: 5 });
    });
</script></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/implementation-of-rest-web-service.html">
    
      Implementation of REST web service adapter on .NET</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-24T14:58:00+02:00" pubdate data-updated="true">Feb 24<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/rest/'>REST</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
The REST web services are quite common thing nowadays. Sure, web application just expose API through HTTP protocol, basically allowing any application to be integrated with. Simple? Yes, this is the power of REST, just simple. But vendor should consume the API somehow. The environment could really be different: .NET, Java, Python, PHP etc., and it it not so convenient to work with HTTP directly from your custom application. Instead of that you expect on &#8220;native&#8221; API that you work with like the rest of application: having a model, methods that returns of change model state. You expect on having <code>Adapter</code> - the entity which would adapt REST HTTP methods into your platform/language methods. I&#8217;m going to give example of creation such adapter for .NET code.
</p>
<p>
Doesn&#8217;t matter what language you write it the steps of adapting is quite common, here they are:
</p>
<h2>Learn the API</h2>
<p>
Let&#8217;s have <a href="http://www.trackyt.net/Home/ApiV11">Trackyt.net API</a> as an example. First thing you need to do is to learn API. REST API differs much from site to site, depending of developers tools and choice. All you need to understand the exact methods you need, their signature and data they operate with. Let&#8217;s take <code>Authenticate</code> method: so we see, it takes 2 arguments, email and password and in response it returns JSON object, containing operation result and API token. That means:
</p>
<pre class="brush: plain">
URL: http://trackyt.net/api/v1.1/authenticate
</pre>
<p>
Will be transformed in such C# method, like <code>Authenticate</code> that receives email and password as arguments and return ApiToken as results. Note, <code>ApiToken</code> is first model class we identified.
</p>
<p>
And call like this:
</p>
<pre class="brush: plain">
http://trackyt.net/api/v1.1/af005f695d300d0dfebbd574a4b1c0fa/tasks/all
</pre>
<p>
Is actually transformed in something like <code>GetAllTasks</code> that recieves ApiToken object and returns <code>IList&lt;Task&gt;</code>. <code>Task</code> is yet another model class we have to deal with.
</p>
<p>
This is a kind of analysis stage of implementation, you just need to understand interface and model.
</p>
<h2>Define interface and model</h2>
<p>
After you done you are ready to define interface:
</p>
<pre class="brush: csharp">
public interface ITrackytApiAdapter
{
    ApiToken Authenticate(string email, string password);

    IList&lt;Task&gt; GetAllTasks(ApiToken token);
    Task AddTask(ApiToken token, string description);
    int DeleteTask(ApiToken apiToken, int taskId);
    Task StartTask(ApiToken apiToken, int taskId);
    Task StopTask(ApiToken apiToken, int taskId);
    void StartAll(ApiToken apiToken);
    void StopAll(ApiToken apiToken);
}
</pre>
<p>
You see that all methods, defined in <a href="http://www.trackyt.net/Home/ApiV11">documentation</a> are reflected as interface methods, all data accepted/returned by methods are defined as <a href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object">POCO</a>.
</p>
<pre class="brush: csharp">
public class ApiToken
{
    public ApiToken(string token)
    {
        Value = token;
    }

    public String Value { get; private set; }
}

public class Task
{
    public int Id { set; get; }
    public string Description { set; get; }
    public DateTime CreatedDate { set; get; }
    public DateTime? StartedDate { set; get; }
    public int Status { set; get; }
}
</pre>
<h2>Integration testing</h2>
<p>
Is it possible to code without tests? I don&#8217;t think so. So, what we are going to do - one by one, tests all adapter methods. That&#8217;s should not be &#8220;super-duper-complex&#8221; test (at least during initial implementation), but rather smoke test ones. Do the call and see that results back. Here is just a several examples of tests for <code>Authentication</code> and <code>GetAllTasks</code>.
</p>
<pre class="brush: csharp">
[Test]
public void Authenticate_AuthenicationSuccess_ReturnApiToken()
{
    // arrange
    var adapter = TrackytApiAdapterFactory.CreateV11Adapter();

    // act
    var apiToken = adapter.Authenticate(_email, _password);

    // assert
    Assert.That(apiToken, Is.Not.Null);
    Assert.That(apiToken.Value, Is.Not.Null);
}

[Test]
[ExpectedException(typeof(NotAuthenticatedException))]
public void Authenticate_AuthenticationFailed_ExceptionThrown()
{
    // arrange
    var adapter = TrackytApiAdapterFactory.CreateV11Adapter();            

    // act
    var apiToken = adapter.Authenticate("nouser", "noemail");
}
</pre>
<h2>Implementation</h2>
<p>
There are 2 very suitable components you might use for any REST API adapters:
</p>
<ul>
<li>
<a href="http://james.newtonking.com/pages/json-net.aspx">James Newton JSON.net</a> library - the best framework to handle JSON&#8217;s in .NET (imho). I enjoy how easy to serialize and deserialize of data with JSON.net.
</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/system.net.webclient(v=vs.80).aspx">WebClient</a> object - that is part of .NET framework and encapsulate all basic HTTP functions.
</li>
</ul>
<p>
Here we go. Our task is to send HTTP request to server, check it for correctness and transform server reply to .NET objects. To do that is great to model all responses into POCO (as we did with model classes <code>ApiToken</code> and <code>Task</code>). The difference is that <code>Responses</code> are actually internal classes, part of implementation and adapter users should know nothing about them. For instance let&#8217;s see <code>AuthenticationResponse</code>
</p>
<pre class="brush: csharp">
class AuthenticationResponse : BaseResponse
{
    internal class ResponseData
    {
        [JsonProperty("apiToken")]
        public string ApiToken { set; get; }
    }

    [JsonProperty("data")]
    public ResponseData Data { set; get; }
}
</pre>
<p>
The base response is some common part of data that every response suppose to contain. In my case:
</p>
<pre class="brush: csharp">
class BaseResponse
{
    [JsonProperty("success")]
    internal bool Success { set; get; }

    [JsonProperty("message")]
    public string Message { set; get; }
}
</pre>
<p>
We should deserialize responses with JSON.net and send requests with WebClient. Let&#8217;s just see simple code example:
</p>
<pre class="brush: csharp">
public ApiToken Authenticate(string email, string password)
{
    using (var client = new WebClient())
    {
        var authenticationJson = JsonConvert.SerializeObject(new { Email = email, Password = password });
        client.Headers.Add(HttpRequestHeader.ContentType, "application/json");
        var responseString = client.UploadString(ApiUrl + "authenticate", authenticationJson);
        var response = JsonConvert.DeserializeObject&lt;AuthenticationResponse&gt;(responseString);
        if (!response.Success)
        {
            throw new NotAuthenticatedException();
        }

        return new ApiToken(response.Data.ApiToken);
    }
}
</pre>
<p>
It simply creates new WebClient instance, <code>UploadString</code> method perform&#8217;s POST by default and places string object as POST payload. Then we receive response as string and try to deserialize to target response type. In case it could not serialize that, exception will be thrown. Next, it check result of operation and return required data back to client.
</p>
<p>
The implementation of the rest of methods is mostly the same, differing by type of HTTP request (GET, POST, DELETE, PUT) and request/response objects. Let&#8217;s see <code>GetAllTasks</code> method that does GET request and returns all users tasks:
</p>
<pre class="brush: csharp">
public IList&lt;Task&gt; GetAllTasks(ApiToken token)
{
    using (var client = new WebClient())
    {
        client.Headers.Add(HttpRequestHeader.ContentType, "application/json");
        var responseString = client.DownloadString(ApiUrl + token.Value + "/tasks/all");
        var getAllTasksResponse = JsonConvert.DeserializeObject&lt;GetAllTasksResponse&gt;(responseString);

        if (!getAllTasksResponse.Success)
        {
            throw new Exception("Can't get users tasks. " + getAllTasksResponse.Message); 
        }

        return getAllTasksResponse.Data.Tasks;
    }
}
</pre>
<p>
As reference I&#8217;ll give you implementation of <a href="https://github.com/alexanderbeletsky/trackyt.api.csharp">trackyt.api.csharp</a> by me and <a href="https://github.com/erikzaadi/GithubSharp">GithubSharp</a> API by <a href="http://erikzaadi.com/">Erik Zaadi</a>.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/refactoring-to-testability.html">
    
      Refactoring to testability</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-21T10:33:00+02:00" pubdate data-updated="true">Feb 21<span>st</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/refactoring/'>Refactoring</a>, <a class='category' href='/blog/categories/tdd/'>TDD</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
Suppose you are working on some web <a href="http://www.beletsky.net/2010/12/lets-take-rest.html">REST</a> API adapter. It would be basically one class with bunch of methods. Each method would represent each supported API call. Through the implementation you would probably landed with something like this,
</p>
<pre class="brush: csharp">
public class ApiAdapter
{
    private HttpClient _client;
    private RequestFormatHelper _requestFormatHelper;
    private ResponseFormatHelper _responseFormatHelper;

    // ...
    
    public ApiAdapter()
    {
        _client = new HttpClient(/* ... */);
        _requestFormatHelper = RequestFormatHelper(/* ... */);
        _responseFormatHelper = ResponseFormatHelper(/* ... */);
    }

    void CreateNewTask(Task task)
    {
        // implementation
    }

    void DeleteTask(Task task)
    {
        // implementation
    }

    // rest of methods...
}
</pre>
<p>
Nevertheless, the code works it has several code smells: 
</p>
<ul>
<li>
<strong>High cohesion</strong> - the relation between objects are really strong. Objects are aggregated and aggregation is the one of strongest types of links between objects. 
</li>
<li>
<strong>Violation of <a href="http://en.wikipedia.org/wiki/Open/closed_principle">Open/Closed principle</a></strong> - one of the SOLID object oriented design principles.
</li>
<li>
<strong>Lack of testability</strong> - if you decide to unit test this code, you will be in problem. Unit testing is supposed to be done in <a href="http://c2.com/cgi/wiki?UnitTestIsolation">isolation</a>. Having high cohesion code you can&#8217;t get required level of isolation. Moreover it is not possible to substitute concrete class with <a href="http://en.wikipedia.org/wiki/Mock_object">mock object</a> by using some famous JMock, RhinoMocks or Moq.
</li>
<li>
<strong>Lack of flexibility</strong> - if you decide to change implementation of some of depended objects, say <code>ResponseFormatHelper</code> you would probably change the implementation of <code>ApiAdapter</code> as well.
</li>
</ul>
<p>
If you think that you code is not testable or flexible, don&#8217;t waste your time.. apply the power of refactoring.
</p>
<p>
What to do? It is basically very simple to correct such code, you just need to follow this:
</p>
<ul>
<li>
<strong>Always hide the details behind the interface</strong> - all behavior objects must conform to particular interface. Other objects must refer to another object only with knowledge of the interface. In terms of programming languages, if you pass object to client code you must always pass it by interface (e.g <code>public SomeAction(IHttpClient client, Type type, Data data);</code>.
</li>
<li>
<strong>Use dependency injection for louse coupled code</strong> - try to avoid to create depended object by <code>new</code>, inject the dependency by constructor of public property. (e.g <code>public ApiAdapter(IHttpClient client, IRequestFormatHelper requestHelper, IResponseFormatHelper responseHelper)</code>.
</li>
</ul>
<p>
How the code might look after refactoring:
</p>
<pre class="brush: csharp">
public interface IHttpClient
{
    void WebCall(/*...*/);
}

public interface IRequestFormatHelper
{
    string Format(/*...*/);
}

public interface IResponseFormatHelper
{
    string Format(/*...*/);
}


public class ApiAdapter
{
    private IHttpClient _client;
    private IRequestFormatHelper _requestFormatHelper;
    private IResponseFormatHelper _responseFormatHelper;

    // ...

    public ApiAdapter(IHttpClient client, IRequestFormatHelper requestFormatHelper, IResponseFormatHelper responseFormatHelper)
    {
        _client = client;
        _requestFormatHelper = requestFormatHelper;
        _responseFormatHelper = requestFormatHelper;
    }
</pre>
<p>
Now, you can easily test this code using mocks, like this simple test:
</p>
<pre class="brush: csharp">
[Test]
public void CreateNewTask_SendPutRequest_WithJson()
{
    // arrange
    var client = new Mock&lt;IHttpClient&gt;();
    var requestFormatter = new Mock&lt;IRequestFormatHelper&gt;();
    var responseFormater = new Mock&lt;responseFormatHelper&gt;();

    // act 
    var api = new ApiAdapter(client, requestFormatter, responseFormater);
    api.CreateTask (new Task());

    // arrange
    client.Verify(client.WebCall(/*...*/)).Called().WithArguments(/*...*/;
}
</pre>
<p>
And change any details of injected objects, without any changes in <code>ApiAdapter</code>. Refactoring to testablity is important, as much testable code you got as much flexible code you got.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/aspnet-mvc-controllers-action-with-name.html">
    
      ASP.NET MVC controller&#8217;s action with name View()</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-15T19:59:00+02:00" pubdate data-updated="true">Feb 15<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
If you want to have action with name <code>View</code> in your controller, you will meet a small problem. Base class of any controller <code>Controller</code> already contains a method, with same name (and it is overloaded):
</p>
<pre class="brush: csharp">
protected internal ViewResult View();
protected internal ViewResult View(IView view);
protected internal ViewResult View(object model);
protected internal ViewResult View(string viewName);
</pre>
<p>
So, you code like this:
</p>
<pre class="brush: csharp">
public ActionResult View(string url)
{
    // some action logic...

    return View();
}
</pre>
<p>
Won&#8217;t complied, because you are adding method with same signature (name and parameters list). You have 2 options here: gave up to compiler and rename action, to something new like <code>ViewPost</code> or insist and try to make it happen.
</p>
<p>
Fortunately C# have beautiful feature for doing this. It is <a href="http://msdn.microsoft.com/en-us/library/435f1dw2.aspx">new Modifier</a>. It hides the member on base class and explicitly says, that now your method is substituting it. So, everything you need is basically this: 
</p>
<pre class="brush: csharp">
new public ActionResult View(string url)
{
    // some action logic...

    return View();
}
</pre>
<p>
It will make application compliable and work as expected.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/ninject-provider-as-factory-method.html">
    
      Ninject provider as factory method</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-13T19:22:00+02:00" pubdate data-updated="true">Feb 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/design/'>Design</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>, <a class='category' href='/blog/categories/trackyt-dot-net/'>Trackyt.net</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
<a href="http://ninject.org/">Ninject</a> is a very nice and easy to use, open source dependency injection framework. It is very popular within ASP.net MVC developers community and de-facto framework of choice for MVC applications.
</p>
<p>
I was implementing small feature recently. As user registered on site, he receives confirmation email and registration details. Pretty common functionality along the sites. So, I add next application service <code>INotificationService</code> that took responsibility of sending email message to user. Nothing special, nothing complex. 
</p>
<pre class="brush: csharp">
namespace Trackyt.Core.Services
{
    public class NotificationService : INotificationService
    {
        private IEMailService _emailService;

        public NotificationService(IEMailService emailService)
        {
            _emailService = emailService;
        }

        public void NotifyUserOnRegistration(string usersEmail, string password)
        {
            var emailMessage = CreateEmailMessageForUser(usersEmail, password);
            _emailService.SendEmail(emailMessage, "support");
        }

        //...
</pre>
<p>
As I&#8217;ve tested and integrated it to application, everything were just fine. Till the time I reset database and re-run tests. The problem, that <code>INotificationService</code> itself depends on <code>IEmailService</code> that uses <code>ICredentialsRepository</code> to extract email server credentials (account, password, settings) from database. After database is reset, <code>Credentials</code> table is just empty and <code>IEmailService</code> throws exception that there are no credentials, so send email is impossible. I could not add credentials as SQL to database script, since it depend on configuration and exposes private password. Do it manually after each reset of database is boring task. Furthermore, I don&#8217;t want my application to send any emails as I just do some development testing.
</p>
<p>
The obvious design workaround is - define <code>INotificationServiceFactory</code> that responsible for <code>NotificationService</code> instantiation. Factory decides, if application run in <code>debug</code> mode, just stub of <code>NotificationService</code> is used, otherwise real implementation is used.
</p>
<pre class="brush: csharp">
namespace Trackyt.Core.Services
{
    public class NotificationServiceFactory : INotificationServiceFactory
    {
        public INotificationService GetService()
        {
            if (HttpContext.Current.IsDebuggingEnabled)
            {
                // just stub..
                return new NotificationServiceForDebug();
            }

            // here I need to pass EmailService to constructor
            return new NotificationService ( // ??? );
        }

        // ...
</pre>
<p>
But it is not so easy as it seems to.. Here the problem: <code>NotificationService</code> have to accept <code>EmailService</code>, that have to be created created by DI framework (I could not create it by <code>new</code> since I loose all benefits of inversion of control). So, in factory I need to have a <code>IKernel</code> object - Ninject core object, for instantiating of objects from Inversion of Control container. It should be extended with constructor taking <code>IKernel</code> as argument.
</p>
<p>Issues:</p>
<ul>
<li><strong>Circular dependency</strong> - factory is defined in Core assembly, kernel is defined in Web application.. Web application references Core, to make it work now Core need to reference Web (it is actually possible, but very ugly.. I try to avoid such things).</li>
<li><strong>Additional references</strong> - now Core also need to reference Ninject, to make it compliable.</li>
<li><strong>Violation of Dependency inversion principle</strong> - <a href="http://en.wikipedia.org/wiki/Dependency_inversion_principle">one</a> of the <a href="http://en.wikipedia.org/wiki/Solid_(object-oriented_design)">SOLID</a> principles of object oriented systems. Model must not depend on infrastructure.</li>
</ul>
<p>
Fortunately Ninject provides functionality to avoid issues mentioned above! Instead of binding to exact type, like
</p>
<pre class="brush: csharp">

    Bind&lt;INotificationServiceFactory&gt;().To&lt;NotificationServiceFactory&gt;();

</pre>
<p>
I can bind creation of type to Provider:
</p>
<pre class="brush: csharp">

    Bind&lt;INotificationService&gt;().ToProvider&lt;TrackyNotificationServiceProvider&gt;();

</pre>
<p>
Provider is class that implement <a href="https://github.com/ninject/ninject/wiki/Providers,-Factory-Methods-and-the-Activation-Context">IProvider</a> interface, which is actually just one method <code>CreateInstance</code>. CreateInstance, receives <code>IContext</code> object as parameter that contains <code>IKernel</code>. <code>TrackyNotificationServiceProvider</code> is placed on same level as the rest of Ninject infrastructure code is placed. Model remains clear and exact and do not mess up with infrastructure code.
</p>
<pre class="brush: csharp">
namespace Web.Infrastructure
{
    public class TrackyNotificationServiceProvider : Provider&lt;INotificationService&gt; 
    {
        protected override INotificationService CreateInstance(IContext context)
        {
            if (HttpContext.Current.IsDebuggingEnabled)
            {
                return new NotificationServiceForDebug();
            }

            return new NotificationService(context.Kernel.Get&lt;IEMailService&gt;());
        }
    }
}
</pre>
<p>
Now, in case of <code>INotificationService</code> object need to be instantiated (in my case it is injected to <code>RegistrationController</code> as constructor parameter), <code>CreateInstance</code> is called. If web.config contains <code>&lt;compilation debug="true" targetFramework="4.0"&gt;</code> the stub of service is created. On production, where <code>&lt;compilation debug="false" targetFramework="4.0"&gt;</code>, real instance of NotificationService is put to work.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/extension-methods-and-clean-code.html">
    
      Extension methods and clean code</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-10T10:52:00+02:00" pubdate data-updated="true">Feb 10<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/clean-code/'>Clean Code</a>, <a class='category' href='/blog/categories/code-kata/'>Code Kata</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
<a href="http://msdn.microsoft.com/en-us/library/bb383977.aspx">Extension methods</a> is one of my favorite features of C# language. It appeared from version 3.0 and became very popular.
</p>
<p>
The main goal of Extension Methods is to provide ability of extension of any class, without creating any derived classes, modifying original type or do &#8220;whatever&#8221; hacks. It is allowed to extend any type with any functionality in a very seamless fashion. What also great about Extension Methods is they allow to beautifully emulate behavior usually called pipelining (in <a href="http://lorgonblog.wordpress.com/2008/03/30/pipelining-in-f/">F#</a> or <a href="http://www.gnu.org/software/bash/manual/html_node/Pipelines.html">Bash</a>) and implement <a href="http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">Chain of responsibility</a> pattern.
</p>
<p>
But the most important as for me - Extension Methods help to keep my <a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">code clean</a>. Clean code criteria is something I concerned a lot, nowadays.
</p>
<p>
I recently started to practice with <a href="http://en.wikipedia.org/wiki/Kata_(programming)">code katas</a>, that I found essential for any developers who cares about <a href="http://www.hanselman.com/blog/SharpenTheSawForDevelopers.aspx">keeping their saw sharp</a>. So, after several iterations I came up with extension methods implementation that I pretty happy about. I&#8217;m using Roy Osherove&#8217;s <a href="http://www.osherove.com/tdd-kata-1/">StringCalculator</a> kata. It is about the implementation of simple method <code>Add</code> that:  
</p>
<ul>
<li>Takes numbers separated by delimiter, as string</li>
<li>Determines if custom delimiter is set</li>
<li>Split up original string to array of number tokens</li>
<li>Validates the input (no negatives allowed) and returns the sum of numbers, ignoring numbers greater than 1000</li>
</ul>
<p>
I would like to show to you both implementation and try to evaluate them from &#8220;clean code&#8221; point of view.
</p>
<p>
Original one (this is of cause a little &#8220;unwinded&#8221; version, I had a different structure with smaller methods.. But idea still the same).
</p>
<pre class="brush: csharp;">
public int Add(string numbers)
{
    var delimiters = new[] { ",", "\n" };

    if (IsCustomDelimeterProvided(numbers))
    {
        delimiters = GetDelimitersFromNumbers(numbers);
    }

    var processed = numbers;
    if (IsCustomDelimeterProvided(numbers))
    {
        processed = processed.Substring(processed.IndexOf('\n') + 1);
    }

    if (IsContainDelimeters(processed, delimiters))
    {
        var splittedNumbers = numbers.Split(delimiters, StringSplitOptions.None);
        var validation = new NumbersValidation();

        foreach (var number in splittedNumbers)
        {
            validation.Check(number);
        }

        validation.Validate();

        return splittedNumbers.Sum(p => GetIntegerWithCondition(p, IgnoreNumbersMoreThatThousand()));
    }

    return Convert.ToInt32(processed);
}
</pre>
<p>
Do you think is this code clean? I don&#8217;t think so.. Of cause, it might be not so difficult to understand it, but:
</p>
<ul>
<li>Method is just too long</li>
<li>A lot of <code>if</code> statements make it difficult to see instruction flow</li>
<li>It messes up &#8220;infrastructure&#8221; code (splits, validation) with primary functionality (sum of numbers)</li>
</ul>
<p>
Let&#8217;s try to read it: <i>I got the numbers and I check if custom delimiter is set on the beginning of numbers string, if so I try to extract the custom delimiters from original string. After I pre-process the string to remove custom delimiter prefix, so do not break the rest of function. If numbers string contains the delimiters, I split it up, perform the validation by helper object (which will throw exception is something wrong). Run Sum algorithm that would: covert string to integer and ignore one if it is greater that 1000.. Otherwise, it just tries to convert to integer and return</i>.
</p>
<p>
A lot of words, a lot of ifs isn&#8217;t it? Thats not good.
</p>
<p>
Now, my last implementation with using of Extension Methods:
</p>
<pre class="brush: csharp;">
public int Add(string numbers)
{
    var defaultDelimiters = new string[] { ",", "\n" };
    var delimiters = numbers.CustomDelimiters().Concat(defaultDelimiters).ToArray();

    return numbers.Replace(" ", "").Split(delimiters, StringSplitOptions.RemoveEmptyEntries)
        .RemoveSpecialSymbols().ToIntegersArray().ValidateIntegersArray().IgnoreIntegersGreatThanThousand().Sum();
}
</pre>
<p>
Do you feel the power? I definitely do!
</p>
<p>
I believe that this code is very clean. It basically does not require any comments, because it looks like &#8220;plain English&#8221; explanation of what&#8217;s the functionality is all about! Anyway, let&#8217;s try to read: <i>I extract custom delimiters from numbers string and concatenate them with default delimiters. I replace all space with empty symbol (note: this step is not in original requirement, but I put it to keep code robust), then I split them with delimiters ignoring empty lines. After I remove all special symbols in numbers string and convert the result to array of integers. I validate this array (no negatives) and ignore any numbers great than thousand. At the end I sum up everything and return the result</i>.
</p>
<p>
What is good about this code:
</p>
<ul>
<li>
Method is very short
</li>
<li>
All details are hidden
</li>
<li>
Control flow is very straightforward
</li>
<li>
All dependent methods has meaningful names
</li>
<li>
Method does exactly what it is suppose to do
</li>
</ul>
<h2>Conclusion</h2>
<p>
Well, don&#8217;t get me wrong here. I&#8217;m not saying that now only Extension Methods is a way of solving the issues. Of cause not. But if you feel the smell of pipeline of chain of responsibility patters, extension methods are right choice. As always you should consider to do not &#8220;overplay&#8221; with some particular feature of language/framework. 
</p>
<p>
You can use links I gave above to read about technical details in MSDN. Check out full <a href="https://github.com/alexanderbeletsky/code.katas/blob/879a5765f4b8b408cc9f7b67ebdf767032433bd0/csharp/StringCalculator/StringCalculator.cs">implementation</a> and <a href="https://github.com/alexanderbeletsky/code.katas/blob/6fbb9907b334a364d43a868349de08971d147b10/csharp/StringCalculator/Tests/StringCalculatorTests.cs">tests</a> as my example of usage.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/how-to-export-sql-data-script-for-sql.html">
    
      How to export SQL data script for SQL Express 2008 R2</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-06T15:33:00+02:00" pubdate data-updated="true">Feb 6<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/dal/'>DAL</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
Before deployment of new version of my application I wanted to make sure that everything is alright, by doing development test on my machine. I backed up production database and copied it my local environment. Task was easy, restore database from backup and run all unit/integration tests, run the smoke test of application manually. But as I started to restore database I got such error from my SQL Express Management Studio: 
</p>
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TU6j0MChEeI/AAAAAAAAHQ8/Z0nt-jek6uY/s1600/sqlerror.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 149px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TU6j0MChEeI/AAAAAAAAHQ8/Z0nt-jek6uY/s400/sqlerror.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5570569906084188642" /></a>
<pre>
<code>
TITLE: Microsoft SQL Server Management Studio
------------------------------

Restore failed for Server 'LOCAL\SQLEXPRESS'.  (Microsoft.SqlServer.SmoExtended)

------------------------------
ADDITIONAL INFORMATION:

System.Data.SqlClient.SqlError: The database was backed up on a server running version 10.50.1600. That version is incompatible with this server, which is running version 10.00.2531. Either restore the database on a server that supports the backup, or use a backup that is compatible with this server. (Microsoft.SqlServer.Smo)
</code>
</pre>
<p>
Basically it meant that my production and local environment are different. On production I have SQL Express 2008 R2, locally I have SQL Express 2008. It was a surprise to me, cause my <a href="http://www.microsoft.com/web/downloads/platform.aspx">WebPI</a> shows me that I&#8217;m upgraded up to R2.
</p>
<p>
Anyway, I had no time to upgrade my local environment and I did very simple workaround that might work for you as you don&#8217;t have very big database to handle.
</p>
<p>
There is a feature of SQL Express (and Server) that allows you to export your database as SQL script and you can run this script on local SQL instance and got exactly same version.
</p>
<p>
It is easy taks, but by doing that initially I successfully exported schema only, but not data itself. So, script generated didn&#8217;t contain and INSERT statement. As it turns out you have to change some default options, to export both schema and data. Follow the instructions: 
</p>
<ol>
<li>
Expand your database list and right click on target database.
</li>
<li>
Select &#8220;Tasks&#8221; -> &#8220;Generate Scripts&#8221; context menu item. Generate scripts wizard will open.
</li>
<li>
Press &#8220;Next&#8221; on welcome screen and select your database from databases list.<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_stL4bIIuRUs/TU6j9Bwb8bI/AAAAAAAAHRE/kd418y58iTk/s1600/selectdb.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 362px;" src="http://4.bp.blogspot.com/_stL4bIIuRUs/TU6j9Bwb8bI/AAAAAAAAHRE/kd418y58iTk/s400/selectdb.png" border="0" alt=""id="Img1" /></a>
</li>
<li>
Make sure you checked option &#8220;Script all object in selected database&#8221; if you want to script all db. In case you need only some particular table you might consider to select it later. Click &#8220;Next&#8221;.
</li>
<li>
On Script option step, make sure to select &#8220;Script Data&#8221; option (this is exactly what I missed and didn&#8217;t understand why data is not present in final script).
<br />
<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TU6kLZ4hqcI/AAAAAAAAHRM/W7rv43-R3uc/s1600/scriptdata.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 362px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TU6kLZ4hqcI/AAAAAAAAHRM/W7rv43-R3uc/s400/scriptdata.png" border="0" alt=""id="Img2" /></a>
</li>
<li>
Proceed to the end of wizard to complete it.
</li>
</ol>
<p>
At the end you will got SQL script with schema and data that you can run on SQL Express 2008 and got exactly the same database as on R2. 
</p>
<p>
This helped me quickly to workaround &#8220;version incompatibility&#8221; issue, hope it might help you as well.
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/02/val-gardena-dolomites-trip-2011.html">
    
      Val Gardena (Dolomites) trip 2011</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-02-03T23:16:00+02:00" pubdate data-updated="true">Feb 3<span>rd</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/life/'>Life</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
It is over. It was one of my best vacations ever. We had a chance to see a lot of beautiful spots, especially in Venice and Gratz and had great snowboarding times on Val Gardena area slopes.
</p>
<p>
As I said in previous post, this time we did plan our trip more carefully. Without long night driving and staying in hotels for night to have a rest. We went out of the Kiev early morning (about 3.00) and went to west Ukraine border to small town - <a href="http://maps.google.com/maps?f=q&source=s_q&hl=uk&geocode=&q=%D0%90%D1%81%D1%82%D0%B5%D0%B9,+%D0%97%D0%B0%D0%BA%D0%B0%D1%80%D0%BF%D0%B0%D1%82%D1%81%D1%8C%D0%BA%D0%B0+%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C,+%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B0&aq=0&sll=48.176847,22.602997&sspn=0.127748,0.338173&ie=UTF8&hq=&hnear=%D0%90%D1%81%D1%82%D0%B5%D0%B9,+%D0%91%D0%B5%D1%80%D0%B5%D0%B3%D1%96%D0%B2%D1%81%D1%8C%D0%BA%D0%B8%D0%B9,+%D0%97%D0%B0%D0%BA%D0%B0%D1%80%D0%BF%D0%B0%D1%82%D1%81%D1%8C%D0%BA%D0%B0+%D0%BE%D0%B1%D0%BB%D0%B0%D1%81%D1%82%D1%8C,+%D0%A3%D0%BA%D1%80%D0%B0%D1%97%D0%BD%D0%B0&t=h&z=13">Astey</a> where we crossed the border to Hungary. This time we are 2 cars team. Connected with radio stations, we feel like a professional rally riders for a long test drive trip :). 
</p>
<p>
Dmytro (the manager of our trip) booked very nice hotel <a href="http://www.booking.com/hotel/hu/all-4u-apartments.uk.html?sid=6a30321ac73f772117c92f6e17305422;checkin=2011-01-20;checkout=2011-01-21;show_room=RD18522902#">All-4 U</a> in center Budapest. Living in center has pros and cons, of cause.. It is good that you could walk to main city POI&#8217;s, but it was very (very!) hard to find hotel and find a parking place for car. Center of Budapest is in heavy maintenance now, so our GPS were guide us through streets that are closed for traffic now. We finally found hotel but it was located in very small street, with no free parking places so we did several circles, to finally hit the entrance and underground parking.
</p>
<p>
So, at the morning we had a quick breakfast and went to Venice, Italy. Nothing more as so good as driving by Euro highways. It is easy and safe and fast. Our path to Italy were made through Slovenia. Slovenia is very beautiful country and we very much enjoyed the ride. Near the 20.00 we came to hotel <a href="http://www.booking.com/hotel/it/altieri.en-gb.html?aid=333518;label=altieri-u8H8xFVdXczhwVr*sP9_VQS5125397262;sid=6a30321ac73f772117c92f6e17305422;checkin=2011-01-21;checkout=2011-01-22">Alteri</a> 
    near Venice. We had a quick shower and preparation, got a bus tickets and went 
    to city. Since we were really hungry, first place to visit was some restaurant 
    to get some food. The owner of hotel recommended us some place and we went 
    there. It was a quite small place. Food and vine were just perfect, very tasty. I was a little nervous about the price, but as I glanced to menu I was happy to see that prices are not overhigh. It is even lower that some expensive restaurants in center of Kiev.. but could you compare Kiev and Venice, with number of tourists, attractions? No way..  
</p>
<p>
Venice is town on water. No transport, no cars, nothing. Only walking and using gondolas to go by chanells. Since we came on night, not a lot of tourists were in town that time. Some times it really created illusion that we are alone there! So quite, so small streets with small bridges.. so magical! If you are not familiar much with Venice you really think it is like maze. We lost several times but it was really fun. Andrey, the guy who held the map and was showing directions, was doing a great job to save us, but is was like that: &#8220;Now, let&#8217;s turn right, pass the bridge.. turn left and right again and bla-bla&#8221;, but after 10 minutes we were on same place we started with :). Fanstastic.      
</p>
<p>Venice streets</p>
<a href="http://picasaweb.google.com/lh/photo/c0Zh370ngwAGIjUON0Txwg?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUhZwp0SiWI/AAAAAAAAHQk/lkYOCaEjrIY/s640/IMG_4849.JPG" height="407" width="620" /></a>
<p>Main channel</p>
<a href="http://picasaweb.google.com/lh/photo/SiF0cbZD5QsP3pGVpdM9nw?feat=embedwebsite"><img src="http://lh6.ggpht.com/_stL4bIIuRUs/TUhZ9DSR1uI/AAAAAAAAHQk/UZr3EYIBwTQ/s640/IMG_4870.JPG" height="407" width="620" /></a>
<p>Beautiful bridge</p>
<a href="http://picasaweb.google.com/lh/photo/KLze0mOE5QNe5B3OUN9rWg?feat=embedwebsite"><img src="http://lh4.ggpht.com/_stL4bIIuRUs/TUha7Dx3VtI/AAAAAAAAHQk/36LvZ719KyQ/s640/IMG_4916.JPG" height="407" width="620" /></a>
<p>
Next morning we had just a several hours to have a walk, so we were hurry to Venice again. At morning it looks really different. You can see much more details of cause (like, how all those building are really old.. or color of water in channels), but now it is overcrowded with tourists and souvenirs dealers. So the magic just gone :). But still a lot of shops and churches are opened, so you might have a chance to visit those.  
</p>
<p>Sashka near one of the channels</p>
<a href="http://picasaweb.google.com/lh/photo/H3fxgsnzkoSbX0dDKjCYUQ?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUhbxRCPBjI/AAAAAAAAHQk/oaEjNmCDc7M/s640/IMG_4952.JPG" height="407" width="620" /></a>
<p>Together on San Marko</p>
<a href="http://picasaweb.google.com/lh/photo/qFNY_mxAHLW2ZFp6Zi_Ufg?feat=embedwebsite"><img src="http://lh4.ggpht.com/_stL4bIIuRUs/TUhcahWloAI/AAAAAAAAHQk/D5SwdL-x--g/s640/IMG_5001.JPG" height="407" width="620" /></a>
<p>Gondolas</p>
<a href="http://picasaweb.google.com/lh/photo/tm3yLmzlnGIjAZO5GrCCuA?feat=embedwebsite"><img src="http://lh3.ggpht.com/_stL4bIIuRUs/TUhcnsWEbQI/AAAAAAAAHQk/m9JGU816aaY/s640/IMG_5024.JPG" height="407" width="620" /></a>
<p>
The weather were fine, but wind were quite cold. Late January is probably not the best time to visit Venice, but anyway I had a lot of pleasure to be in this legend place. 
</p>
<p>
We packed our bags and went to target point of our journey, <a href="http://maps.google.com/maps?f=q&source=s_q&hl=uk&geocode=&q=Cristina+Val+Gardena+Telemark&aq=&sll=46.558182,11.728249&sspn=0.016466,0.042272&ie=UTF8&hq=Cristina+Val+Gardena+Telemark&hnear=&ll=46.560601,11.710997&spn=0.008233,0.021136&t=h&z=16">St. Christina</a>. We were driving by highway, with a very sunny weather behind the car glass, seeing a lot of vineyards. Outside view was so warm that it was to difficult to imagine that somewhere is cold and snow covered peaks of mountains.  
</p>
<p>
We came to St. Christina at evening, it was -4C and we climb to 1650m over sea level. It was dark already so we could not see mountains, but the air was so fresh and so nice that it could be only in Alps. We were exited about next 6 days! Val Gardena is huge and you might have everyday snowboarding in different places. So, it was a good idea to take good rest before exploring the mountains. 
</p>
<p>
Val Gardena meet our expectations for sure! I&#8217;ve never seen so much exceptional view as from Seceda or Marmolada tops! Really-really beautiful landscapes. The killer feature of Val Gardena area is <a href="http://www.dolomitesworld.com/sellaronda/">Sellaronda</a>. Sellaronda is a circuit around Sella mountains massif.. Big number of slopes and lifts that makes it possible to feel all beauty of Dolomites. You can do the circuit in 2 directions, green one and orange one. They are mostly equal.. orange just contains a bit more red and black (more complex) slopes. Green one can be used by everyone, even if you are not so confident in skies or snowboard. It took about 3-4 hours to complete the circle. 
</p>
<p>Sella</p>
<a href="http://picasaweb.google.com/lh/photo/jFsHluluW9_aYoT-CsV6-g?feat=embedwebsite"><img src="http://lh4.ggpht.com/_stL4bIIuRUs/TUhdnxagAsI/AAAAAAAAHQk/7-AG3Wkda3s/s640/IMG_5080.JPG" height="407" width="620" /></a>
<p>Great sunny day</p>
<a href="http://picasaweb.google.com/lh/photo/2l21P611fO4HbVRSCL0JJA?feat=embedwebsite"><img src="http://lh4.ggpht.com/_stL4bIIuRUs/TUhdrHi7LfI/AAAAAAAAHQk/47VdcT9OLbg/s640/IMG_5088.JPG" height="407" width="620" /></a>
<p>Sashka</p>
<a href="http://picasaweb.google.com/lh/photo/bInMwxmC7-pEHb0C6oRdAQ?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUhd9KrMl2I/AAAAAAAAHQk/KnBhUurOflc/s640/IMG_5112.JPG" height="407" width="620" /></a>
<p>Me going down the slope</p>
<a href="http://picasaweb.google.com/lh/photo/BFynrx9OzoT6tOSD5ACBkQ?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUheCK8gt0I/AAAAAAAAHQk/2gpXhfxdS7k/s640/IMG_5123.JPG" height="407" width="620" /></a>
<p>
The biggest disadvantage of Val Gardena - it is overcroweded. Despite of huge area, you typically will be in long waiting lines for lifts on a popular slopes (especially ones that are on green or orange route). Besides of that just before our period of stay it was a quite warm weather there, without out big snowfalls, made slopes very hard and icy. 
</p>
<p>
<a href="http://en.wikipedia.org/wiki/Marmolada">Marmolada</a> is highest point of resort. According to wikipedia it is even seen from Venice on clear day. We dedicated one day for trip to Marmolada. It took almost 6 hours to me and Sasha to make possible to get on top and back to St. Christina. Even it took a lot of time to get where and spent a time in long waiting lines, as soon as you take a view from top you immediately forget about all bad things!
</p>
<a href="http://picasaweb.google.com/lh/photo/qr-i-zQfjiht6mCBAVnodA?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUhesMt4fEI/AAAAAAAAHQk/eN2jphz5690/s640/IMG_5167.JPG" height="407" width="620" /></a>
<p>Exceptional view</p>
<a href="http://picasaweb.google.com/lh/photo/_kzqXIW74_SkDuRRBu813g?feat=embedwebsite"><img src="http://lh6.ggpht.com/_stL4bIIuRUs/TUhezdPIECI/AAAAAAAAHQk/FVPakaSDCDI/s640/IMG_5181.JPG" height="407" width="620" /></a>
<p>Europenean Rocky Mountains :)</p>
<a href="http://picasaweb.google.com/lh/photo/pG_X8q_bjoMNrb3R1nSgtQ?feat=embedwebsite"><img src="http://lh5.ggpht.com/_stL4bIIuRUs/TUhe2Cn8svI/AAAAAAAAHQk/hzHIhGlfR8M/s640/IMG_5184.JPG" height="407" width="620" /></a>
<p>
And I really-really much enjoyed the run from Marmolada back to valley. That was fantastic.
</p>
<p>
We&#8217;ve spend one evening in Ortizei looking for a fun public places, but have found nothing.. except one small bar where ski-instructors were getting drunk after hard work days :). Despite of Ischgl <a href="http://en.wikipedia.org/wiki/Apr%C3%A8s-ski">Apre-ski</a> is not so popular in Italy, so after skiing we usually went home, preparing food and did our small parties.
</p>
<p>
6 days of snowboarding went very fast. Originally I planned to read some books and small coding stuff, but in evenings I was so tired that after a good dinner, usually with grappa or other alcohol, all I could do is only crawl into bedroom direction :). Our snowboarding times getting over, but way back-home with visits of Gratz and Lviv was waiting for us. Moreover, I&#8217;ve lost my camera in Budapest hotel, so we had to be there to take it back :).
</p>
<p>
<a href="http://maps.google.com/maps?f=q&source=s_q&hl=uk&geocode=&q=%D0%93%D1%80%D0%B0%D1%86,+%D0%90%D0%B2%D1%81%D1%82%D1%80%D1%96%D1%8F&aq=0&sll=46.538082,11.769791&sspn=0.065889,0.169086&ie=UTF8&hq=&hnear=%D0%93%D1%80%D0%B0%D1%86,+Graz,+%D0%A8%D1%82%D0%B8%D1%80%D1%96%D1%8F,+%D0%90%D0%B2%D1%81%D1%82%D1%80%D1%96%D1%8F&t=h&z=12">Gratz</a> is quite big city in Austia. Since we had not a lot of time, we visited only two Gratz&#8217;s spots, as <a href="http://en.wikipedia.org/wiki/Grazer_Schlo%C3%9Fberg">Grazer Schloßberg</a> and <a href="http://en.wikipedia.org/wiki/Kunsthaus_Graz">Kunsthaus</a>. Schloßberg is a castle on mountain, you can get there either by foot or take a lift. From the mountain you might have very nice Gratz views.
</p>
<p>Way to Schloßberg</p>
<a href="https://picasaweb.google.com/lh/photo/G2Fs5gOaXYTR3uPsuDEu-A?feat=embedwebsite"><img src="https://lh5.googleusercontent.com/_stL4bIIuRUs/TUhfv-0JhNI/AAAAAAAAHQk/Bsrz84JOvqg/s640/IMG_5227.JPG" height="407" width="620" /></a>
<p>View from mountain</p>
<a href="https://picasaweb.google.com/lh/photo/TIeMJQDN7h1JjZmEhgeO2A?feat=embedwebsite"><img src="https://lh5.googleusercontent.com/_stL4bIIuRUs/TUhf1IOw6dI/AAAAAAAAHQk/1HR_vt2hmQo/s640/IMG_5239.JPG" height="407" width="620" /></a>
<p>Kusthaus</p>
<a href="https://picasaweb.google.com/lh/photo/8Mv3_pNMn1LuElrcB22qDA?feat=embedwebsite"><img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/TUhf-nMB6GI/AAAAAAAAHQk/4_bA0VY8iVE/s640/IMG_5243.JPG" height="407" width="620" /></a>
<p>
Kusthaus is a museum of the modern art. Unfortunately, main space of museum were closed the time we visited it.. and the stuff I saw didn&#8217;t impressed me much. We paid for tickets, entered the hall see several small rooms with devices pretended to be robots and after museum worker said: &#8220;That&#8217;s basically it, goodbye&#8221;. Not fair. 
</p>
<p>
We&#8217;ve spend some time to find a place to eat.. Some restaurants were closed already that time, some was so luxury with man&#8217;s wearing smoking and lady&#8217;s in long evening dresses, that we could not conform to their companies :). I started to lose hope and recalling do we still have those crackers in hotel, but finally we found something. Austrian dishes differs from Italian ones. I liked Italian more, but anyway it was good and tasty.    
</p>
<p>
So, next morning we were moving directly back to Ukraine, with one small stop at Budapest to get camera back :). We did a route fast and easy and soon was on Ukrainian customs. Faces of custom workers immediately return you to &#8220;Ukrainian Reality&#8221;. Fortunately they were to lazy to check our car, because we a little violate the law of amount of alcohol you allowed to bring in. After the customs you are completely back to earth with the roads you have to drive. Leaving Ukraine is easy stuff, but getting back is very depressing :). Roads are awful, full of wholes and without any road markings and lightings makes it really hard to drive. Situation is complicated with a big number of trucks moving from a border of Ukraine, with a low speed.. so you all the time have to practice in overtaking. In night, with limited far view it is difficult, scary and dangerous. First car crew was helping us a lot by moving forward and giving a directions and recommendations of safe overtaking. 
</p>
<p>
I hardly could imagine how people from Europe will be driving to Ukraine to see <a href="http://en.wikipedia.org/wiki/UEFA_Euro_2012">Euro 2012</a>. 
</p>
<p>
In spite of everything we came to <a href="http://en.wikipedia.org/wiki/Lviv">Lviv</a>, one of the most beautiful places in Ukraine. Similar to Budapest, the center of Lviv is not very car-friendly. Small streets, block pavement, trams makes the problems. But now we are home, feeling that most problems are in past :). While we approached Lviv, we&#8217;ve booked appartments to live and table in one of the best places in Lviv called <a href="http://www.kumpel.biz/">Kumpel&#8217;</a>. They produce great beer (I like dark especially) and very nice dishes. After ~600km of road having a big glass of cold and tasty beer is great fun, believe me :). 
</p>
<p>Walking Lviv streets</p>
<a href="https://picasaweb.google.com/lh/photo/2s6-ql7ZUM8mRv7vXs1QDw?feat=embedwebsite"><img src="https://lh4.googleusercontent.com/_stL4bIIuRUs/TUhg9RcWt1I/AAAAAAAAHQk/U3DwTL1PAgY/s640/IMG_5289.JPG" height="407" width="620" /></a>
<p>Chimera on house</p>
<a href="https://picasaweb.google.com/lh/photo/h8DPMq0glCMYKGz59FfeUw?feat=embedwebsite"><img src="https://lh3.googleusercontent.com/_stL4bIIuRUs/TUhhD0_rfqI/AAAAAAAAHQk/_i9KmuXM-uM/s640/IMG_5292.JPG" height="407" width="620" /></a>
<p>Ukrainian delicious &#8220;Salo&#8221; with dark bread and garlic - great taste</p>
<a href="https://picasaweb.google.com/lh/photo/IMZDv8MKHa068ludshFMAw?feat=embedwebsite"><img src="https://lh6.googleusercontent.com/_stL4bIIuRUs/TUhhPR4EKUI/AAAAAAAAHQk/t0BCqA66ijE/s640/IMG_5299.JPG" height="407" width="620" /></a>
<p>
We got to Kiev, mostly with no serious at 15.00 next day. I was mostly sleep all day with a little driving before Kiev.
</p>
<p>
&#8220;East or west the home is best&#8221;, as saying goes.. We finally entered own city. Had a good bye by radio station with guys, saying &#8220;see you next year&#8221;, we landed near my house to unpack the bags and snowboards.
</p>
<p>
That was a great trip for sure! We did 3,908 kilometers in total. We had no injuries, no car damages. Visited greatest places and had snowboarding that I&#8217;ll be seeing in my night dreams in summer. You can find some more picture <a href="https://picasaweb.google.com/alexander.beletsky/21Jan2011ValGardenaTrip#">here</a>. Now, it is time to work again.. to learn new things, to blog and self-improve. Thanks a lot if you read till this point :). 
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/01/last-workday-before-vacation.html">
    
      Last workday before vacation</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-01-19T12:47:00+02:00" pubdate data-updated="true">Jan 19<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/life/'>Life</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>
Today is my last day before vacation and I&#8217;m very exited about that!
</p>
<p>
Last year my wife and my friends did a great quest from Kiev to <a href="http://maps.google.com.ua/maps?f=q&source=s_q&hl=en&geocode=&q=Ischgl,+Austria&sll=45.434336,12.338784&sspn=0.268866,0.676346&ie=UTF8&hq=&hnear=Ischgl,+Landeck+District,+Tyrol,+Austria&t=h&z=15">Ischgl, Austria</a>. It was my first experience of driving for such big distance (total drive were ~4500 kilometers). We were too optimistic to do all road at once, without any stay on night.. we did it through, but it was too difficult :).. So, when we finally hit Ischgl, we were so tired and exhausted that even beauty of snow Alps were not please us. Fortunately that feeling gone after we got good diner and sleep (I remember I slept for 15 hours then). Nevertheless of hard road the snowboarding in Austria is just fantastic! We had a lot joy of long runs, beautiful slopes, great weather and fresh air! Some photos you ca find in my <a href="http://picasaweb.google.com/alexander.beletsky/15Feb2010IschglSnowTrip#">Picasa</a>. 
</p>
<p>
This year we are smarter, experienced and want for more! At September we started to plan next adventure, this time to Italian Alps (Dolomites). We will stay in <a href="http://maps.google.com.ua/maps?f=q&source=s_q&hl=en&geocode=&q=Santa+Cristina+Val+Gardena,++Italy&sll=46.553785,11.762066&sspn=0.06587,0.169086&ie=UTF8&hq=&hnear=Santa+Cristina+Gherd%C3%ABina+Province+of+Bolzano-Bozen,+Trentino-Alto+Adige%2FS%C3%BCdtirol,+Italy&ll=46.558388,11.719494&spn=0.065865,0.169086&t=h&z=13">Santa Cristina, Italy</a>.. that gives us ability to joy of the best snow resorts of <a href="http://www.val-gardena.net/Default_en.asp">Val Gardena</a> area. This is not only place we are going to visit. We have a night stay in <a href="http://maps.google.com.ua/maps?q=Budapest,+Hungary&um=1&ie=UTF-8&sa=N&hl=en&tab=wl">Budapest, Hungary</a> (last time we had only quick change to look at it, but I would say this is one of the most beautiful cities I ever seen) and <a href="http://maps.google.com.ua/maps?f=q&source=s_q&hl=en&geocode=&q=Venice,+Italy&sll=45.434336,12.338784&sspn=0.268866,0.676346&ie=UTF8&hq=&hnear=Venice,+Veneto,+Italy&t=h&z=11&iwloc=A">Venice, Italy</a>. At the way home we also planning to vist <a href="http://maps.google.com.ua/maps?f=q&source=s_q&hl=en&geocode=&q=Retz+Austria&sll=47.44295,14.040527&sspn=3.960226,10.821533&ie=UTF8&hq=&hnear=Retz,+Hollabrunn,+Lower+Austria,+Austria&ll=48.75981,15.954895&spn=0.126289,0.338173&t=h&z=12">Retz, Austria</a>. This time we are going to join both fun of snowboarding and excitement of Europe traveling. Venice is the place I dream to visit and I&#8217;m very happy that my dream will come true, soon :).  
</p>
<p>
This year I&#8217;m leaving to vacation with very good mood. I&#8217;ve just rolled-out next version of <a href="http://trackyt.net">trackyt.net</a>, so it is upgraded up to 1.0.3 :), closed a lot of <a href="https://github.com/alexanderbeletsky/Trackyourtasks.net/issues/closed">issues</a> so far. But mostly because of very good progress we currently do with my fine team in <a href="http://www.e-conomic.com/">E-conomic</a>. I&#8217;m pretty happy to know that during my absence everything would remain with same control and with good performance. 
</p>
<p>
So, that&#8217;s my time to re-charge a batteries a little :). See you in several weeks, guys!
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/01/implementation-of-rest-service-with.html">
    
      Implementation of REST service with ASP.NET MVC</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-01-07T00:39:00+02:00" pubdate data-updated="true">Jan 7<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/github/'>GitHub</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/rest/'>REST</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>Now, after we are clear what the REST is all <a href="http://www.beletsky.net/2010/12/lets-take-rest.html">about</a> and how to <a href="http://www.beletsky.net/2010/12/testing-rest-services-with-javascript.html">verify</a> REST methods, it is time to implement our own service. I&#8217;ll create it just from scratch only reusing some data structures from my other projects and test framework. </p><h2>Project vision and goal</h2><p>Assume we are managing blogging service, with a bunch of customers. Customers are pretty happy with service, since they could post new blog posts, collect comments, build social networks etc. But since we already stepped into &#8220;API epoch&#8221;, customers started to want more.. Namely, they want API to be able to work with data from their own applications. Vendors demand API to create new cool editors for our blog service. CEO wants us to create API, because he&#8217;s just found out that applications without API are <a href="http://blog.devpulse.com/post/1069053518/applications-without-api-are-doomed">doomed</a>. Business goal is clear, so let&#8217;s implement it. We are going to create REST style API, based on JSON as data exchange format. API would allow users to get all posts, create new and delete some existing post. </p><h2>Set it up</h2><p>I&#8217;ve created just empty ASP.net MVC2 application in my Visual Studio and added it to <a href="https://github.com/alexanderbeletsky/rest.mvc.example">github</a> (please don&#8217;t be confused by bunch of other folders you see in solution, they are part of <a href="http://www.beletsky.net/2010/10/uppercut-your-builds.html">UppercuT</a> and <a href="http://www.beletsky.net/2010/10/roundhouse-your-database.html">RoundhousE</a> framework that I use for all my projects). This application is a host of new REST service. We are going to use functionality of MVC2 framework to implement it. </p><h2>Initial project content</h2><p>In Model folder of application I added <code>Linq to SQL Classes</code> item and grab <code>BlogPosts</code> table from <code>restexample</code> database to designer, so new <code>RestExampleDataContext</code> class is created and <code>BlogPost</code> entry would be part of it. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TSYecFF5mKI/AAAAAAAAHFU/Nc9IbItC_u8/s1600/blogpost-model.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 246px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TSYecFF5mKI/AAAAAAAAHFU/Nc9IbItC_u8/s400/blogpost-model.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5559164257787549858" /></a>  <pre class="brush: csharp;">[global::System.Data.Linq.Mapping.DatabaseAttribute(Name="restexample")]
public partial class RestExampleDataContext : System.Data.Linq.DataContext
{
    // implementation...  

</pre><pre class="brush: csharp;">[global::System.Data.Linq.Mapping.TableAttribute(Name="dbo.BlogPosts")]
public partial class BlogPost : INotifyPropertyChanging, INotifyPropertyChanged
{
    // implementation
</pre><p>I&#8217;ve added simple data to database that will be used by tests: </p><pre class="brush: sql">insert into BlogPosts (Url, Title, Body, CreatedDate, CreatedBy)
values ('my-post-1', 'My post 1', 'This is first post', CAST('2011-01-01' as datetime), 'alexander.beletsky');
insert into BlogPosts (Url, Title, Body, CreatedDate, CreatedBy)
values ('my-post-2', 'My post 2', 'This is second post', CAST('2011-01-02' as datetime), 'alexander.beletsky');
insert into BlogPosts (Url, Title, Body, CreatedDate, CreatedBy)
values ('my-post-2', 'My post 3', 'This is third post', CAST('2011-01-03' as datetime), 'alexander.beletsky');
</pre><h2>API Interface</h2><p>The interface we are going to implement, looks like this: </p><pre class="brush: plain">http://localhost/api/v1/posts/get/{posturl}
http://localhost/api/v1/posts/all/{username}
http://localhost/api/v1/posts/post/{username}
http://localhost/api/v1/posts/delete/{username}/{posturl}
</pre><p>For all of these interface methods, I&#8217;m adding integration javascript <a href="https://github.com/alexanderbeletsky/rest.mvc.example/blob/master/src/Web/Scripts/Tests/api/tests.api.js">tests</a> in the same way I described <a href="http://www.beletsky.net/2010/12/testing-rest-services-with-javascript.html">here</a>. Since we don&#8217;t have implementation all are failed now. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_stL4bIIuRUs/TSYesObUDqI/AAAAAAAAHFc/Pb4UzsUBHbk/s1600/api-tests-initial.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://1.bp.blogspot.com/_stL4bIIuRUs/TSYesObUDqI/AAAAAAAAHFc/Pb4UzsUBHbk/s400/api-tests-initial.png" border="0" alt=""id="Img1" /></a> <p>Please take a look on those tests before proceeding to implementation part, it would make some things more clear. </p><h2>API folder structure</h2><p>It is a question of choice but I just prefer to put all API related code to separate folder, called (who might guess?) &#8220;API&#8221;. It is really similar with Area, by it&#8217;s structure. It has <code>Controllers</code>, <code>Models</code> and <code>Registration</code> class. It does not have any <code>Views</code>, since API does not expose any UI. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfDDRmplI/AAAAAAAAHFk/UKMxUqd5uAg/s1600/api-folder.png"><img style="cursor:pointer; cursor:hand;width: 331px; height: 268px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfDDRmplI/AAAAAAAAHFk/UKMxUqd5uAg/s400/api-folder.png" border="0" alt=""id="Img2" /></a> <h2>Routing</h2><p>If I were asked to describe what the ASP.net MVC2 application is about I would answer: &#8220;It is mapping between HTTP request, with particular URL, to corresponding method of handler class. This handler is called controller, method is called action&#8221;. So, the primary goal of MVC application is to define such mapping. In terms of MVC such mapping is called routing. It is all about the routing.  </p><p>Let&#8217;s take a look on our interface one more time and we came up with such routing definition for API.  </p><pre class="brush: csharp">using System.Web.Mvc;

namespace Web.API.v1
{
    public class ApiV1Registration : AreaRegistration
    {
        public override string AreaName
        {
            get { return "ApiV1"; }
        }

        public override void RegisterArea(AreaRegistrationContext context)
        {
            context.MapRoute(
                "ApiV1_posts",
                "api/v1/posts/{action}/{userName}/{postUrl}",
                new { controller = "APIV1", postUrl = UrlParameter.Optional });
        }
    }
}
</pre><h2>API Controller</h2><p>After routing is defined, it is time to add actual hander - controller class. Initially it would be empty, with out any action. Just initialization of <code>context</code> object. </p><pre class="brush: csharp">namespace Web.API.v1.Controllers
{
    public class ApiV1Controller : Controller
    {
        private RestExampleDataContext _context = new RestExampleDataContext();
        
        // actions..
    }
}
</pre><h2>API Actions implementation</h2><p>We&#8217;ve complete infrastructure to start implementation. Solution, Project, Interface, Tests, Routing, Controller.. now it is time for Actions. </p><h3>Get all posts method</h3><p><pre>http://localhost/api/v1/posts/all/{username}
</pre></p><p>It receives <code>username</code> as parameter and expected to return all blog posts belong to this user. Code is: </p><pre class="brush: csharp">[HttpGet]
public JsonResult All(string userName)
{
    var posts = _context.BlogPosts.Where(p => p.CreatedBy == userName);

    return Json(
        new { success = true, data = new { posts = posts.ToList() } }, JsonRequestBehavior.AllowGet
    );
}
</pre><p>Signature of action method said: respond to <code>HttpGet</code> verb, get all records with corresponding userName and return as Json.  </p><p><code>Json</code> method of Controller class is really cool feature of MVC2 framework. It receives anonymous type object and serialize it Json. So, the <code>new { success = true, data = new { posts = posts.ToList() } }</code> object will be serialized into: </p><pre class="brush: csharp">{"success":true,"data":{"posts":[{"Id":1,"Url":"my-post-1","Title":"My post 1","Body":"This is first post","CreatedDate":"\/Date(1293832800000)\/","CreatedBy":"alexander.beletsky","Timestamp":{"Length":8}},{"Id":2,"Url":"my-post-2","Title":"My post 2","Body":"This is second post","CreatedDate":"\/Date(1293919200000)\/","CreatedBy":"alexander.beletsky","Timestamp":{"Length":8}},{"Id":3,"Url":"my-post-2","Title":"My post 3","Body":"This is third post","CreatedDate":"\/Date(1294005600000)\/","CreatedBy":"alexander.beletsky","Timestamp":{"Length":8}}]}}
</pre><p>Nice and clean. </p><p>Take a note to <code>JsonRequestBehavior.AllowGet</code>. This is a special flag, you have to pass to <code>Json</code> method, if it is being called from GET handler method. This is done to prevent <a href="http://haacked.com/archive/2009/06/25/json-hijacking.aspx">Json Hijacking</a> type of attack. So, actually if your API call returns user sensitive data, you should consider POST instead of GET.  </p><p>Let&#8217;s re-run test suite and see that first test is green now. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfXLeuhmI/AAAAAAAAHFs/IH0dZSk3X9A/s1600/api-tests-firstpass.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfXLeuhmI/AAAAAAAAHFs/IH0dZSk3X9A/s400/api-tests-firstpass.png" border="0" alt=""id="Img3" /></a> <h3>Create new post method</h3><pre>http://localhost/api/v1/posts/all/{username}
</pre><p>It receives <code>username</code> as parameter and blog post content in POST body as payload. Code is: </p><pre class="brush: csharp">[HttpPost]
public JsonResult Post(string userName, PostDescriptorModel post)
{
    var blogPost = new BlogPost {
        CreatedBy = userName,
        CreatedDate = DateTime.Now,
        Title = post.Title,
        Body = post.Body,
        Url = CreatePostUrl(post.Title) 
    };

    _context.BlogPosts.InsertOnSubmit(blogPost);
    _context.SubmitChanges();

    return Json(
        new { success = true, url = blogPost.Url });
}

private string CreatePostUrl(string title)
{
    var titleWithoutPunctuation = new string(title.Where(c => !char.IsPunctuation(c)).ToArray());
    return titleWithoutPunctuation.ToLower().Trim().Replace(" ", "-");
}
</pre><p>where <code>PostDescriptorModel</code> is </p><pre class="brush: csharp">namespace Web.API.v1.Models
{
    public class PostDescriptorModel
    {
        public string Title { get; set; }
        public string Body { get; set; }
    }
}
</pre><p>If you try to run this example just like that, you will see that <code>PostDescriptorModel</code> instance will be null. MVC2 could not handle Json payload. But if you google a little you find article by Phil Haack, where he addresses exactly the same issue - <a href="http://haacked.com/archive/2010/04/15/sending-json-to-an-asp-net-mvc-action-method-argument.aspx">Sending JSON to an ASP.NET MVC Action Method Argument</a>. Support of Json as action method is implemented in MVC Futures 2 library (library that contains useful extensions, that are not yet part of framework but will be there with big chances). Download it by this <a href="http://aspnet.codeplex.com/releases/view/41742#DownloadId=110348">link</a> add reference to project and in Global.asax.cs add <code>JsonValueProviderFactory</code>: </p><pre class="brush: csharp">protected void Application_Start()
{
    AreaRegistration.RegisterAllAreas();

    RegisterRoutes(RouteTable.Routes);

    ValueProviderFactories.Factories.Add(new JsonValueProviderFactory());

    // ...
</pre><p><strong>Important:</strong> </p><ul><li>In case you are using MVC3 framework, you do not need to include MVC Futures assembly, since <code>JsonValueProviderFactory</code> is already included into MVC3.</li>
</ul><p>If I try to re-run the tests, I&#8217;ll see that &#8220;create new post&#8221; test is still red. That&#8217;s because &#8220;get post&#8221; API method is still not implemented. </p><h3>Get post by url method</h3><pre>http://localhost/api/v1/posts/get/{posturl}
</pre><p>It receives <code>post</code> as post url and return blog post object in response. Code is: </p><pre class="brush: csharp">[HttpGet]
public JsonResult Get(string userName, string postUrl)
{
    var blogPost = _context.BlogPosts.Where(p => p.CreatedBy == userName && p.Url == postUrl).SingleOrDefault();

    return Json(
        new { success = true, data = blogPost }, JsonRequestBehavior.AllowGet);
}
</pre><p>Last red test is &#8220;delete post test&#8221;, so let&#8217;s implement delete API call. </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_stL4bIIuRUs/TSYfrWASkDI/AAAAAAAAHF0/QgJ68LePMUU/s1600/api-tests-secondpass.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://4.bp.blogspot.com/_stL4bIIuRUs/TSYfrWASkDI/AAAAAAAAHF0/QgJ68LePMUU/s400/api-tests-secondpass.png" border="0" alt=""id="Img4" /></a> <h3>Delete post by url method</h3><p><pre>http://localhost/api/v1/posts/delete/{posturl}
</pre></p><p>It receives <code>post</code> as post url and return status in response. Code is: </p><pre class="brush: csharp">[HttpDelete]
public JsonResult Delete(string userName, string postUrl)
{
    var blogPost = _context.BlogPosts.Where(p => p.CreatedBy == userName && p.Url == postUrl).SingleOrDefault();

    _context.BlogPosts.DeleteOnSubmit(blogPost);
    _context.SubmitChanges();

    return Json(
        new { success = true, data = (string)null });
}
</pre><p>Now all tests are green. Fantastic! </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfzxv7ueI/AAAAAAAAHF8/geiqvbnxbcU/s1600/api-tests-allpass.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYfzxv7ueI/AAAAAAAAHF8/geiqvbnxbcU/s400/api-tests-allpass.png" border="0" alt=""id="Img5" /></a> <h2>Handle Json Errors</h2><p>What happens if exception thrown with-in API method? Let&#8217;s create a test and see: </p><pre class="brush: js">test("fail method test", function () {

    var method = 'posts/fail';
    var data = null;
    var type = 'GET';
    var params = ['alexander.beletsky'];

    var call = createCallUrl(this.url, method, params);

    api_test(call, type, data, function (result) {
        ok(result.success == false, method + " expected to be failed");
        same(result.message, "The method or operation is not implemented.");
    });
});
</pre><p>And add implementation of failed method: </p><pre class="brush: csharp">[HttpGet]
public JsonResult Fail()
{
    throw new NotImplementedException();
}
</pre><p>If I run the test, I&#8217;ll see such result: </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYgMgCcVwI/AAAAAAAAHGE/RcPpQUSlRn4/s1600/api-tests-exception.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://3.bp.blogspot.com/_stL4bIIuRUs/TSYgMgCcVwI/AAAAAAAAHGE/RcPpQUSlRn4/s400/api-tests-exception.png" border="0" alt=""id="Img6" /></a> <p>This is not very greceful. It is expected that Json response would contain <code>false</code> in <code>success</code> attribute and <code>message</code> would contain actual exception message. </p><p>Of cause, it is possible to wrap all methods in <code>try / catch</code> code block and return corresponding Json in <code>catch</code> block, but this violates DRY (don&#8217;t repeat yourself) principle and makes code ugly. It is much more better to use MVC2 method attributes for that. </p><p>So, we define new attribute that would handle error and in case of exception thrown with-in Action method, this exception will be wrapped in Json object and returned as a response. </p><pre class="brush: csharp">namespace Web.Infrastructure
{
    public class HandleJsonError : ActionFilterAttribute
    {
        public override void OnActionExecuted(ActionExecutedContext filterContext)
        {
            if (filterContext.HttpContext.Request.IsAjaxRequest() && filterContext.Exception != null)
            {
                filterContext.HttpContext.Response.StatusCode = (int)System.Net.HttpStatusCode.InternalServerError;
                filterContext.Result = new JsonResult()
                {
                    JsonRequestBehavior = JsonRequestBehavior.AllowGet,
                    Data = new
                    {
                        success = false,
                        message = filterContext.Exception.Message,
                    }
                };
                filterContext.ExceptionHandled = true;
            }
        }
    }
}
</pre><p>Add this attribute to method definition: </p><pre class="brush: csharp">[HttpGet]
[HandleJsonError]
public JsonResult Fail()
{
    throw new NotImplementedException();
}
</pre><p>And I&#8217;m happy to see that all tests are passing now! </p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_stL4bIIuRUs/TSYgcv4TQQI/AAAAAAAAHGM/2QAUQc7jWBQ/s1600/api-tests-allpassed.png"><img style="cursor:pointer; cursor:hand;width: 400px; height: 225px;" src="http://2.bp.blogspot.com/_stL4bIIuRUs/TSYgcv4TQQI/AAAAAAAAHGM/2QAUQc7jWBQ/s400/api-tests-allpassed.png" border="0" alt=""id="Img7" /></a> <p>Since we need similar behavior for all API calls it is better to add this attribute to class, instead of method. </p><pre class="brush: csharp">namespace Web.API.v1.Controllers
{
    [HandleJsonError]
    public class ApiV1Controller : Controller
    {
        // code..
</pre><h2>Examples and code for reuse</h2><p>All code is re-usable and available on my github repository - <a href="https://github.com/alexanderbeletsky/rest.mvc.example">https://github.com/alexanderbeletsky/rest.mvc.example</a>.  </p></div>

      
      
    </div>
  </div>

    </article>
  
  <div class="pagination inner pure-u-1">
    
      <a class="prev" href="/blog/page/16/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/14/">Newer &rarr;</a>
    
  </div>
</div></div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright © 2010 - 2013 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>