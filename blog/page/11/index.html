
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Beletsky's development blog</title>
  <meta name="author" content="Alexander Beletsky">

  
  <meta name="description" content="Integrating ASP.NET MVC Into Legacy Web Site Oct 30th, 2011 MVC, Tips, asp.net For some quite long time I naively thought that it is not possible ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://beletsky.net/blog/page/11/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/fontello.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/pure-min.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/style.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alexander Beletsky's development blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16388698-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<header class="pure-g-r"><div class="pure-g-r">
	<div class="inner pure-u-1">
		<h4 class="light">Alexander Beletsky's development blog</h4>
		<h1><a href="/">My profession is engineering</a></h1>
		<nav role="navigation" class="pure-menu pure-menu-open pure-menu-horizontal light"><ul>
	<li><a href="/projects">Projects</a></li>
	<li><a href="/talks">Talks</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/about">About me</a></li>
</ul>

</nav>
	</div>
</div>

</header>
	<div class="social inner pure-menu-horizontal"><ul>
	<li><a class="twitter icon-twitter" href="http://twitter.com/alexbeletsky"></a></li>
	<li><a class="github icon-github-circled" href="https://github.com/alexanderbeletsky"></a></li>
	<li><a class="stackoverflow icon-stackoverflow" href="http://stackoverflow.com/users/386751/alexanderb"></a></li>
	<li><a class="rss icon-rss" href="http://feeds.feedburner.com/abeletskyblog"></a></li>
</ul>
</div>
	<div id="content" class="inner pure-g-r"><div class="blog-index">
  
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/10/integrating-aspnet-mvc-into-legacy-web.html">
    
      Integrating ASP.NET MVC Into Legacy Web Site</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-10-30T09:05:00+02:00" pubdate data-updated="true">Oct 30<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>For some quite long time I naively thought that it is not possible (or at least very difficult) to make ASP.NET MVC stuff work on a Web Site project. But, my latest <a href="http://www.beletsky.net/search/label/InsideMVC">hacking of MVC</a> opened another perspectives. There are no any difficulties with ASP.NET MVC on Web Sites. I&#8217;ll share an experience of integration ASP.NET MVC in my work project legacy Web Site.<br />
</p><h2>Pre-conditions</h2><p>In my case I integrated ASP.NET MVC2, since we are still running on .NET 3.5. If you are running .NET 4.0 the best is to go with ASP.NET MVC3 already. The difference of setup would not be huge, just in proper versions of assemblies.<br />
</p><p>I assume you already have ASP.NET MVC2 framework on your machine (if you have VS2010 - you definitely have one), if no just go that <a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=22079">link</a> and install it.<br />
</p><h2>Web config changes</h2><p>MVC assembly have to be added to <code>web.config</code>. Since the MVC infrastructure heavily depends on Routing mode, it have to be put to <code>web.config</code> as well.<br />
</p><p>Register MVC assemblies:<br />
</p><pre class="brush: xml">&lt;compilation defaultLanguage=&quot;c#&quot; debug=&quot;true&quot;&gt;
 &lt;assemblies&gt;
  &lt;add assembly=&quot;System.Core, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089&quot;/&gt;
  &lt;add assembly=&quot;System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
  &lt;add assembly=&quot;System.Data.DataSetExtensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089&quot;/&gt;
  &lt;add assembly=&quot;System.Xml.Linq, Version=3.5.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089&quot;/&gt;
  &lt;add assembly=&quot;System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A&quot;/&gt;

  &lt;!-- Your application specific assemblies--&gt;
        ...

  &lt;!-- ASP.NET MVC --&gt;
  &lt;add assembly=&quot;System.Web.Abstractions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
  &lt;add assembly=&quot;System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
  &lt;add assembly=&quot;System.Web.Mvc, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
 &lt;/assemblies&gt;
&lt;/compilation&gt;
</pre><p>Namespaces:<br />
</p><pre class="brush: xml">&lt;pages enableViewStateMac=&quot;false&quot; enableViewState=&quot;false&quot; validateRequest=&quot;true&quot; viewStateEncryptionMode=&quot;Never&quot;&gt;
  &lt;controls&gt;
    &lt;add tagPrefix=&quot;asp&quot; namespace=&quot;System.Web.UI&quot; assembly=&quot;System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
    &lt;add tagPrefix=&quot;asp&quot; namespace=&quot;System.Web.UI.WebControls&quot; assembly=&quot;System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot;/&gt;
  &lt;/controls&gt;
  
  &lt;-- ASP.NET MVC --&gt;
  &lt;namespaces&gt;
    &lt;add namespace=&quot;System.Web.Mvc&quot;/&gt;
    &lt;add namespace=&quot;System.Web.Mvc.Ajax&quot;/&gt;
    &lt;add namespace=&quot;System.Web.Mvc.Html&quot;/&gt;
    &lt;add namespace=&quot;System.Web.Routing&quot;/&gt;
    &lt;add namespace=&quot;System.Linq&quot;/&gt;
    &lt;add namespace=&quot;System.Collections.Generic&quot;/&gt;
    &lt;add namespace=&quot;Microsoft.Web.Mvc&quot;/&gt;
  &lt;/namespaces&gt;
&lt;/pages&gt;
</pre><p>Register URLRouting module and handler.<br />
</p><pre class="brush: xml">&lt;system.webServer&gt;
  &lt;validation validateIntegratedModeConfiguration=&quot;false&quot;/&gt;
  &lt;modules&gt;
 ...
 
 &lt;!-- ASP.NET MVC --&gt;
    &lt;add name=&quot;UrlRoutingModule&quot; type=&quot;System.Web.Routing.UrlRoutingModule, System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35&quot; /&gt;
  &lt;/modules&gt;
  &lt;handlers&gt;
    ...
 
 &lt;!-- ASP.NET MVC --&gt;
    &lt;add name=&quot;UrlRoutingHandler&quot; preCondition=&quot;integratedMode&quot; verb=&quot;*&quot; path=&quot;UrlRouting.axd&quot; type=&quot;System.Web.HttpForbiddenHandler, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot; /&gt;
  &lt;/handlers&gt;
&lt;/system.webServer&gt;
</pre><h2>Global.asax changes</h2><p>You would be probably have <code>global.asax</code> without code-behind class. It&#8217;s not a problem, all you need is slightly change the <code>Application_Start()</code> method. Basically you can go and register routes there, as you do in any ASP.NET MVC application. But I didn&#8217;t do that. Instead, I used the advantages of <a href="http://msdn.microsoft.com/en-us/library/ee671793.aspx">Areas</a> feature of MVC2, since it makes better logical grouping. So, my <code>global.asax</code> are:<br />
</p><pre class="brush: csharp">public void Application_Start()
{
 AreaRegistration.RegisterAllAreas();
}
</pre><h2>Models, Views, Controllers</h2><p>In typical ASP.NET MVC application you have 3 folders, for - Models, Views, Controllers. Models/Controllers are C# code, views are .aspx pages. With a Web Site you typically place code into <code>App_Code</code> folder. But you should not do that. Instead, it it better to create a separate class library project that would hold your models and controllers. Views would be placed under corresponding Area folder.<br />
</p><h2>New project for Models/Controllers</h2><p>Just create a new class library project with such folder structure:<br />
</p><a href="https://lh4.googleusercontent.com/-ny77OywB_Pk/Tqz2RrcVfCI/AAAAAAAAHnM/P2Awn0D79zc/s391/img-1.png"><br />
<img src="https://lh4.googleusercontent.com/-ny77OywB_Pk/Tqz2RrcVfCI/AAAAAAAAHnM/P2Awn0D79zc/s391/img-1.png" alt="asp.net mvc class library" /><br />
</a><br />
<p>The most important - it should contain Area Registration class inside. This is the one that suppose to register all router for your application:<br />
</p><pre class="brush: csharp">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Web.Mvc;

namespace Sba.Web.Areas.Sales
{
 public class SalesAreaRegistration : AreaRegistration 
 {
  public override string AreaName
  {
   get 
   {
    return "Sales";
   }
  }

  public override void RegisterArea(AreaRegistrationContext context)
  {
            // All routes are here..

   context.MapRoute(
    "Sba_Sales",
    "sba/sales/{controller}/{action}/{id}",
    new { controller = "Home", action = "Index", id = UrlParameter.Optional }
   );
  }
 }
}
</pre><p>That&#8217;s it. Now you implement Controller/Models in usual way and able to add unit tests project for new assembly.<br />
</p><p>Make sure that assembly will be placed into to Web Site <code>/Bin</code> folder. I simply added <code>../Site/Bin</code> as project output directory. At the site initialization and <code>Application_Start()</code> call of Global.asax, all <code>AreaRegistration</code> instances would be created and routes being registered.<br />
</p><h2>Views</h2><p>Views have to be placed in the Web Site folder itself. MVC has several rules for views placements, so you have to follow them. Views for controllers that are part of Area&#8217;s have to be places into <code>Site/Areas/AreaName/Views</code>, the common stuff line master pages are in <code>Site/Views/Shared</code>. It is very important that each View folder must contain the <code>web.config</code> inside. You can either pick it up from default MVC2 application of just grab from <a href="https://gist.github.com/1325577">gist</a>.<br />
</p><a href="https://lh3.googleusercontent.com/-1oPOjbGMkIA/Tqz2Rs4oS6I/AAAAAAAAHnE/_jP0yI97UZg/s313/img-3.png"><br />
<img src="https://lh3.googleusercontent.com/-1oPOjbGMkIA/Tqz2Rs4oS6I/AAAAAAAAHnE/_jP0yI97UZg/s313/img-3.png" alt="views folder structure" /><br />
</a><br />
<h2>IIS configuration</h2><p>Our application previously worked in &#8220;Classic&#8221; mode. Even thought, it is possible to run MVC on &#8220;Classic&#8221; I would not really recommend it to do and if production environment allows, just switch you application pool to &#8220;Integrated mode&#8221;.   <br />
</p><a href="https://lh6.googleusercontent.com/-cgYuQPO2v3o/Tqz2Rho34dI/AAAAAAAAHnI/jP_SfDVxFcY/s349/img-2.png"><br />
<img src="https://lh6.googleusercontent.com/-cgYuQPO2v3o/Tqz2Rho34dI/AAAAAAAAHnI/jP_SfDVxFcY/s349/img-2.png" alt="iis application pool config" /><br />
</a><br />
<p>After you did it, you can go and run you application. If you setup basic Home controller and view, you should be able to access it by given route. If you receiving 403 HTTP error check:<br />
</p><ul><li>Are you really on integrated mode?</li>
<li>Are there any physical folders that the same as you routing, e.g /sba/sales route and /site/sba/sales folder? In such case you either should correct the routing or change site folder structure.</li>
</ul><h2>Session is Null issue</h2><p>Moving along and starting implementation of some real controllers, we&#8217;ve got very strange <code>NullReferenceException</code> problem. After bit debugging it turned out that <code>HttpContext.Current.Session</code> is null in controller actions. That&#8217;s the common problem for legacy web sites. It is very well described in this <a href="http://stackoverflow.com/questions/218057/httpcontext-current-session-is-null-when-routing-requests">stackoverflow</a> answer. So, you just need to add one more section into <code>web.config</code> file.<br />
</p><pre class="brush: xml">&lt;configuration&gt;
  ...
  &lt;system.webServer&gt;
    ...
    &lt;modules&gt;
      &lt;remove name=&quot;Session&quot; /&gt;
      &lt;add name=&quot;Session&quot; type=&quot;System.Web.SessionState.SessionStateModule&quot;/&gt;
      ...
    &lt;/modules&gt;
  &lt;/system.webServer&gt;
&lt;/configuration&gt;
</pre><p>After all of those configuration changes your Web Site is fully adopted to ASP.NET MVC framework usage. So, just go ahead and feel the awesomeness of MVC!<br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/10/greg-young-and-rinat-abdulin-visited.html">
    
      Greg Young and Rinat Abdulin Visited Kyiv</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-10-25T09:47:00+03:00" pubdate data-updated="true">Oct 25<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/beerncode/'>BeerNCode</a>, <a class='category' href='/blog/categories/conference/'>Conference</a>, <a class='category' href='/blog/categories/ddd/'>DDD</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>It finally happened, <a href="http://codebetter.com/gregyoung/">Greg Young</a> and <a href="http://abdullin.com/">Rinat Abdulin</a> have been guesting Kyiv for almost the week. <br />
</p><p>Initially we&#8217;ve gathered on <a href="http://kyivbeerncode.org/">Beer && Code</a> meeting. The format a little changed that time, but I would say that was really interesting meeting. Greg introduced one of the project he currently working on <a href="http://continuoustests.com/">http://continuoustests.com/</a> that now referenced as &#8220;Mighty Moose&#8221;. &#8220;Mighty Moose&#8221; appear to be really powerful tool that tracks both code and tests changes, and in case of changes taking place it automatically re-runs all related test cases. So, we&#8217;ve grabbed the latest version on MM and played with it a bit. MM is officially in betta now and gonna to be release soon, so did a small contribution by submitting some bugs found on a fly. I also really much enjoyed the quick demonstration of <a href="https://github.com/gregoryyoung/Simple.Testing">Simple.Testing</a> framework. It worth to have a separate blog post on that, but in short - it is BDD style framework that literally produce plain English specifications as it&#8217;s output. It&#8217;s indeed very simple - just several hundreds LOC&#8217;s, but very impressive.<br />
</p><p>But of cause, the main event was <a href="http://www.facebook.com/event.php?eid=268332313185736">Free Event Centric Weekend</a>. It is very hard to describe what was there just in this short post. You might check out some tweets on <a href="http://twitter.com/#!/search/eventcentric">#eventcentric</a> channel. Greg and Rinat were sharing their huge experience on CQRS/DDD and I would say that was extremely interesting. I&#8217;m not using either CQRS or DDD on my daily work, so a lot of new concept&#8217;s I&#8217;ve heard are still really unknown to me, but I&#8217;m happy I looked behind the curtain. Greg is <a href="http://martinfowler.com/bliki/ShuHaRi.html">Ri</a> level developer - he is simply breaking the concepts. Seriously, I was blown away with some of the statements and my brain is still &#8220;damaged&#8221; with everything I heard there.<br />
</p><a href="https://lh4.googleusercontent.com/-_2de-YNoo-0/TqZWzXugX3I/AAAAAAAAHm0/_zNc09RHImQ/s720/eventcentic.jpg"><br />
<img src="https://lh4.googleusercontent.com/-_2de-YNoo-0/TqZWzXugX3I/AAAAAAAAHm0/_zNc09RHImQ/s720/eventcentic.jpg" alt="Eventcentric meeting in Kyiv" style="width: 620px" /><br />
</a><br />
<p>Besides of that we had several cool evenings, drinking beers. I would say that was great week and I&#8217;m really happy to meet you guys. I would also say big thanks to <a href="http://kievalt.net/">KievAltNet</a>, <a href="http://www.luxoft.com/">Luxoft</a> with support they provided to make this happen. I know this in not your last visit to Kiev, so see you soon! <br />
</p><p>ps. As more you know as more unknown you are able to see&#8230;<br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/10/network-conference-in-kharkiv.html">
    
      NETWork Conference in Kharkiv</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-10-16T16:55:00+03:00" pubdate data-updated="true">Oct 16<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/conference/'>Conference</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>In short, it was one of the most exciting and interesting conferences I ever been (and participated) so far. My big respect goes to organizers: <a href="http://sigmaukraine.com/">Sigma Ukraine</a>, <a href="http://www.akvelon.com.ua/">Akvelon</a> and <a href="http://ciklum.net/">Ciklum</a> as main sponsor. <br />
</p><p>In a little long, I&#8217;ve been invited to participate this conference by <a href="http://www.facebook.com/anastasiakladova">Anastasia Kladova</a>, the PR manager of <a href="http://sigmaukraine.com/">Sigma Ukraine</a> during my visit of <a href="http://www.beletsky.net/2011/08/it-jam-2011-in-odessa_23.html">IT Jam 2011</a> this summer. It sounded so cool to me, since so famous guys as <a href="http://network-ua.com/speaker/ayende-rahien-aka-oren-eini/">Ayende</a>, <a href="http://network-ua.com/speaker/greg-young/">Greg Young</a> and <a href="http://network-ua.com/speaker/rinat-abdullin/">Rinat Abdulin</a> would be the speakers there as well. I had not other choice, just to agree.<br />
</p><p>Well, my trip to Kharkiv started not very good. Due to my personal awkwardness I simply missed the train. Now I have fun of that fact, by then I was standing on station and seeing my train passing away - it was not so fun to me. Anyway, with great advice of <a href="">@chaliy</a> by phone I switched to another train. The one one problem was - it comes to Kharkiv pretty late, at 10.00 o&#8217;clock.<br />
</p><p>Unfortunately I missed first keynote by <a href="http://network-ua.com/speaker/sander-hoogendorn/">Sander</a> and first session of speeches. But I was ready for the rest of the day. I would not describe long my feelings to meet colleagues from other cities, which we communicate thought twitter. But it is exactly the conferences like that, where we have real opportunity to talk to each other. As for me, such communication is a bigger asset of any conference including NETWork.<br />
</p><a href="https://lh6.googleusercontent.com/-kH4mZBDxBug/Tp2QkwVhZ1I/AAAAAAAAHmo/DRX7IEoA1pI/s720/DSC_2356.JPG"><br />
<img src="https://lh6.googleusercontent.com/-kH4mZBDxBug/Tp2QkwVhZ1I/AAAAAAAAHmo/DRX7IEoA1pI/s720/DSC_2356.JPG" /><br />
</a><br />
<p>Let me share some feedback I got about the speeches I visited:<br />
</p><ul><li><br />
<strong>CQRS AND EVENT SOURCING</strong> by <a href="http://network-ua.com/speaker/greg-young/">Greg Young</a> - I really much enjoyed the that speech. Doesn&#8217;t matter I&#8217;ve seen it before on video :) - still I was amazed about his speakers skill and energy he exposed towards the audience. His mimic, body language and personal behavior - made the speech really attractive. I would not say I heard something really new to me, but at least I improved some knowledge I already had.<br />
</li>
<li><br />
<strong>APPLIED CODE GENERATION IN .NET</strong> by <a href="http://network-ua.com/speaker/dmitro-mindra/">Dmitry Mindra</a> - great talk about Code Generation in .NET application. Even, if I dislike code generation much, Dmitry managed to find good Pros. and Cons. of code generation. So, at the end of the speech I even was not possible to start holy war on that topic, since really strong facts he had.<br />
</li>
<li><br />
<strong>INSIDE ASP.NET MVC FRAMEWORK</strong> be me - yeah, that&#8217;s my speech so I&#8217;m not really happy as usual. Again, I didn&#8217;t fit everything I wanted to say. Something that I did seems was not really clear and far away from comprehensive. It would be last attempt I do that &#8216;Inside MVC&#8217; talk - it is simply too big, so probably next time I just select one small topic and focus on that. Anyway, I all the time enjoy the speaking and I really like that feeling of stress before and relax after :).  <br />
</li>
<li><br />
<strong>NOSQL – A CHANGE OF PERSPECTIVE FOR THE DEVELOPER OF TODAY</strong> by <a href="http://network-ua.com/speaker/ayende-rahien-aka-oren-eini/">Ayende</a> - I have a split decision on that. The beginning of the speech was simply boring, I don&#8217;t understand the reason of spending 0.5h do describe the difference of price of 1 Mb HDD in 80&#8217;s and 00&#8217;s. Moreover, due to Ayende&#8217;s accent sometimes I just missed the idea. The end of the speech were more exiting but still I was disappointed. Ayende is great developer, everybody knows that - but it was not even one small example of code working with RavenDB. Probably he left it for some practical session, but still I think it is kind of drawback of his presentation.<br />
</li>
</ul><p>And after all speeches we had a kind of Round Table. All speaker got on stage and answering the questions of audience. It was a little funny to me how it went. First, the language - some questions were in English but answered in Russian, some was Russian but answered English :). I actually used English in respect towards our foreign guests, but anyway. The answers were long, not exact and mainly loosing the point of original question. I think the moderation (with a timing and topics) is really important here. <br />
</p><p>What I remembered the most is the question to Ayende - &#8220;How you became so productive?&#8221;, and the answer was something that great developer should answer &#8220;I&#8217;m not so productive, I just code a lot and do some blog posts&#8221;. Yeah, &#8220;Code a lot&#8221; - so simple rule to became from good to great. I&#8217;ll remember that.<br />
</p><p>Finally we had a great dinner at the one of Kharkiv&#8217;s restaurant&#8217;s. And I went to train station (0.5 hours ahead). There I met my guys from <a href="http://kievalt.net/">Kiev ALT.NET</a> who had a great mood and bag full of beer. So, we&#8217;ve had nice Beer && Talk session till 3.00 AM on our way back home. <br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/10/inside-aspnet-mvc-idependencyresolver.html">
    
      Inside ASP.NET MVC: IDependencyResolver - Service locator in MVC</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-10-13T21:55:00+03:00" pubdate data-updated="true">Oct 13<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>All types inside ASP.NET MVC3 framework are being resolved by <code>IDependencyResolver</code>. The design goal of this interface is to provide flexibility and decrease coupling between components. <br />
</p><pre class="brush:csharp">namespace System.Web.Mvc {
    using System.Collections.Generic;

    public interface IDependencyResolver {
        object GetService(Type serviceType);
        IEnumerable&lt;object&gt; GetServices(Type serviceType);
    }
}
</pre><p>If take a look into the code you will definitely smell the <a href="http://msdn.microsoft.com/en-us/library/ff648968.aspx">Service Locator</a> pattern. Indeed, <code>IDependencyResolver</code> is pure service locator.<br />
</p><h2>DependencyResolver as IDependencyResolver holder</h2><p><code>IDependencyResolver</code> instance is being accessed through the <code>DependencyResolver</code> class. <br />
</p><pre class="brush:csharp">public class DependencyResolver {
 // Static accessors

 private static DependencyResolver _instance = new DependencyResolver();

 public static IDependencyResolver Current {
  get {
   return _instance.InnerCurrent;
  }
 }
</pre><p>It is a singleton class, current instance is being accessed through <code>Current</code> property. The default implementation is <code>DefaultDependencyResolver</code>. <br />
</p><pre class="brush:csharp">// Instance implementation (for testing purposes)

private IDependencyResolver _current = new DefaultDependencyResolver();

</pre><p>Even if the comment says (for testing purposes) that class is used in real code. Let&#8217;s take a look on that.<br />
</p><pre class="brush:csharp">private class DefaultDependencyResolver : IDependencyResolver {
 [SuppressMessage(&quot;Microsoft.Design&quot;, &quot;CA1031:DoNotCatchGeneralExceptionTypes&quot;, Justification = &quot;This method might throw exceptions whose type we cannot strongly link against; namely, ActivationException from common service locator&quot;)]
 public object GetService(Type serviceType) {
  try {
   return Activator.CreateInstance(serviceType);
  }
  catch {
   return null;
  }
 }

 public IEnumerable&lt;object&gt; GetServices(Type serviceType) {
  return Enumerable.Empty&lt;object&gt;();
 }
}
</pre><p>As you might see, it is extremely simple. It just tries to resolve the type by <code>Activator</code> class. If the type could be resolved it just returns it&#8217;s instance, otherwise just return null. The <code>GetServices</code> method just returns empty enumerable. <br />
</p><h2>Substituting default DependencyResolver</h2><p>As I said above, the main design goal of <code>DependencyResolver</code> is to provide flexibility. By flexibility I mean just easy way to substitute any type with own implementation. Say you want to change the <code>ControllerFactory</code> or <code>ModelBinder</code> or what ever you like. Everything is possible just by overriding <code>IDependencyResolver</code>.<br />
</p><p>I&#8217;ve seen one common misconception about MVC3, that it is contains IoC container inside it. It is not true, but it expose the interface which really much suites interfaces of famous IoC containers. To do not have a strict rules and force developers to use one type of IoC, ASP.NET MVC developers created a facility by which you can integrate yours IoC of choice. Let&#8217;s have a look how to do that. <br />
</p><p><code>DependencyResolver</code> contains the number of setters to substitute the instance.<br />
</p><pre class="brush:csharp">public static void SetResolver(IDependencyResolver resolver) {
 _instance.InnerSetResolver(resolver);
}

public static void SetResolver(object commonServiceLocator) {
 _instance.InnerSetResolver(commonServiceLocator);
}

[SuppressMessage(&quot;Microsoft.Design&quot;, &quot;CA1006:DoNotNestGenericTypesInMemberSignatures&quot;, Justification = &quot;This is an appropriate nesting of generic types.&quot;)]
public static void SetResolver(Func&lt;Type, object&gt; getService, Func&lt;Type, IEnumerable&lt;object&gt;&gt; getServices) {
 _instance.InnerSetResolver(getService, getServices);
}
</pre><p>As example of implementation here my very dummy dependency resolver.<br />
</p><pre class="brush:csharp">namespace MvcForDebug2.Infrastructure {
    public class DummyDependencyResolver : IDependencyResolver {
        public object GetService(Type serviceType) {
            if (serviceType.Equals(typeof(IControllerFactory))) {
                return new DummyControllerFactory();
            }

            return null;
        }

        public IEnumerable&lt;object&gt; GetServices(Type serviceType) {
            return null;
        }
    }
}
</pre><p>Finally, in global.asx.cs you need to set it up.<br />
</p><pre class="brush:csharp">protected void Application_Start()
{
 AreaRegistration.RegisterAllAreas();

 RegisterGlobalFilters(GlobalFilters.Filters);
 RegisterRoutes(RouteTable.Routes);

 DependencyResolver.SetResolver(new DummyDependencyResolver());
 //ControllerBuilder.Current.SetControllerFactory(new DummyControllerFactory());
}
</pre><h2>Conclusions</h2><p><code>IDependencyResolver</code> is a powerful feature of ASP.NET MVC3. It is used to create all internal MVC types, so by overriding it you can override default behavior of many framework aspects. Typically you should not have any complex code in <code>GetService</code> and <code>GetServices</code> methods, but instead just delegation of call to IoC container.<br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/10/power-of-close-collaboration.html">
    
      The Power of Close Collaboration</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-10-05T20:06:00+03:00" pubdate data-updated="true">Oct 5<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/beerncode/'>BeerNCode</a>, <a class='category' href='/blog/categories/mind/'>Mind</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>The collaboration and communication is very important in solving problems. As much better collaboration you have as much fast you are able to handle different issue. As closer people to each other, as better they able to work. That&#8217;s why I think that distributed teams even if they consists of great engineers could not work 100% of their potential. Lags in communications, language barrier, loose of body languages etc. makes it 80% for best cases.<br />
</p><p>As you might know I&#8217;m currently working on <a href="https://github.com/alexanderbeletsky/candidate.net">candidate.net</a> project. I really want to release that and according to my original plans I was really close to do that. But, suddenly my application just stopped to work. I&#8217;ll skip details of bug, but it was a ship killer. Application was not able to clone/pull github repositories. The only thing that happened between periods of working and non-working states is that I upgraded my Windows 7 up to SP1.<br />
</p><p>Even if I had great support by <a href="http://twitter.com/#!/ukraitor">@ukraitor</a> who forked my project recently, we were not able to solve it (remember, distributed teams - he is from Odessa, far from me). I was pulling out my hair and mostly lost a hope to solve that. But I decided to share the problem on latest <a href="http://kyivbeerncode.org/">Beer && Code</a> meeting we had this Tuesday.<br />
</p><p>It is usually hard to explain your problem. Along the process, I think to myself - &#8220;those people are pretty far from problem context, could they indeed help me?&#8221;. The simple answer is &#8220;Yes, they can&#8221;. Never underestimate the people around you.<br />
</p><p>During 2 hours we&#8217;ve been able to try different scenarios, discuss some potential issues and finally found a clue! I was so happy about that, at least my work moved from a dead point. I&#8217;m sure, I could not complete it by my own (in reasonable time). <br />
</p><p>So, my point is: if you are in work project - immediately share you problem with colleagues don&#8217;t make yourself <a href="http://www.beletsky.net/2010/11/you-stucked-stop-and-ask-for-help.html">completely stucked</a>. If you work on your own project - it is better if you find a collaborator, if you don&#8217;t have one you might find a local group, like <a href="http://kyivbeerncode.org/">Beer && Code</a> or talk to your developers friends whatever. <br />
</p><p>Remember, as closer the collaborator is as better. Special thank&#8217;s today goes to <a href="http://twitter.com/#!/chaliy">@chaliy</a> who helped to solve the issue.<br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/09/branching-workflow-in-git-svn-mode.html">
    
      Branching Workflow in Git-SVN Mode</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-09-06T17:42:00+03:00" pubdate data-updated="true">Sep 6<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/git/'>Git</a>, <a class='category' href='/blog/categories/gitsvn/'>GitSVN</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>As you might already know branches are primary power of Git. You should create branch for every task you working on. Even if it is something small you easily starting to get a good habit of creating branches, since they keep you much in isolation. So, how to deal with branches in Git-SVN mode? It is really easy and conforms to common git practices. </p><p>So, as you cloned the SVN repo you have master branch (or several masters, if you did more <a href="http://www.beletsky.net/2011/08/analog-of-svn-branch-switch-for-git.html">switches</a>). Suppose you need to start to work on ticket ND-177. </p><ol><li>Create new branch for ND-177 (I call new branch like, original_branch-branch_name)</li>
<pre>git checkout -b master-nd-177   
</pre><li>Do your work here, performing as many commits as you need</li>
<pre>get commit -a -m "some intermediate commit.."
</pre><li>Now, as you are ready to be merged you to SVN, you checkout and rebase master (to get latest SVN changes from it)</li>
<pre>git checkout master
    git svn rebase
</pre><li>You can simply merge 2 branches, but with simple merge you will get all commits history that you probably don&#8217;t need in SVN at all. You squash to compress number of commits into one nice looking commit object</li>
<pre>git merge --squash master-nd-177
</pre><li>It would merge up all changes from master-nd-177 into master. All you need to do is commit</li>
<pre>git commit -m "ND-177 completed"
</pre><li>And dcommit changes to SVN server</li>
<pre>git svn dcommit
</pre></ol><p>That&#8217;s six basic steps makes really straightforward workflow for everyday usage. </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/09/what-im-going-to-do.html">
    
      What I&#8217;m Going To Do</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-09-01T20:40:00+03:00" pubdate data-updated="true">Sep 1<span>st</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/mind/'>Mind</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>Lazy summer days have gone and cool September came. It is good time to think, decide on projects and goals. No time to chill.  </p><p>I have a different things in my mind, all the time. My biggest problem is loosing focus and task switching. I simply can not do one thing for quite long time. I need something new, I need to satisfy my exploration instinct. In the same time, achievement of results require much focus. I would like to be more focused.    </p><p>I&#8217;ll try to formulate my current projects and expectations I have. That&#8217;s my active projects, sorted by priority: </p><ul><li>         <strong>economic.com</strong> - my job. Working for economic is very important to me since it is main project that gives me money. We are doing interesting things there, problem is our technological stack and frameworks are outdated. That&#8217;s typical stage for every big project and pretty de-motivator for developers (especially me). Working with old stuff is hard and boring, that&#8217;s fact. But we have good team there and hope we are able to solve problems and move to bright future.     </li>
<li>         <strong>candidate.net</strong> - the <a href="http://www.beletsky.net/2011/06/candidatenet-application-i-made-on.html">application</a> I started on <a href="http://www.beletsky.net/2011/06/hackatone-in-kiev-11-12-june.html">Kiev Hackatone</a>. Remember I was describing my <a href="http://www.beletsky.net/2011/05/continuous-production-make-it-work.html">experience</a> with Continues Delivery based on Jenkins? That worked and works for me perfectly, expect the fact that Jenkins is Java application and consumes a lot of recourses (but I have quite limited resources on my VSP, actually). Candidate is the one who going to substitute Jenkins for me. Based on a power of <a href="https://github.com/refractalize/bounce">Bounce</a> and <a href="https://github.com/ferventcoder/roundhouse">Roundhouse</a> I will create nice and easy to use Continues Delivery tool for .NET websites and of cause release it open sourced for everyone. BTW, Candidate is working name and I&#8217;m looking for cool name for it, if you have any ideas let me know.     </li>
<li>         <strong>trackyt.net</strong> - the first <a href="http://www.trackyt.net/">application</a> I build and released on my own. Exactly this project gave me knowledge of &#8220;release&#8221; and how tough and hard it is. I haven&#8217;t write about it and haven&#8217;t done any major release recently. My bad. I&#8217;m not going to close that project. Still they say me &#8220;there are 1.000.000 GTD application around the internet&#8221;, you know - I don&#8217;t care. 10 month passed after version 1.0 released and it is only now I really understand what I want to create. I&#8217;ve been user of trackyt by myself for long time, I&#8217;ve collected priceless feedback of my friends.. I gathered more experience in building that kind of applications. I have clear vision both application and technology stack I&#8217;m going to use. I&#8217;m not happy with current version (and project name), so I&#8217;m simply going to start from scratch. Release 2.0 will be much interesting and useful, at least I hope that much.     </li>
<li>         <strong>beletsky.net</strong> - my blog. Least but not last, since <a href="http://beletsky.net">beletsky.net</a> is my biggest motivator. I will continue my <a href="http://www.beletsky.net/search/label/InsideMVC">Inside ASP.NET MVC</a> as well as all other things I try to put here. Of cause, producing good content is very difficult job.. but you are (readers) could improve it much. Don&#8217;t be lazy to post comments and any other feedback. It is really important for every blogger.     </li>
</ul><p>Besides of that I&#8217;m really happy that this year I joined <a href="http://kievalt.net/">Kiev ALT.NET</a> community. Recently we also started to have <i>Beer-n-code</i> sessions, that is really cool. I&#8217;m going to continue my contribution there as well. </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/08/elmah-mvc-controller-released-on-nuget.html">
    
      ELMAH MVC controller released on NuGet</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-08-29T21:20:00+03:00" pubdate data-updated="true">Aug 29<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/elmah-dot-mvc/'>ELMAH.MVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/nuget/'>NuGet</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>        I dedicated some time for that and happy to announce - ELMAH MVC controller released         on NuGet.     </p><p>        Due to the latest interest, feedback and changes - it has no sense         at all to keep that code just in blog post. In my <a href="http://www.beletsky.net/2011/08/latest-version-of-elmah-mvc-controller.html">previous</a> post I promised to create NuGet package for that, so here we are:     </p><div class="commandWrapper">        <div class="commandPrompt">            <p class="command">                PM&gt; Install-Package Elmah.MVC</p></div></div><p>        I simplified code even a little more to avoid changing in routes (in case of Admin area already exists in project).     </p><p>        So just grab it from NuGet now.     </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/08/latest-version-of-elmah-mvc-controller.html">
    
      Latest version of ELMAH MVC controller</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-08-27T19:36:00+03:00" pubdate data-updated="true">Aug 27<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/elmah-dot-mvc/'>ELMAH.MVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/tips/'>Tips</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p><a href="http://www.beletsky.net/2011/03/integrating-elmah-to-aspnet-mvc-in.html">Integrating ELMAH to ASP.NET MVC in right way</a> is blog post I created sometime ago. It appears really popular, because a lot of people had the same issue as me and found solution I created really applicable. It was really cool to receive all that feedback! By the way, <a href="https://github.com/alexanderbeletsky/elmah.mvc.controller">elmah.mvc.controller</a> is my first github repository I got pull request! </p><p>Especially, I would like to thank to <a href="https://github.com/seba-i">Seba Illingworth</a> and <a href="http://twitter.com/#!/blowdart">Barry Dorrans</a> who found really nasty issues and helped to fix those. </p><p>The controller&#8217;s code has been moved to github long time ago, but what I see many people just copy-past code from article into their solutions. The code I gave in previous post has been changed drastically, but instead of re-writting original post I decided to create new one. </p><h2>Latest version of ELMAH MVC controller</h2><p>So, after all modifications it looks like: </p><pre class="brush: csharp">namespace ElmahMvc.Areas.Admin.Controllers {
    class ElmahResult : ActionResult {
        private string _resouceType;

        public ElmahResult(string resouceType) {
            _resouceType = resouceType;
        }

        public override void ExecuteResult(ControllerContext context) {
            var factory = new Elmah.ErrorLogPageFactory();

            if (!string.IsNullOrEmpty(_resouceType)) {
                var pathInfo = "/" + _resouceType;
                context.HttpContext.RewritePath(FilePath(context), pathInfo, context.HttpContext.Request.QueryString.ToString());
            }

            var currentApplication = (HttpApplication)context.HttpContext.GetService(typeof(HttpApplication));
            var currentContext = currentApplication.Context;

            var httpHandler = factory.GetHandler(currentContext, null, null, null);
            if (httpHandler is IHttpAsyncHandler) {
                var asyncHttpHandler = (IHttpAsyncHandler)httpHandler;
                asyncHttpHandler.BeginProcessRequest(currentContext, (r) => { }, null);
            }
            else {
                httpHandler.ProcessRequest(currentContext);
            }
        }

        private string FilePath(ControllerContext context) {
            return _resouceType != "stylesheet" ? context.HttpContext.Request.Path.Replace(String.Format("/{0}", _resouceType), string.Empty) : context.HttpContext.Request.Path;
        }
    }

    public class ElmahController : Controller {
        public ActionResult Index(string type) {
            return new ElmahResult(type);
        }
    }
}

</pre><h2>How to use it in my application?</h2><p>Easy. Install ELMAH by NuGet, in package console </p><pre class="brush:plain"> Install-Package elmah
</pre><p>It is optional (but preferable) to create new Area called Admin. Inside AreaRegistration.cs your should place routing for ELMAH controller: </p><pre class="brush: csharp">context.MapRoute(
        "Admin_elmah",
        "Admin/elmah/{type}",
        new { action = "Index", controller = "Elmah", type = UrlParameter.Optional }
    );
</pre><p>Create ElmahController.cs (just from code above) and place to yours Areas/Admin/Controller folder, add file to project. Don&#8217;t forget to change the namespace according to your project. </p><p>Configure ELMAH logging options (Memory, XML, SQL), use Web.Config of this <a href="https://github.com/alexanderbeletsky/elmah.mvc.controller">project</a> as example. Run application, and see that: </p><pre class="brush:plain"> /admin/elmah
</pre><p>works.  </p><p>Optional (but very preferable) is to secure your controller with Authorize attribute: </p><pre class="brush: csharp"> [Authorize(Users = "Admin")]
 public class ElmahController : Controller
 {
</pre><p>That&#8217;s it. </p><h2>Known issues</h2><p>One current known issue - if I&#8217;m using <code>SqlErrorLog</code> as error log class and press &#8220;Download log&#8221; button on ELMAH dashboard, you&#8217;ve got empty result. Unfortunately, it does not work now, since <a href="http://code.google.com/p/elmah/issues/detail?id=230">issue</a> in ELMAH core that I hope will be fixed in nearest release. </p><h2>NuGet package for it? </h2><p>I didn&#8217;t expect such popularity of that class, but now I seriosly think putting this on NuGet. I&#8217;ll try to package that as soon as possible. </p></div>

      
      
    </div>
  </div>

    </article>
  
  
    <article>
        
  <h1 class="title pure-u-1">
    
    <a href="/2011/08/inside-aspnet-mvc-iresolver-and-its.html">
    
      Inside ASP.NET MVC: IResolver and it&#8217;s implementations</a>
  </h1>

  <div class="meta pure-u-1-5">
    <div class="date icon-calendar">








  


<time datetime="2011-08-27T16:06:00+03:00" pubdate data-updated="true">Aug 27<span>th</span>, 2011</time></div>
    <div class="tags icon-tag-2">

<span class="categories">
  
    <a class='category' href='/blog/categories/insidemvc/'>InsideMVC</a>, <a class='category' href='/blog/categories/mvc/'>MVC</a>, <a class='category' href='/blog/categories/asp-dot-net/'>asp.net</a>
  
</span>

</div>
  </div>

  <div class="entry-content pure-u-4-5">
    <div class="content">
      <div class='post'>
<p>One of the major changes between MVC2 and MVC3 was introduction of Dependency Injection principles on a level of framework. If you compare, for instance <code>ControllerBuilder.cs</code> from MVC2 and <code>ControllerBuilder.cs</code> from MVC3 you will clearly see the difference. In MVC3 we are no longer create entities directly (through &#8216;new&#8217; operator), but instead we delegate that to <code>IResolver</code> interface. <code>IResolver</code> interface itself is extremely simple:<br />
</p><pre class="brush:csharp">namespace System.Web.Mvc {
    internal interface IResolver&lt;T&gt; {
        T Current { get; }
    }
}
</pre><p>We can just ask the instance of type we would like to resolve. Please also note, that <code>IResolver</code> is internal class, so it is not exposed and you will never use it in application directly.<br />
</p><p>All major entities of MVC framework (ControllerFactory, Filters, ViewEngines etc.) from now resolved by <code>IResolver</code> implementation class. That improves extensibility of framework very much and introduces new strategy of creation objects.<br />
</p><h2>Implementations of IResolver interface</h2><p>There are two classes that implements <code>IResolver</code> - <code>SingleServiceResolver</code> and <code>MultiServiceResolver</code>. Primary responsibility of those are delegation call to <code>IDependencyResolver</code> methods <code>GetService</code> and <code>GetServices</code>, respectively.<br />
</p><p>If they just recalling method of <code>IDependecyResolver</code> class, what&#8217;s are the purpose of those two classes?<br />
</p><p>There are 2 purposes I can see:<br />
</p><ol><li>To provide default type instance in case of type is not resolved by <code>IDependencyResolver</code>.</li>
<li>To create instance only once.</li>
</ol><h2>How it works?<br />
</h2><p>Now, let&#8217;s take a look how it actually works. It is really simple and small, so I&#8217;m able to put most of code here. <br />
</p><p>Construction:<br />
</p><pre class="brush:csharp">public SingleServiceResolver(Func&lt;TService&gt; currentValueThunk, TService defaultValue, string callerMethodName) {
 if (currentValueThunk == null) {
  throw new ArgumentNullException(&quot;currentValueThunk&quot;);
 }
 if (defaultValue == null) {
  throw new ArgumentNullException(&quot;defaultValue&quot;);
 }

 _resolverThunk = () =&gt; DependencyResolver.Current;
 _currentValueThunk = currentValueThunk;
 _defaultValue = defaultValue;
 _callerMethodName = callerMethodName;
}
</pre><p>You can see, it receives default factory method, default type instance and the name of caller method (used as additional information in exception).<br />
</p><p>Here, how <code>ControllerBuilder</code> creates the <code>SingleServiceResolver</code>, for instance:<br />
</p><pre class="brush:csharp">internal ControllerBuilder(IResolver&lt;IControllerFactory&gt; serviceResolver) {
 _serviceResolver = serviceResolver ?? new SingleServiceResolver&lt;IControllerFactory&gt;(
  () =&gt; _factoryThunk(),
   new DefaultControllerFactory { ControllerBuilder = this },
  &quot;ControllerBuilder.GetControllerFactory&quot;
 );
}
</pre><p>Since it implements only one property, current <code>Current</code>:<br />
</p><pre class="brush:csharp">public TService Current {
 get {
  if (_resolverThunk != null) {
   lock (_currentValueThunk) {
    if (_resolverThunk != null) {
     _currentValueFromResolver = _resolverThunk().GetService&lt;TService&gt;();
     _resolverThunk = null;

     if (_currentValueFromResolver != null &amp;&amp; _currentValueThunk() != null) {
      throw new InvalidOperationException(String.Format(CultureInfo.CurrentCulture, MvcResources.SingleServiceResolver_CannotRegisterTwoInstances, typeof(TService).Name.ToString(), _callerMethodName));
     }
    }
   }
  }
  return _currentValueFromResolver ?? _currentValueThunk() ?? _defaultValue;
 }
}
</pre><p>First, we check the existence of <code>_resolverThunk</code> it would always exist (having value of <code>() => DependencyResolver.Current</code>) for first call of the method. Then, we locking on <code>_currentValueThunk</code> protecting for multiple threads access the same method, same time. Then, we try to resolve given type by asking <code>_resolverThunk()</code> to <code>GetService&lt;TService&gt;()</code>.<br />
</p><p>After that we have an if-statement that I didn&#8217;t get from the very beginning. Fortunately, MVC project has bunch of good unit tests. As I found the test it turns clear to me. The test called <code>CurrentThrowsIfCurrentSetThroughServiceAndSetter</code> and it&#8217;s Assert part: <br />
</p><pre class="brush:csharp">[TestMethod]
public void CurrentThrowsIfCurrentSetThroughServiceAndSetter() {
 // Arrange
 TestProvider providerFromCurrentValueThunk = new TestProvider();
 TestProvider providerFromServiceLocation = new TestProvider();
 TestProvider providerFromDefaultValue = new TestProvider();
 Mock&lt;IDependencyResolver&gt; resolver = new Mock&lt;IDependencyResolver&gt;();

 resolver.Setup(r =&gt; r.GetService(typeof(TestProvider)))
   .Returns(providerFromServiceLocation);

 SingleServiceResolver&lt;TestProvider&gt; singleResolver = new SingleServiceResolver&lt;TestProvider&gt;(() =&gt; providerFromCurrentValueThunk, providerFromDefaultValue, resolver.Object, &quot;TestProvider.Current&quot;);

 //Act &amp; assert
 ExceptionHelper.ExpectException&lt;InvalidOperationException&gt;(
  () =&gt; singleResolver.Current,
  &quot;An instance of TestProvider was found in the resolver as well as a custom registered provider in TestProvider.Current. Please set only one or the other.&quot;
 );
}
</pre><p>This is really <strong>important</strong> and says: you should not create same type instance both with <code>IDependencyResolver</code> and factory method! In case of <code>ControllerFactory</code>: you should never provide your implementation of <code>IControllerFactory</code> and in the same time resolve <code>IControllerFactory</code> instance by <code>IDependencyResolver</code>. Same rule for all other types. You should decide how you would like to override default behavior. In MVC3 usage of <code>IDependencyResolver</code> is a preferable.<br />
</p><p>The code below is wrong:<br />
</p><pre class="brush:csharp">DependencyResolver.SetResolver(new DummyDependencyResolver());
ControllerBuilder.Current.SetControllerFactory(new DummyControllerFactory());
</pre><p>So, after that <code>_resolverThunk</code> is reset and we no longer ask <code>IDependencyResolver</code>, just returning the resolved value.<br />
</p><p><code>MultiServiceResolver</code> is even a little simpler. <br />
</p><pre class="brush:csharp">public IEnumerable&lt;TService&gt; Current {
 get {
  if (_itemsFromService == null) {
   lock (_itemsThunk) {
    if (_itemsFromService == null) {
     _itemsFromService = _resolverThunk().GetServices&lt;TService&gt;();
    }
   }
  }
  return _itemsFromService.Concat(_itemsThunk());
 }
}
</pre><p>The same, singleton strategy of resolving types and then just concatenating resolved by <code>IDependencyResolver</code> with ones retuned by default factory method. It looks strange, but it is legal here to have types resolved both by <code>IDependencyResolver</code> and factory.<br />
</p><h2>Conclusions<br />
</h2><p><code>IResolver</code>, <code>SingleServiceResolver</code> and <code>MultiServiceResolver</code> are all internal parts of framework. We are not directly using any of them. They used as kind of bridge between previous (MVC2) object creation strategy and new (MVC3) one. New strategy is using Service Locator (<code>IDependencyResolver</code>). It is important that we should never &#8216;mix&#8217; both in the same application. Preferable way is <code>IDependencyResolver</code>.<br />
</p><h2>What&#8217;s next?</h2><p>We are going to continues our journey of resolving types and meet <code>IDependencyResolver</code> closer.<br />
</p><p>Previous <a href="http://www.beletsky.net/2011/07/inside-aspnet-mvc-controllerbuilder.html">Inside ASP.NET MVC: ControllerBuilder class</a><br />
</p></div>

      
      
    </div>
  </div>

    </article>
  
  <div class="pagination inner pure-u-1">
    
      <a class="prev" href="/blog/page/12/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/10/">Newer &rarr;</a>
    
  </div>
</div></div>
	<footer class="pure-g-r"><div class="inner pure-u-1">
	<p>
		Theme by <a href="https://twitter.com/alexbeletsky">@alexbeletsky</a> | Fonts by <a href="http://www.google.com/fonts/">Google Fonts</a> | Icons by <a href="http://fontello.com/">Fontello</a> | Hosted on <a href="http://github.com">github</a> | Powered by <a href="http://octopress.org/">Octopress</a>
	</p>
	<p>
		Copyright © 2010 - 2013 beletsky.net
	</p>
</div>

</footer>
	<div class="buttons">
	


	
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


	
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


	
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


	

</div>
</body>
</html>